ºR
V/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Services/LocalRestClient.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Services '
;' (
public 
class 
LocalRestClient 
: 
IDisposable *
{ 
private 
readonly 

HttpClient 

httpClient  *
;* +
private 
readonly 
string 
server "
=# $
$str% <
;< =
public 

LocalRestClient 
( 
string !
authorization" /
=0 1
$str2 4
)4 5
{ 
this 
. 

httpClient 
= 
new 

HttpClient (
(( )
)) *
;* +
this 
. 

httpClient 
. !
DefaultRequestHeaders -
.- .
Add. 1
(1 2
$str2 @
,@ A
$strB T
)T U
;U V
this 
. 

httpClient 
. !
DefaultRequestHeaders -
.- .
Add. 1
(1 2
$str2 :
,: ;
$str< A
)A B
;B C
var 
	jwsHeader 
= 
Convert 
.  
ToBase64String  .
(. /
Encoding/ 7
.7 8
UTF88 <
.< =
GetBytes= E
(E F
$strF ]
)] ^
)^ _
;_ `
this 
. 

httpClient 
. !
DefaultRequestHeaders -
.- .
Add. 1
(1 2
	jwsHeader2 ;
,; <
authorization= J
)J K
;K L
} 
public   

async   
Task   
<   
string   
>   
GetAsync   &
(  & '
Uri  ' *
uri  + .
)  . /
{!! !
ArgumentNullException"" 
."" 
ThrowIfNull"" )
("") *
uri""* -
)""- .
;"". /
try$$ 
{%% 	
var&& 
response&& 
=&& 
await&&  
this&&! %
.&&% &

httpClient&&& 0
.&&0 1
GetAsync&&1 9
(&&9 :
new&&: =
Uri&&> A
(&&A B
this&&B F
.&&F G
server&&G M
+&&N O
uri&&P S
.&&S T
ToString&&T \
(&&\ ]
)&&] ^
)&&^ _
)&&_ `
.&&` a
ConfigureAwait&&a o
(&&o p
false&&p u
)&&u v
;&&v w
var'' 
content'' 
='' 
await'' 
response''  (
.''( )
Content'') 0
.''0 1
ReadAsStringAsync''1 B
(''B C
)''C D
.''D E
ConfigureAwait''E S
(''S T
false''T Y
)''Y Z
;''Z [
return(( 
content(( 
;(( 
})) 	
catch** 
(** 
	Exception** 
ex** 
)** 
{++ 	
throw,, 
new,,  
HttpRequestException,, *
(,,* +
$",,+ -
$str,,- A
{,,A B
ex,,B D
.,,D E
Message,,E L
},,L M
",,M N
,,,N O
ex,,P R
),,R S
;,,S T
}-- 	
}.. 
public33 

async33 
Task33 
<33 
string33 
>33 
	PostAsync33 '
(33' (
Uri33( +
uri33, /
,33/ 0
string331 7
json338 <
)33< =
{44 !
ArgumentNullException55 
.55 
ThrowIfNull55 )
(55) *
uri55* -
)55- .
;55. /!
ArgumentNullException66 
.66 
ThrowIfNull66 )
(66) *
json66* .
)66. /
;66/ 0
try88 
{99 	
using:: 
var:: 
content:: 
=:: 
new::  #
StringContent::$ 1
(::1 2
json::2 6
,::6 7
Encoding::8 @
.::@ A
UTF8::A E
,::E F
$str::G Y
)::Y Z
;::Z [
var;; 
response;; 
=;; 
await;;  
this;;! %
.;;% &

httpClient;;& 0
.;;0 1
	PostAsync;;1 :
(;;: ;
new;;; >
Uri;;? B
(;;B C
this;;C G
.;;G H
server;;H N
+;;O P
uri;;Q T
.;;T U
ToString;;U ]
(;;] ^
);;^ _
);;_ `
,;;` a
content;;b i
);;i j
.;;j k
ConfigureAwait;;k y
(;;y z
false;;z 
)	;; Ä
;
;;Ä Å
var<< 
responseContent<< 
=<<  !
await<<" '
response<<( 0
.<<0 1
Content<<1 8
.<<8 9
ReadAsStringAsync<<9 J
(<<J K
)<<K L
.<<L M
ConfigureAwait<<M [
(<<[ \
false<<\ a
)<<a b
;<<b c
return== 
responseContent== "
;==" #
}>> 	
catch?? 
(?? 
	Exception?? 
ex?? 
)?? 
{@@ 	
throwAA 
newAA  
HttpRequestExceptionAA *
(AA* +
$"AA+ -
$strAA- B
{AAB C
exAAC E
.AAE F
MessageAAF M
}AAM N
"AAN O
,AAO P
exAAQ S
)AAS T
;AAT U
}BB 	
}CC 
publicHH 

asyncHH 
TaskHH 
<HH 
stringHH 
>HH 
PutAsyncHH &
(HH& '
UriHH' *
uriHH+ .
,HH. /
stringHH0 6
jsonHH7 ;
)HH; <
{II !
ArgumentNullExceptionJJ 
.JJ 
ThrowIfNullJJ )
(JJ) *
uriJJ* -
)JJ- .
;JJ. /!
ArgumentNullExceptionKK 
.KK 
ThrowIfNullKK )
(KK) *
jsonKK* .
)KK. /
;KK/ 0
tryMM 
{NN 	
usingOO 
varOO 
contentOO 
=OO 
newOO  #
StringContentOO$ 1
(OO1 2
jsonOO2 6
,OO6 7
EncodingOO8 @
.OO@ A
UTF8OOA E
,OOE F
$strOOG Y
)OOY Z
;OOZ [
varPP 
responsePP 
=PP 
awaitPP  
thisPP! %
.PP% &

httpClientPP& 0
.PP0 1
PutAsyncPP1 9
(PP9 :
newPP: =
UriPP> A
(PPA B
thisPPB F
.PPF G
serverPPG M
+PPN O
uriPPP S
.PPS T
ToStringPPT \
(PP\ ]
)PP] ^
)PP^ _
,PP_ `
contentPPa h
)PPh i
.PPi j
ConfigureAwaitPPj x
(PPx y
falsePPy ~
)PP~ 
;	PP Ä
varQQ 
responseContentQQ 
=QQ  !
awaitQQ" '
responseQQ( 0
.QQ0 1
ContentQQ1 8
.QQ8 9
ReadAsStringAsyncQQ9 J
(QQJ K
)QQK L
.QQL M
ConfigureAwaitQQM [
(QQ[ \
falseQQ\ a
)QQa b
;QQb c
returnRR 
responseContentRR "
;RR" #
}SS 	
catchTT 
(TT 
	ExceptionTT 
exTT 
)TT 
{UU 	
throwVV 
newVV  
HttpRequestExceptionVV *
(VV* +
$"VV+ -
$strVV- A
{VVA B
exVVB D
.VVD E
MessageVVE L
}VVL M
"VVM N
,VVN O
exVVP R
)VVR S
;VVS T
}WW 	
}XX 
public]] 

async]] 
Task]] 
<]] 
string]] 
>]] 
DeleteAsync]] )
(]]) *
Uri]]* -
uri]]. 1
)]]1 2
{^^ !
ArgumentNullException__ 
.__ 
ThrowIfNull__ )
(__) *
uri__* -
)__- .
;__. /
tryaa 
{bb 	
varcc 
responsecc 
=cc 
awaitcc  
thiscc! %
.cc% &

httpClientcc& 0
.cc0 1
DeleteAsynccc1 <
(cc< =
newcc= @
UriccA D
(ccD E
thisccE I
.ccI J
serverccJ P
+ccQ R
uriccS V
.ccV W
ToStringccW _
(cc_ `
)cc` a
)cca b
)ccb c
.ccc d
ConfigureAwaitccd r
(ccr s
falseccs x
)ccx y
;ccy z
vardd 
contentdd 
=dd 
awaitdd 
responsedd  (
.dd( )
Contentdd) 0
.dd0 1
ReadAsStringAsyncdd1 B
(ddB C
)ddC D
.ddD E
ConfigureAwaitddE S
(ddS T
falseddT Y
)ddY Z
;ddZ [
returnee 
contentee 
;ee 
}ff 	
catchgg 
(gg 
	Exceptiongg 
exgg 
)gg 
{hh 	
throwii 
newii  
HttpRequestExceptionii *
(ii* +
$"ii+ -
$strii- D
{iiD E
exiiE G
.iiG H
MessageiiH O
}iiO P
"iiP Q
,iiQ R
exiiS U
)iiU V
;iiV W
}jj 	
}kk 
publicmm 

voidmm 
Disposemm 
(mm 
)mm 
{nn 
thisoo 
.oo 
Disposeoo 
(oo 
trueoo 
)oo 
;oo 
GCpp 

.pp
 
SuppressFinalizepp 
(pp 
thispp  
)pp  !
;pp! "
}qq 
	protectedss 
virtualss 
voidss 
Disposess "
(ss" #
boolss# '
	disposingss( 1
)ss1 2
{tt 
ifuu 

(uu 
	disposinguu 
)uu 
{vv 	
thisww 
.ww 

httpClientww 
?ww 
.ww 
Disposeww $
(ww$ %
)ww% &
;ww& '
}xx 	
}yy 
}zz öt
Q/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Services/JwtService.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Services '
;' (
public 
class 

JwtService 
{ 
private 
readonly 
string 
	secretKey %
;% &
private 
readonly 
int 
expirationHours (
;( )
public 


JwtService 
( 
IConfiguration $
configuration% 2
)2 3
{ 
this 
. 
	secretKey 
= 
configuration &
[& '
$str' 3
]3 4
??5 7
throw8 =
new> A%
InvalidOperationExceptionB [
([ \
$str\ {
){ |
;| }
this 
. 
expirationHours 
= 
int "
." #
Parse# (
(( )
configuration) 6
[6 7
$str7 L
]L M
??N P
$strQ U
,U V
SystemW ]
.] ^
Globalization^ k
.k l
CultureInfol w
.w x
InvariantCulture	x à
)
à â
;
â ä
} 
public 

string 
GenerateToken 
(  
string  &
username' /
,/ 0
IReadOnlyList1 >
<> ?
string? E
>E F
rolesG L
,L M
IReadOnlyListN [
<[ \
string\ b
>b c
permissionsd o
,o p
string   
	authLevel   
=   
$str   !
,  ! "
string  # )
idp  * -
=  . /
$str  0 7
)  7 8
{!! !
ArgumentNullException"" 
."" 
ThrowIfNull"" )
("") *
username""* 2
)""2 3
;""3 4!
ArgumentNullException## 
.## 
ThrowIfNull## )
(##) *
roles##* /
)##/ 0
;##0 1!
ArgumentNullException$$ 
.$$ 
ThrowIfNull$$ )
($$) *
permissions$$* 5
)$$5 6
;$$6 7
var&& 
tokenHandler&& 
=&& 
new&& #
JwtSecurityTokenHandler&& 6
(&&6 7
)&&7 8
;&&8 9
var'' 
key'' 
='' 
Encoding'' 
.'' 
ASCII''  
.''  !
GetBytes''! )
('') *
this''* .
.''. /
	secretKey''/ 8
)''8 9
;''9 :
var)) 
claims)) 
=)) 
new)) 
List)) 
<)) 
Claim)) #
>))# $
{** 	
new++ 
(++ 

ClaimTypes++ 
.++ 
Name++ 
,++  
username++! )
)++) *
,++* +
new,, 
(,, 
$str,, 
,,, 
username,, $
),,$ %
,,,% &
new-- 
(-- 
$str-- 
,-- 
	authLevel-- '
)--' (
,--( )
new.. 
(.. 
$str.. #
,..# $
idp..% (
)..( )
,..) *
}// 	
;//	 

foreach22 
(22 
var22 
role22 
in22 
roles22 "
)22" #
{33 	
claims44 
.44 
Add44 
(44 
new44 
Claim44  
(44  !

ClaimTypes44! +
.44+ ,
Role44, 0
,440 1
role442 6
)446 7
)447 8
;448 9
}55 	
foreach88 
(88 
var88 

permission88 
in88  "
permissions88# .
)88. /
{99 	
claims:: 
.:: 
Add:: 
(:: 
new:: 
Claim::  
(::  !
$str::! -
,::- .

permission::/ 9
)::9 :
)::: ;
;::; <
};; 	
var== 
tokenDescriptor== 
=== 
new== !#
SecurityTokenDescriptor==" 9
{>> 	
Subject?? 
=?? 
new?? 
ClaimsIdentity?? (
(??( )
claims??) /
)??/ 0
,??0 1
Expires@@ 
=@@ 
DateTime@@ 
.@@ 
UtcNow@@ %
.@@% &
AddHours@@& .
(@@. /
this@@/ 3
.@@3 4
expirationHours@@4 C
)@@C D
,@@D E
SigningCredentialsAA 
=AA  
newAA! $
SigningCredentialsAA% 7
(AA7 8
newAA8 ; 
SymmetricSecurityKeyAA< P
(AAP Q
keyAAQ T
)AAT U
,AAU V
SecurityAlgorithmsAAW i
.AAi j
HmacSha256SignatureAAj }
)AA} ~
,AA~ 
}BB 	
;BB	 

varDD 
tokenDD 
=DD 
tokenHandlerDD  
.DD  !
CreateTokenDD! ,
(DD, -
tokenDescriptorDD- <
)DD< =
;DD= >
returnEE 
tokenHandlerEE 
.EE 

WriteTokenEE &
(EE& '
tokenEE' ,
)EE, -
;EE- .
}FF 
publicKK 

boolKK 
ValidateTokenKK 
(KK 
stringKK $
tokenKK% *
)KK* +
{LL 
tryMM 
{NN 	
varOO 
tokenHandlerOO 
=OO 
newOO "#
JwtSecurityTokenHandlerOO# :
(OO: ;
)OO; <
;OO< =
varPP 
keyPP 
=PP 
EncodingPP 
.PP 
ASCIIPP $
.PP$ %
GetBytesPP% -
(PP- .
thisPP. 2
.PP2 3
	secretKeyPP3 <
)PP< =
;PP= >
tokenHandlerRR 
.RR 
ValidateTokenRR &
(RR& '
tokenRR' ,
,RR, -
newRR. 1%
TokenValidationParametersRR2 K
{SS $
ValidateIssuerSigningKeyTT (
=TT) *
trueTT+ /
,TT/ 0
IssuerSigningKeyUU  
=UU! "
newUU# & 
SymmetricSecurityKeyUU' ;
(UU; <
keyUU< ?
)UU? @
,UU@ A
ValidateIssuerVV 
=VV  
falseVV! &
,VV& '
ValidateAudienceWW  
=WW! "
falseWW# (
,WW( )
	ClockSkewXX 
=XX 
TimeSpanXX $
.XX$ %
ZeroXX% )
,XX) *
}YY 
,YY 
outYY 
_YY 
)YY 
;YY 
return[[ 
true[[ 
;[[ 
}\\ 	
catch]] 
{^^ 	
return__ 
false__ 
;__ 
}`` 	
}aa 
publicff 

staticff 
stringff 
ExtractUsernameff (
(ff( )
stringff) /
tokenff0 5
)ff5 6
{gg 
tryhh 
{ii 	
varjj 
tokenHandlerjj 
=jj 
newjj "#
JwtSecurityTokenHandlerjj# :
(jj: ;
)jj; <
;jj< =
varkk 
	jsonTokenkk 
=kk 
tokenHandlerkk (
.kk( )
ReadJwtTokenkk) 5
(kk5 6
tokenkk6 ;
)kk; <
;kk< =
returnll 
	jsonTokenll 
.ll 
Claimsll #
.ll# $
FirstOrDefaultll$ 2
(ll2 3
xll3 4
=>ll5 7
xll8 9
.ll9 :
Typell: >
==ll? A
$strllB L
)llL M
?llM N
.llN O
ValuellO T
??llU W
stringllX ^
.ll^ _
Emptyll_ d
;lld e
}mm 	
catchnn 
{oo 	
returnpp 
stringpp 
.pp 
Emptypp 
;pp  
}qq 	
}rr 
publicww 

staticww 
IReadOnlyListww 
<ww  
stringww  &
>ww& '
ExtractRolesww( 4
(ww4 5
stringww5 ;
tokenww< A
)wwA B
{xx 
tryyy 
{zz 	
var{{ 
tokenHandler{{ 
={{ 
new{{ "#
JwtSecurityTokenHandler{{# :
({{: ;
){{; <
;{{< =
var|| 
	jsonToken|| 
=|| 
tokenHandler|| (
.||( )
ReadJwtToken||) 5
(||5 6
token||6 ;
)||; <
;||< =
return}} 
	jsonToken}} 
.}} 
Claims}} #
.~~ 
Where~~ 
(~~ 
x~~ 
=>~~ 
x~~ 
.~~ 
Type~~ "
==~~# %

ClaimTypes~~& 0
.~~0 1
Role~~1 5
)~~5 6
. 
Select 
( 
x 
=> 
x 
. 
Value $
)$ %
.
ÄÄ 
ToList
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
catch
ÇÇ 
{
ÉÉ 	
return
ÑÑ 
new
ÑÑ 
List
ÑÑ 
<
ÑÑ 
string
ÑÑ "
>
ÑÑ" #
(
ÑÑ# $
)
ÑÑ$ %
;
ÑÑ% &
}
ÖÖ 	
}
ÜÜ 
public
ãã 

static
ãã 
IReadOnlyList
ãã 
<
ãã  
string
ãã  &
>
ãã& ' 
ExtractPermissions
ãã( :
(
ãã: ;
string
ãã; A
token
ããB G
)
ããG H
{
åå 
try
çç 
{
éé 	
var
èè 
tokenHandler
èè 
=
èè 
new
èè "%
JwtSecurityTokenHandler
èè# :
(
èè: ;
)
èè; <
;
èè< =
var
êê 
	jsonToken
êê 
=
êê 
tokenHandler
êê (
.
êê( )
ReadJwtToken
êê) 5
(
êê5 6
token
êê6 ;
)
êê; <
;
êê< =
return
ëë 
	jsonToken
ëë 
.
ëë 
Claims
ëë #
.
íí 
Where
íí 
(
íí 
x
íí 
=>
íí 
x
íí 
.
íí 
Type
íí "
==
íí# %
$str
íí& 2
)
íí2 3
.
ìì 
Select
ìì 
(
ìì 
x
ìì 
=>
ìì 
x
ìì 
.
ìì 
Value
ìì $
)
ìì$ %
.
îî 
ToList
îî 
(
îî 
)
îî 
;
îî 
}
ïï 	
catch
ññ 
{
óó 	
return
òò 
new
òò 
List
òò 
<
òò 
string
òò "
>
òò" #
(
òò# $
)
òò$ %
;
òò% &
}
ôô 	
}
öö 
public
üü 

static
üü 
string
üü 
ExtractAuthLevel
üü )
(
üü) *
string
üü* 0
token
üü1 6
)
üü6 7
{
†† 
try
°° 
{
¢¢ 	
var
££ 
tokenHandler
££ 
=
££ 
new
££ "%
JwtSecurityTokenHandler
££# :
(
££: ;
)
££; <
;
££< =
var
§§ 
	jsonToken
§§ 
=
§§ 
tokenHandler
§§ (
.
§§( )
ReadJwtToken
§§) 5
(
§§5 6
token
§§6 ;
)
§§; <
;
§§< =
return
•• 
	jsonToken
•• 
.
•• 
Claims
•• #
.
••# $
FirstOrDefault
••$ 2
(
••2 3
x
••3 4
=>
••5 7
x
••8 9
.
••9 :
Type
••: >
==
••? A
$str
••B N
)
••N O
?
••O P
.
••P Q
Value
••Q V
??
••W Y
string
••Z `
.
••` a
Empty
••a f
;
••f g
}
¶¶ 	
catch
ßß 
{
®® 	
return
©© 
string
©© 
.
©© 
Empty
©© 
;
©©  
}
™™ 	
}
´´ 
public
∞∞ 

static
∞∞ 
string
∞∞ %
ExtractIdentityProvider
∞∞ 0
(
∞∞0 1
string
∞∞1 7
token
∞∞8 =
)
∞∞= >
{
±± 
try
≤≤ 
{
≥≥ 	
var
¥¥ 
tokenHandler
¥¥ 
=
¥¥ 
new
¥¥ "%
JwtSecurityTokenHandler
¥¥# :
(
¥¥: ;
)
¥¥; <
;
¥¥< =
var
µµ 
	jsonToken
µµ 
=
µµ 
tokenHandler
µµ (
.
µµ( )
ReadJwtToken
µµ) 5
(
µµ5 6
token
µµ6 ;
)
µµ; <
;
µµ< =
return
∂∂ 
	jsonToken
∂∂ 
.
∂∂ 
Claims
∂∂ #
.
∂∂# $
FirstOrDefault
∂∂$ 2
(
∂∂2 3
x
∂∂3 4
=>
∂∂5 7
x
∂∂8 9
.
∂∂9 :
Type
∂∂: >
==
∂∂? A
$str
∂∂B U
)
∂∂U V
?
∂∂V W
.
∂∂W X
Value
∂∂X ]
??
∂∂^ `
string
∂∂a g
.
∂∂g h
Empty
∂∂h m
;
∂∂m n
}
∑∑ 	
catch
∏∏ 
{
ππ 	
return
∫∫ 
string
∫∫ 
.
∫∫ 
Empty
∫∫ 
;
∫∫  
}
ªª 	
}
ºº 
public
¡¡ 

static
¡¡ 

Dictionary
¡¡ 
<
¡¡ 
string
¡¡ #
,
¡¡# $
string
¡¡% +
>
¡¡+ ,
ExtractAllClaims
¡¡- =
(
¡¡= >
string
¡¡> D
token
¡¡E J
)
¡¡J K
{
¬¬ 
try
√√ 
{
ƒƒ 	
var
≈≈ 
tokenHandler
≈≈ 
=
≈≈ 
new
≈≈ "%
JwtSecurityTokenHandler
≈≈# :
(
≈≈: ;
)
≈≈; <
;
≈≈< =
var
∆∆ 
	jsonToken
∆∆ 
=
∆∆ 
tokenHandler
∆∆ (
.
∆∆( )
ReadJwtToken
∆∆) 5
(
∆∆5 6
token
∆∆6 ;
)
∆∆; <
;
∆∆< =
return
«« 
	jsonToken
«« 
.
«« 
Claims
«« #
.
««# $
ToDictionary
««$ 0
(
««0 1
x
««1 2
=>
««3 5
x
««6 7
.
««7 8
Type
««8 <
,
««< =
x
««> ?
=>
««@ B
x
««C D
.
««D E
Value
««E J
)
««J K
;
««K L
}
»» 	
catch
…… 
{
   	
return
ÀÀ 
new
ÀÀ 

Dictionary
ÀÀ !
<
ÀÀ! "
string
ÀÀ" (
,
ÀÀ( )
string
ÀÀ* 0
>
ÀÀ0 1
(
ÀÀ1 2
)
ÀÀ2 3
;
ÀÀ3 4
}
ÃÃ 	
}
ÕÕ 
}ŒŒ àr
E/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Logging 
. 
ClearProviders 
( 
)  
;  !
builder 
. 
Logging 
. 

AddConsole 
( 
) 
; 
builder 
. 
Logging 
. 
SetMinimumLevel 
(  
LogLevel  (
.( )
Information) 4
)4 5
;5 6
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
c  
=>! #
{ 
c   
.   

SwaggerDoc   
(   
$str   
,   
new   
	Microsoft   $
.  $ %
OpenApi  % ,
.  , -
Models  - 3
.  3 4
OpenApiInfo  4 ?
{!! 
Title"" 
="" 
$str"" 5
,""5 6
Version## 
=## 
$str## 
,## 
Description$$ 
=$$ 
$str$I 
,II 
}JJ 
)JJ 
;JJ 
}KK 
)KK 
;KK 
builderNN 
.NN 
ServicesNN 
.NN 
AddAuthenticationNN "
(NN" #
JwtBearerDefaultsNN# 4
.NN4 5 
AuthenticationSchemeNN5 I
)NNI J
.OO 
AddJwtBearerOO 
(OO 
optionsOO 
=>OO 
{PP 
optionsQQ 
.QQ %
TokenValidationParametersQQ )
=QQ* +
newQQ, /%
TokenValidationParametersQQ0 I
{RR 	$
ValidateIssuerSigningKeySS $
=SS% &
trueSS' +
,SS+ ,
IssuerSigningKeyTT 
=TT 
newTT " 
SymmetricSecurityKeyTT# 7
(TT7 8
EncodingTT8 @
.TT@ A
ASCIITTA F
.TTF G
GetBytesTTG O
(TTO P
builderUU 
.UU 
ConfigurationUU %
[UU% &
$strUU& 2
]UU2 3
??UU4 6
throwUU7 <
newUU= @%
InvalidOperationExceptionUUA Z
(UUZ [
$strUU[ z
)UUz {
)UU{ |
)UU| }
,UU} ~
ValidateIssuerVV 
=VV 
falseVV "
,VV" #
ValidateAudienceWW 
=WW 
falseWW $
,WW$ %
	ClockSkewXX 
=XX 
TimeSpanXX  
.XX  !
ZeroXX! %
,XX% &
}YY 	
;YY	 

}ZZ 
)ZZ 
;ZZ 
builder]] 
.]] 
Services]] 
.]] 
AddAuthorization]] !
(]]! "
options]]" )
=>]]* ,
{^^ 
options`` 
.`` 
	AddPolicy`` 
(`` 
$str`` '
,``' (
policy``) /
=>``0 2
policyaa 
.aa 
Requirementsaa 
.aa 
Addaa 
(aa  
newaa  #!
PermissionRequirementaa$ 9
(aa9 :
$straa: F
)aaF G
)aaG H
)aaH I
;aaI J
optionsdd 
.dd 
	AddPolicydd 
(dd 
$strdd (
,dd( )
policydd* 0
=>dd1 3
policyee 
.ee 
Requirementsee 
.ee 
Addee 
(ee  
newee  #!
PermissionRequirementee$ 9
(ee9 :
$stree: G
)eeG H
)eeH I
)eeI J
;eeJ K
optionshh 
.hh 
	AddPolicyhh 
(hh 
$strhh )
,hh) *
policyhh+ 1
=>hh2 4
policyii 
.ii 
Requirementsii 
.ii 
Addii 
(ii  
newii  #!
PermissionRequirementii$ 9
(ii9 :
$strii: H
)iiH I
)iiI J
)iiJ K
;iiK L
optionsll 
.ll 
	AddPolicyll 
(ll 
$strll .
,ll. /
policyll0 6
=>ll7 9
policymm 
.mm 
Requirementsmm 
.mm 
Addmm 
(mm  
newmm  #'
IdentityProviderRequirementmm$ ?
(mm? @
$strmm@ L
)mmL M
)mmM N
)mmN O
;mmO P
optionspp 
.pp 
	AddPolicypp 
(pp 
$strpp '
,pp' (
policypp) /
=>pp0 2
policyqq 
.qq 
Requirementsqq 
.qq 
Addqq 
(qq  
newqq  # 
AuthLevelRequirementqq$ 8
(qq8 9
$strqq9 ?
)qq? @
)qq@ A
)qqA B
;qqB C
optionstt 
.tt 
	AddPolicytt 
(tt 
$strtt 9
,tt9 :
policytt; A
=>ttB D
policyuu 
.uu 
RequireAssertionuu 
(uu  
contextuu  '
=>uu( *
contextvv 
.vv 
Uservv 
.vv 
HasClaimvv !
(vv! "
$strvv" .
,vv. /
$strvv0 <
)vv< =
||vv> @
contextww 
.ww 
Userww 
.ww 
IsInRoleww !
(ww! "
$strww" )
)ww) *
)ww* +
)ww+ ,
;ww, -
optionsyy 
.yy 
	AddPolicyyy 
(yy 
$stryy :
,yy: ;
policyyy< B
=>yyC E
policyzz 
.zz 
RequireAssertionzz 
(zz  
contextzz  '
=>zz( *
context{{ 
.{{ 
User{{ 
.{{ 
HasClaim{{ !
({{! "
$str{{" .
,{{. /
$str{{0 =
){{= >
||{{? A
context|| 
.|| 
User|| 
.|| 
IsInRole|| !
(||! "
$str||" )
)||) *
)||* +
)||+ ,
;||, -
options~~ 
.~~ 
	AddPolicy~~ 
(~~ 
$str~~ ;
,~~; <
policy~~= C
=>~~D F
policy 
. 
RequireAssertion 
(  
context  '
=>( *
context
ÄÄ 
.
ÄÄ 
User
ÄÄ 
.
ÄÄ 
HasClaim
ÄÄ !
(
ÄÄ! "
$str
ÄÄ" .
,
ÄÄ. /
$str
ÄÄ0 >
)
ÄÄ> ?
||
ÄÄ@ B
context
ÅÅ 
.
ÅÅ 
User
ÅÅ 
.
ÅÅ 
IsInRole
ÅÅ !
(
ÅÅ! "
$str
ÅÅ" )
)
ÅÅ) *
)
ÅÅ* +
)
ÅÅ+ ,
;
ÅÅ, -
}ÇÇ 
)
ÇÇ 
;
ÇÇ 
builderÖÖ 
.
ÖÖ 
Services
ÖÖ 
.
ÖÖ 
	AddScoped
ÖÖ 
<
ÖÖ #
IAuthorizationHandler
ÖÖ 0
,
ÖÖ0 1
PermissionHandler
ÖÖ2 C
>
ÖÖC D
(
ÖÖD E
)
ÖÖE F
;
ÖÖF G
builderÜÜ 
.
ÜÜ 
Services
ÜÜ 
.
ÜÜ 
	AddScoped
ÜÜ 
<
ÜÜ #
IAuthorizationHandler
ÜÜ 0
,
ÜÜ0 1"
AnyPermissionHandler
ÜÜ2 F
>
ÜÜF G
(
ÜÜG H
)
ÜÜH I
;
ÜÜI J
builderáá 
.
áá 
Services
áá 
.
áá 
	AddScoped
áá 
<
áá #
IAuthorizationHandler
áá 0
,
áá0 1#
AllPermissionsHandler
áá2 G
>
ááG H
(
ááH I
)
ááI J
;
ááJ K
builderàà 
.
àà 
Services
àà 
.
àà 
	AddScoped
àà 
<
àà #
IAuthorizationHandler
àà 0
,
àà0 1
RoleHandler
àà2 =
>
àà= >
(
àà> ?
)
àà? @
;
àà@ A
builderââ 
.
ââ 
Services
ââ 
.
ââ 
	AddScoped
ââ 
<
ââ #
IAuthorizationHandler
ââ 0
,
ââ0 1%
IdentityProviderHandler
ââ2 I
>
ââI J
(
ââJ K
)
ââK L
;
ââL M
builderää 
.
ää 
Services
ää 
.
ää 
	AddScoped
ää 
<
ää #
IAuthorizationHandler
ää 0
,
ää0 1
AuthLevelHandler
ää2 B
>
ääB C
(
ääC D
)
ääD E
;
ääE F
builderçç 
.
çç 
Services
çç 
.
çç 
	AddScoped
çç 
<
çç 

JwtService
çç %
>
çç% &
(
çç& '
)
çç' (
;
çç( )
builderéé 
.
éé 
Services
éé 
.
éé 
	AddScoped
éé 
<
éé 
LocalRestClient
éé *
>
éé* +
(
éé+ ,
)
éé, -
;
éé- .
builderëë 
.
ëë 
Services
ëë 
.
ëë 
AddHealthChecks
ëë  
(
ëë  !
)
ëë! "
.
íí 
AddCheck
íí 
(
íí 
$str
íí 
,
íí 
(
íí 
)
íí 
=>
íí 
HealthCheckResult
íí -
.
íí- .
Healthy
íí. 5
(
íí5 6
)
íí6 7
,
íí7 8
new
íí9 <
[
íí< =
]
íí= >
{
íí? @
$str
ííA H
}
ííI J
)
ííJ K
;
ííK L
builderïï 
.
ïï 
Services
ïï 
.
ïï 
AddOpenTelemetry
ïï !
(
ïï! "
)
ïï" #
.
ññ 
ConfigureResource
ññ 
(
ññ 
resource
ññ 
=>
ññ  "
resource
ññ# +
.
óó 	

AddService
óó	 
(
óó 
$str
óó *
,
óó* +
serviceVersion
óó, :
:
óó: ;
$str
óó< C
)
óóC D
.
òò 	
AddAttributes
òò	 
(
òò 
new
òò 

Dictionary
òò %
<
òò% &
string
òò& ,
,
òò, -
object
òò. 4
>
òò4 5
{
ôô 	
[
öö 
$str
öö %
]
öö% &
=
öö' (
builder
öö) 0
.
öö0 1
Environment
öö1 <
.
öö< =
EnvironmentName
öö= L
,
ööL M
}
õõ 	
)
õõ	 

)
õõ
 
.
úú 
WithTracing
úú 
(
úú 
tracing
úú 
=>
úú 
tracing
úú #
.
ùù 	*
AddAspNetCoreInstrumentation
ùù	 %
(
ùù% &
)
ùù& '
.
ûû 	*
AddHttpClientInstrumentation
ûû	 %
(
ûû% &
)
ûû& '
.
üü 	
AddOtlpExporter
üü	 
(
üü 
)
üü 
)
üü 
.
†† 
WithMetrics
†† 
(
†† 
metrics
†† 
=>
†† 
metrics
†† #
.
°° 	*
AddAspNetCoreInstrumentation
°°	 %
(
°°% &
)
°°& '
.
¢¢ 	*
AddHttpClientInstrumentation
¢¢	 %
(
¢¢% &
)
¢¢& '
.
££ 	'
AddRuntimeInstrumentation
££	 "
(
££" #
)
££# $
.
§§ 	
AddOtlpExporter
§§	 
(
§§ 
)
§§ 
)
§§ 
;
§§ 
builderßß 
.
ßß 
Services
ßß 
.
ßß 
AddSingleton
ßß 
<
ßß 
MetricServer
ßß *
>
ßß* +
(
ßß+ ,
)
ßß, -
;
ßß- .
var©© 
app
©© 
=
©© 	
builder
©©
 
.
©© 
Build
©© 
(
©© 
)
©© 
;
©© 
if¨¨ 
(
¨¨ 
app
¨¨ 
.
¨¨ 
Environment
¨¨ 
.
¨¨ 
IsDevelopment
¨¨ !
(
¨¨! "
)
¨¨" #
)
¨¨# $
{≠≠ 
app
ÆÆ 
.
ÆÆ 

UseSwagger
ÆÆ 
(
ÆÆ 
)
ÆÆ 
;
ÆÆ 
app
ØØ 
.
ØØ 
UseSwaggerUI
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
}∞∞ 
app≥≥ 
.
≥≥ 
UseHttpMetrics
≥≥ 
(
≥≥ 
)
≥≥ 
;
≥≥ 
app∂∂ 
.
∂∂ 
UseAuthentication
∂∂ 
(
∂∂ 
)
∂∂ 
;
∂∂ 
app∑∑ 
.
∑∑ 
UseAuthorization
∑∑ 
(
∑∑ 
)
∑∑ 
;
∑∑ 
app∫∫ 
.
∫∫ 
MapControllers
∫∫ 
(
∫∫ 
)
∫∫ 
;
∫∫ 
appΩΩ 
.
ΩΩ 
MapHealthChecks
ΩΩ 
(
ΩΩ 
$str
ΩΩ #
,
ΩΩ# $
new
ΩΩ% ( 
HealthCheckOptions
ΩΩ) ;
{ææ 
	Predicate
øø 
=
øø 
check
øø 
=>
øø 
check
øø 
.
øø 
Tags
øø #
.
øø# $
Contains
øø$ ,
(
øø, -
$str
øø- 4
)
øø4 5
,
øø5 6
}¿¿ 
)
¿¿ 
;
¿¿ 
app¬¬ 
.
¬¬ 
MapHealthChecks
¬¬ 
(
¬¬ 
$str
¬¬ "
,
¬¬" #
new
¬¬$ ' 
HealthCheckOptions
¬¬( :
{√√ 
	Predicate
ƒƒ 
=
ƒƒ 
_
ƒƒ 
=>
ƒƒ 
false
ƒƒ 
,
ƒƒ 
}≈≈ 
)
≈≈ 
;
≈≈ 
app»» 
.
»» 

MapMetrics
»» 
(
»» 
)
»» 
;
»» 
varÀÀ 
metricServer
ÀÀ 
=
ÀÀ 
app
ÀÀ 
.
ÀÀ 
Services
ÀÀ 
.
ÀÀ   
GetRequiredService
ÀÀ  2
<
ÀÀ2 3
MetricServer
ÀÀ3 ?
>
ÀÀ? @
(
ÀÀ@ A
)
ÀÀA B
;
ÀÀB C
metricServerÃÃ 
.
ÃÃ 
Start
ÃÃ 
(
ÃÃ 
)
ÃÃ 
;
ÃÃ 
appŒŒ 
.
ŒŒ 
Run
ŒŒ 
(
ŒŒ 
)
ŒŒ 	
;
ŒŒ	 
≥^
a/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/VulnerableJWTController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class #
VulnerableJwtController $
:% &
ControllerBase' 5
{ 
private 
const 
string 

WeakSecret #
=$ %
$str& Q
;Q R
private 
const 
string 
TokenKey !
=" #
$str$ +
;+ ,
private 
const 
string 
AlgorithmKey %
=& '
$str( 3
;3 4
private 
const 
string 
ValidKey !
=" #
$str$ +
;+ ,
private 
const 
string 

DecodedKey #
=$ %
$str& /
;/ 0
private 
const 
string 
	HeaderKey "
=# $
$str% -
;- .
private 
const 
string 

PayloadKey #
=$ %
$str& /
;/ 0
private 
const 
string 
SignatureKey %
=& '
$str( 3
;3 4
private 
const 
string 
ErrorKey !
=" #
$str$ +
;+ ,
private 
const 
string 

MessageKey #
=$ %
$str& /
;/ 0
public 
#
VulnerableJwtController "
(" #
)# $
{ 
} 
[$$ 
HttpPost$$ 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 

IActionResult%% 
CreateToken%% $
(%%$ %
[%%% &
FromBody%%& .
]%%. /

Dictionary%%0 :
<%%: ;
string%%; A
,%%A B
object%%C I
>%%I J
payload%%K R
)%%R S
{&& 
try'' 
{(( 	
var** 
header** 
=** 
Convert**  
.**  !
ToBase64String**! /
(**/ 0
Encoding**0 8
.**8 9
UTF8**9 =
.**= >
GetBytes**> F
(**F G
$str**G l
)**l m
)**m n
;**n o
var++ 

payloadStr++ 
=++ 
Convert++ $
.++$ %
ToBase64String++% 3
(++3 4
Encoding++4 <
.++< =
UTF8++= A
.++A B
GetBytes++B J
(++J K
JsonSerializer++K Y
.++Y Z
	Serialize++Z c
(++c d
payload++d k
)++k l
)++l m
)++m n
;++n o
var,, 
	signature,, 
=,, 
Convert,, #
.,,# $
ToBase64String,,$ 2
(,,2 3
Encoding,,3 ;
.,,; <
UTF8,,< @
.,,@ A
GetBytes,,A I
(,,I J

WeakSecret,,J T
),,T U
),,U V
;,,V W
var.. 
token.. 
=.. 
$".. 
{.. 
header.. !
}..! "
$str.." #
{..# $

payloadStr..$ .
}... /
$str../ 0
{..0 1
	signature..1 :
}..: ;
"..; <
;..< =
return// 
Ok// 
(// 
token// 
)// 
;// 
}00 	
catch11 
(11 
	Exception11 
e11 
)11 
{22 	
return33 

BadRequest33 
(33 
$"33  
$str33  6
{336 7
e337 8
.338 9
Message339 @
}33@ A
"33A B
)33B C
;33C D
}44 	
}55 
[:: 
HttpPost:: 
(:: 
$str:: 
):: 
]:: 
public;; 

IActionResult;; 
VerifyToken;; $
(;;$ %
[;;% &
FromBody;;& .
];;. /

Dictionary;;0 :
<;;: ;
string;;; A
,;;A B
string;;C I
>;;I J
request;;K R
);;R S
{<< 
try== 
{>> 	
var?? 
token?? 
=?? 
request?? 
.??  
GetValueOrDefault??  1
(??1 2
TokenKey??2 :
,??: ;
string??< B
.??B C
Empty??C H
)??H I
;??I J
varBB 
responseBB 
=BB 
newBB 

DictionaryBB )
<BB) *
stringBB* 0
,BB0 1
objectBB2 8
>BB8 9
{CC 
[DD 
ValidKeyDD 
]DD 
=DD 
trueDD !
,DD! "
[EE 
TokenKeyEE 
]EE 
=EE 
tokenEE "
,EE" #
[FF 

MessageKeyFF 
]FF 
=FF 
$strFF I
,FFI J
}GG 
;GG 
returnII 
OkII 
(II 
responseII 
)II 
;II  
}JJ 	
catchKK 
(KK 
	ExceptionKK 
eKK 
)KK 
{LL 	
varMM 
responseMM 
=MM 
newMM 

DictionaryMM )
<MM) *
stringMM* 0
,MM0 1
objectMM2 8
>MM8 9
{NN 
[OO 
ValidKeyOO 
]OO 
=OO 
falseOO "
,OO" #
[PP 
ErrorKeyPP 
]PP 
=PP 
ePP 
.PP 
MessagePP &
,PP& '
}QQ 
;QQ 
returnSS 
OkSS 
(SS 
responseSS 
)SS 
;SS  
}TT 	
}UU 
[ZZ 
HttpGetZZ 
(ZZ 
$strZZ 
)ZZ 
]ZZ 
public[[ 

IActionResult[[ 
DecodeToken[[ $
([[$ %
[[[% &
	FromQuery[[& /
][[/ 0
string[[1 7
token[[8 =
)[[= >
{\\ !
ArgumentNullException]] 
.]] 
ThrowIfNull]] )
(]]) *
token]]* /
)]]/ 0
;]]0 1
try__ 
{`` 	
varbb 
partsbb 
=bb 
tokenbb 
.bb 
Splitbb #
(bb# $
$charbb$ '
)bb' (
;bb( )
varcc 
responsecc 
=cc 
newcc 

Dictionarycc )
<cc) *
stringcc* 0
,cc0 1
objectcc2 8
>cc8 9
{dd 
[ee 

DecodedKeyee 
]ee 
=ee 
trueee #
,ee# $
[ff 
	HeaderKeyff 
]ff 
=ff 
partsff #
.ff# $
Lengthff$ *
>ff+ ,
$numff- .
?ff/ 0
Encodingff1 9
.ff9 :
UTF8ff: >
.ff> ?
	GetStringff? H
(ffH I
ConvertffI P
.ffP Q
FromBase64StringffQ a
(ffa b
partsffb g
[ffg h
$numffh i
]ffi j
)ffj k
)ffk l
:ffm n
stringffo u
.ffu v
Emptyffv {
,ff{ |
[gg 

PayloadKeygg 
]gg 
=gg 
partsgg $
.gg$ %
Lengthgg% +
>gg, -
$numgg. /
?gg0 1
Encodinggg2 :
.gg: ;
UTF8gg; ?
.gg? @
	GetStringgg@ I
(ggI J
ConvertggJ Q
.ggQ R
FromBase64StringggR b
(ggb c
partsggc h
[ggh i
$numggi j
]ggj k
)ggk l
)ggl m
:ggn o
stringggp v
.ggv w
Emptyggw |
,gg| }
[hh 
SignatureKeyhh 
]hh 
=hh  
partshh! &
.hh& '
Lengthhh' -
>hh. /
$numhh0 1
?hh2 3
partshh4 9
[hh9 :
$numhh: ;
]hh; <
:hh= >
stringhh? E
.hhE F
EmptyhhF K
,hhK L
}ii 
;ii 
returnkk 
Okkk 
(kk 
responsekk 
)kk 
;kk  
}ll 	
catchmm 
(mm 
	Exceptionmm 
emm 
)mm 
{nn 	
varoo 
responseoo 
=oo 
newoo 

Dictionaryoo )
<oo) *
stringoo* 0
,oo0 1
objectoo2 8
>oo8 9
{pp 
[qq 

DecodedKeyqq 
]qq 
=qq 
falseqq $
,qq$ %
[rr 
ErrorKeyrr 
]rr 
=rr 
err 
.rr 
Messagerr &
,rr& '
}ss 
;ss 
returnuu 
Okuu 
(uu 
responseuu 
)uu 
;uu  
}vv 	
}ww 
[|| 
HttpPost|| 
(|| 
$str|| $
)||$ %
]||% &
public}} 

IActionResult}} 
VerifyAnyAlgorithm}} +
(}}+ ,
[}}, -
FromBody}}- 5
]}}5 6

Dictionary}}7 A
<}}A B
string}}B H
,}}H I
string}}J P
>}}P Q
request}}R Y
)}}Y Z
{~~ 
try 
{
ÄÄ 	
var
ÅÅ 
token
ÅÅ 
=
ÅÅ 
request
ÅÅ 
.
ÅÅ  
GetValueOrDefault
ÅÅ  1
(
ÅÅ1 2
TokenKey
ÅÅ2 :
,
ÅÅ: ;
string
ÅÅ< B
.
ÅÅB C
Empty
ÅÅC H
)
ÅÅH I
;
ÅÅI J
var
ÇÇ 
	algorithm
ÇÇ 
=
ÇÇ 
request
ÇÇ #
.
ÇÇ# $
GetValueOrDefault
ÇÇ$ 5
(
ÇÇ5 6
AlgorithmKey
ÇÇ6 B
,
ÇÇB C
string
ÇÇD J
.
ÇÇJ K
Empty
ÇÇK P
)
ÇÇP Q
;
ÇÇQ R
var
ÖÖ 
response
ÖÖ 
=
ÖÖ 
new
ÖÖ 

Dictionary
ÖÖ )
<
ÖÖ) *
string
ÖÖ* 0
,
ÖÖ0 1
object
ÖÖ2 8
>
ÖÖ8 9
{
ÜÜ 
[
áá 
ValidKey
áá 
]
áá 
=
áá 
true
áá !
,
áá! "
[
àà 
AlgorithmKey
àà 
]
àà 
=
àà  
	algorithm
àà! *
,
àà* +
[
ââ 
TokenKey
ââ 
]
ââ 
=
ââ 
token
ââ "
,
ââ" #
[
ää 

MessageKey
ää 
]
ää 
=
ää 
$"
ää !
$str
ää! H
{
ääH I
	algorithm
ääI R
}
ääR S
"
ääS T
,
ääT U
}
ãã 
;
ãã 
return
çç 
Ok
çç 
(
çç 
response
çç 
)
çç 
;
çç  
}
éé 	
catch
èè 
(
èè 
	Exception
èè 
e
èè 
)
èè 
{
êê 	
var
ëë 
response
ëë 
=
ëë 
new
ëë 

Dictionary
ëë )
<
ëë) *
string
ëë* 0
,
ëë0 1
object
ëë2 8
>
ëë8 9
{
íí 
[
ìì 
ValidKey
ìì 
]
ìì 
=
ìì 
false
ìì "
,
ìì" #
[
îî 
ErrorKey
îî 
]
îî 
=
îî 
e
îî 
.
îî 
Message
îî &
,
îî& '
}
ïï 
;
ïï 
return
óó 
Ok
óó 
(
óó 
response
óó 
)
óó 
;
óó  
}
òò 	
}
ôô 
}öö ‡'
[/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/MetricsController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
MetricsController 
:  
ControllerBase! /
{ 
private 
static 
readonly 
Meter !
Meter" '
=( )
new* -
(- .
$str. L
,L M
$strN U
)U V
;V W
private 
static 
readonly 
Counter #
<# $
long$ (
>( )
RequestCounter* 8
=9 :
Meter; @
.@ A
CreateCounterA N
<N O
longO S
>S T
(T U
$strU l
,l m
$str	n è
)
è ê
;
ê ë
private 
static 
readonly 
	Histogram %
<% &
double& ,
>, -
ResponseTime. :
=; <
Meter= B
.B C
CreateHistogramC R
<R S
doubleS Y
>Y Z
(Z [
$str[ q
,q r
$str	s â
)
â ä
;
ä ã
private 
static 
readonly 
Random "
Random# )
=* +
new, /
(/ 0
)0 1
;1 2
[ 
HttpGet 
( 
$str 
) 
] 
public 

async 
Task 
< 
string 
> 
TestMetrics )
() *
)* +
{ 
RequestCounter 
. 
Add 
( 
$num 
) 
; 
using 
var 
activity 
= 
new  
Activity! )
() *
$str* <
)< =
;= >
activity 
. 
Start 
( 
) 
; 
try 
{ 	
await 
Task 
. 
Delay 
( 
Random #
.# $
Next$ (
(( )
$num) +
,+ ,
$num- 0
)0 1
)1 2
;2 3
return   
$str   +
;  + ,
}!! 	
finally"" 
{## 	
activity$$ 
.$$ 
Stop$$ 
($$ 
)$$ 
;$$ 
ResponseTime%% 
.%% 
Record%% 
(%%  
activity%%  (
.%%( )
Duration%%) 1
.%%1 2
TotalMilliseconds%%2 C
)%%C D
;%%D E
}&& 	
}'' 
[)) 
HttpGet)) 
()) 
$str)) 
))) 
])) 
public** 

string** 
IncrementCounter** "
(**" #
[**# $
	FromQuery**$ -
]**- .
int**/ 2
value**3 8
=**9 :
$num**; <
)**< =
{++ 
RequestCounter,, 
.,, 
Add,, 
(,, 
value,,  
),,  !
;,,! "
return-- 
$"-- 
$str-- (
{--( )
value--) .
}--. /
"--/ 0
;--0 1
}.. 
[00 
HttpGet00 
(00 
$str00 
)00 
]00 
public11 

async11 
Task11 
<11 
string11 
>11 
SlowEndpoint11 *
(11* +
)11+ ,
{22 
RequestCounter33 
.33 
Add33 
(33 
$num33 
)33 
;33 
using55 
var55 
activity55 
=55 
new55  
Activity55! )
(55) *
$str55* :
)55: ;
;55; <
activity66 
.66 
Start66 
(66 
)66 
;66 
try88 
{99 	
await;; 
Task;; 
.;; 
Delay;; 
(;; 
Random;; #
.;;# $
Next;;$ (
(;;( )
$num;;) ,
,;;, -
$num;;. 2
);;2 3
);;3 4
;;;4 5
return<< 
$str<< -
;<<- .
}== 	
finally>> 
{?? 	
activity@@ 
.@@ 
Stop@@ 
(@@ 
)@@ 
;@@ 
ResponseTimeAA 
.AA 
RecordAA 
(AA  
activityAA  (
.AA( )
DurationAA) 1
.AA1 2
TotalMillisecondsAA2 C
)AAC D
;AAD E
}BB 	
}CC 
}DD Ò-
_/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/ApplicationController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 	
)	 

]
 
[ 
Tags 
( 
$str 
) 
] 
public 
class !
ApplicationController "
:# $
ControllerBase% 3
{ 
private 
readonly 
ILogger 
< !
ApplicationController 2
>2 3
logger4 :
;: ;
public 
!
ApplicationController  
(  !
ILogger! (
<( )!
ApplicationController) >
>> ?
logger@ F
)F G
{ 
this 
. 
logger 
= 
logger 
; 
} 
[ 
HttpGet 
] 
public 

IActionResult 
Home 
( 
) 
{ 
var 
	jwsHeader 
= 
Convert 
.  
ToBase64String  .
(. /
Encoding/ 7
.7 8
UTF88 <
.< =
GetBytes= E
(E F
$strF ]
)] ^
)^ _
;_ `
this 
. 
logger 
. 
LogInformation "
(" #
$str# F
,F G
	jwsHeaderH Q
)Q R
;R S
foreach"" 
("" 
var"" 
header"" 
in"" 
this"" #
.""# $
Request""$ +
.""+ ,
Headers"", 3
)""3 4
{## 	
this$$ 
.$$ 
logger$$ 
.$$ 
LogInformation$$ *
($$* +
$str$$+ E
,$$E F
header$$G M
.$$M N
Key$$N Q
,$$Q R
header$$S Y
.$$Y Z
Value$$Z _
)$$_ `
;$$` a
}%% 	
return'' 
Ok'' 
('' 
$str'' ,
)'', -
;''- .
}(( 
[-- 
HttpGet-- 
(-- 
$str-- -
)--- .
]--. /
[.. 
	Authorize.. 
(.. 
Policy.. 
=.. 
$str.. ;
)..; <
]..< =
[//  
ProducesResponseType// 
(// 
typeof//  
(//  !
string//! '
)//' (
,//( )
$num//* -
)//- .
]//. /
[00  
ProducesResponseType00 
(00 
$num00 
)00 
]00 
[11  
ProducesResponseType11 
(11 
$num11 
)11 
]11 
public22 

IActionResult22 
	GetObject22 "
(22" #
[22# $
	FromQuery22$ -
]22- .
string22/ 5
id226 8
)228 9
{33 
this44 
.44 
logger44 
.44 
LogInformation44 "
(44" #
$str44# 5
,445 6
id447 9
)449 :
;44: ;
return55 
Ok55 
(55 
$str55 
)55 
;55 
}66 
[;; 
HttpPut;; 
(;; 
$str;; -
);;- .
];;. /
[<< 
	Authorize<< 
(<< 
Policy<< 
=<< 
$str<< <
)<<< =
]<<= >
[==  
ProducesResponseType== 
(== 
typeof==  
(==  !
string==! '
)==' (
,==( )
$num==* -
)==- .
]==. /
[>>  
ProducesResponseType>> 
(>> 
$num>> 
)>> 
]>> 
[??  
ProducesResponseType?? 
(?? 
$num?? 
)?? 
]?? 
public@@ 

IActionResult@@ 
	PutObject@@ "
(@@" #
[@@# $
	FromQuery@@$ -
]@@- .
string@@/ 5
id@@6 8
)@@8 9
{AA 
thisBB 
.BB 
loggerBB 
.BB 
LogInformationBB "
(BB" #
$strBB# 5
,BB5 6
idBB7 9
)BB9 :
;BB: ;
returnCC 
OkCC 
(CC 
$strCC 
)CC 
;CC 
}DD 
[II 

HttpDeleteII 
(II 
$strII 3
)II3 4
]II4 5
[JJ 
	AuthorizeJJ 
(JJ 
PolicyJJ 
=JJ 
$strJJ =
)JJ= >
]JJ> ?
[KK  
ProducesResponseTypeKK 
(KK 
typeofKK  
(KK  !
stringKK! '
)KK' (
,KK( )
$numKK* -
)KK- .
]KK. /
[LL  
ProducesResponseTypeLL 
(LL 
$numLL 
)LL 
]LL 
[MM  
ProducesResponseTypeMM 
(MM 
$numMM 
)MM 
]MM 
publicNN 

IActionResultNN 
DeleteObjectNN %
(NN% &
[NN& '
	FromQueryNN' 0
]NN0 1
stringNN2 8
idNN9 ;
)NN; <
{OO 
thisPP 
.PP 
loggerPP 
.PP 
LogInformationPP "
(PP" #
$strPP# 8
,PP8 9
idPP: <
)PP< =
;PP= >
returnQQ 
OkQQ 
(QQ 
$strQQ 
)QQ 
;QQ 
}RR 
}SS ‘ë
Y/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/TokenController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
[ 
Tags 
( 
$str 
) 
] 
public 
class 
TokenController 
: 
ControllerBase -
{ 
private 
readonly 

JwtService 

jwtService  *
;* +
private 
const 
string 
CacheReadPermission ,
=- .
$str/ ;
;; <
private 
const 
string  
CacheWritePermission -
=. /
$str0 =
;= >
private 
const 
string 
DefaultRole $
=% &
$str' -
;- .
private 
static 
readonly 
string "
[" #
]# $

AdminRoles% /
=0 1
{2 3
$str4 ;
,; <
$str= C
}D E
;E F
private 
static 
readonly 
string "
[" #
]# $
AdminPermissions% 5
=6 7
{8 9
CacheReadPermission: M
,M N 
CacheWritePermissionO c
,c d
$stre s
}t u
;u v
private 
static 
readonly 
string "
[" #
]# $
	UserRoles% .
=/ 0
{1 2
DefaultRole3 >
}? @
;@ A
private 
static 
readonly 
string "
[" #
]# $
UserPermissions% 4
=5 6
{7 8
CacheReadPermission9 L
}M N
;N O
private 
static 
readonly 
string "
[" #
]# $
ReadOnlyRoles% 2
=3 4
{5 6
$str7 A
}B C
;C D
private 
static 
readonly 
string "
[" #
]# $
ReadOnlyPermissions% 8
=9 :
{; <
CacheReadPermission= P
}Q R
;R S
private 
static 
readonly 
string "
[" #
]# $
WriterRoles% 0
=1 2
{3 4
$str5 =
}> ?
;? @
private   
static   
readonly   
string   "
[  " #
]  # $
WriterPermissions  % 6
=  7 8
{  9 :
CacheReadPermission  ; N
,  N O 
CacheWritePermission  P d
}  e f
;  f g
public"" 

TokenController"" 
("" 

JwtService"" %

jwtService""& 0
)""0 1
{## 
this$$ 
.$$ 

jwtService$$ 
=$$ 

jwtService$$ $
;$$$ %
}%% 
[** 
HttpPost** 
(** 
$str** 
)** 
]** 
[++  
ProducesResponseType++ 
(++ 
typeof++  
(++  !
object++! '
)++' (
,++( )
$num++* -
)++- .
]++. /
[,,  
ProducesResponseType,, 
(,, 
$num,, 
),, 
],, 
public-- 

IActionResult-- 
GenerateToken-- &
(--& '
[.. 	
	FromQuery..	 
,.. 
Required.. 
].. 
string.. $
username..% -
,..- .
[// 	
	FromQuery//	 
]// 
string// 
?// 
roles// !
=//" #
null//$ (
,//( )
[00 	
	FromQuery00	 
]00 
string00 
?00 
permissions00 '
=00( )
null00* .
)00. /
{11 
var33 
	rolesList33 
=33 
string33 
.33 
IsNullOrEmpty33 ,
(33, -
roles33- 2
)332 3
?44 
new44 
List44 
<44 
string44 
>44 
{44  
DefaultRole44! ,
}44- .
:55 
roles55 
.55 
Split55 
(55 
$char55 
)55 
.55 
Select55 %
(55% &
r55& '
=>55( *
r55+ ,
.55, -
Trim55- 1
(551 2
)552 3
)553 4
.554 5
ToList555 ;
(55; <
)55< =
;55= >
var77 
permissionsList77 
=77 
string77 $
.77$ %
IsNullOrEmpty77% 2
(772 3
permissions773 >
)77> ?
?88 
new88 
List88 
<88 
string88 
>88 
{88  
CacheReadPermission88! 4
}885 6
:99 
permissions99 
.99 
Split99 
(99  
$char99  #
)99# $
.99$ %
Select99% +
(99+ ,
p99, -
=>99. 0
p991 2
.992 3
Trim993 7
(997 8
)998 9
)999 :
.99: ;
ToList99; A
(99A B
)99B C
;99C D
var;; 
token;; 
=;; 
this;; 
.;; 

jwtService;; #
.;;# $
GenerateToken;;$ 1
(;;1 2
username;;2 :
,;;: ;
	rolesList;;< E
,;;E F
permissionsList;;G V
);;V W
;;;W X
var== 
response== 
=== 
new== 
{>> 	
token?? 
,?? 
username@@ 
,@@ 
rolesAA 
=AA 
	rolesListAA 
,AA 
permissionsBB 
=BB 
permissionsListBB )
,BB) *
	expiresAtCC 
=CC 
DateTimeCC  
.CC  !
UtcNowCC! '
.CC' (
AddHoursCC( 0
(CC0 1
$numCC1 2
)CC2 3
,CC3 4
}DD 	
;DD	 

returnFF 
OkFF 
(FF 
responseFF 
)FF 
;FF 
}GG 
[LL 
HttpGetLL 
(LL 
$strLL  
)LL  !
]LL! "
[MM  
ProducesResponseTypeMM 
(MM 
typeofMM  
(MM  !
objectMM! '
)MM' (
,MM( )
$numMM* -
)MM- .
]MM. /
[NN  
ProducesResponseTypeNN 
(NN 
$numNN 
)NN 
]NN 
publicOO 

IActionResultOO #
GeneratePredefinedTokenOO 0
(OO0 1
[OO1 2
	FromRouteOO2 ;
]OO; <
stringOO= C
typeOOD H
)OOH I
{PP !
ArgumentNullExceptionQQ 
.QQ 
ThrowIfNullQQ )
(QQ) *
typeQQ* .
)QQ. /
;QQ/ 0
varSS 
	upperTypeSS 
=SS 
typeSS 
.SS 
ToUpperInvariantSS -
(SS- .
)SS. /
;SS/ 0
returnTT 
	upperTypeTT 
switchTT 
{UU 	
$strVV 
=>VV 
thisVV 
.VV 
GenerateAdminTokenVV .
(VV. /
)VV/ 0
,VV0 1
$strWW 
=>WW 
thisWW 
.WW 
GenerateUserTokenWW ,
(WW, -
)WW- .
,WW. /
$strXX 
=>XX 
thisXX 
.XX !
GenerateReadOnlyTokenXX 4
(XX4 5
)XX5 6
,XX6 7
$strYY 
=>YY 
thisYY 
.YY 
GenerateWriteTokenYY .
(YY. /
)YY/ 0
,YY0 1
_ZZ 
=>ZZ 

BadRequestZZ 
(ZZ 
$"ZZ 
$strZZ 2
{ZZ2 3
typeZZ3 7
}ZZ7 8
"ZZ8 9
)ZZ9 :
,ZZ: ;
}[[ 	
;[[	 

}\\ 
[aa 
HttpGetaa 
(aa 
$straa 
)aa 
]aa 
[bb  
ProducesResponseTypebb 
(bb 
typeofbb  
(bb  !
objectbb! '
)bb' (
,bb( )
$numbb* -
)bb- .
]bb. /
publiccc 

IActionResultcc 
GenerateAdminTokencc +
(cc+ ,
)cc, -
{dd 
varee 
tokenee 
=ee 
thisee 
.ee 

jwtServiceee #
.ee# $
GenerateTokenee$ 1
(ee1 2
$strff 
,ff 
newgg 
Listgg 
<gg 
stringgg 
>gg 
{gg 
$strgg &
,gg& '
$strgg( .
}gg/ 0
,gg0 1
newhh 
Listhh 
<hh 
stringhh 
>hh 
{hh 
CacheReadPermissionhh 2
,hh2 3 
CacheWritePermissionhh4 H
,hhH I
$strhhJ X
}hhY Z
)hhZ [
;hh[ \
returnjj 
Okjj 
(jj 
newjj 
{kk 	
tokenll 
,ll 
usernamemm 
=mm 
$strmm 
,mm 
rolesnn 
=nn 

AdminRolesnn 
,nn 
permissionsoo 
=oo 
AdminPermissionsoo *
,oo* +
	expiresAtpp 
=pp 
DateTimepp  
.pp  !
UtcNowpp! '
.pp' (
AddHourspp( 0
(pp0 1
$numpp1 2
)pp2 3
,pp3 4
}qq 	
)qq	 

;qq
 
}rr 
[ww 
HttpGetww 
(ww 
$strww 
)ww 
]ww 
[xx  
ProducesResponseTypexx 
(xx 
typeofxx  
(xx  !
objectxx! '
)xx' (
,xx( )
$numxx* -
)xx- .
]xx. /
publicyy 

IActionResultyy 
GenerateUserTokenyy *
(yy* +
)yy+ ,
{zz 
var{{ 
token{{ 
={{ 
this{{ 
.{{ 

jwtService{{ #
.{{# $
GenerateToken{{$ 1
({{1 2
$str|| 
,|| 
new}} 
List}} 
<}} 
string}} 
>}} 
{}} 
DefaultRole}} *
}}}+ ,
,}}, -
new~~ 
List~~ 
<~~ 
string~~ 
>~~ 
{~~ 
CacheReadPermission~~ 2
}~~3 4
)~~4 5
;~~5 6
return
ÄÄ 
Ok
ÄÄ 
(
ÄÄ 
new
ÄÄ 
{
ÅÅ 	
token
ÇÇ 
,
ÇÇ 
username
ÉÉ 
=
ÉÉ 
$str
ÉÉ 
,
ÉÉ 
roles
ÑÑ 
=
ÑÑ 
	UserRoles
ÑÑ 
,
ÑÑ 
permissions
ÖÖ 
=
ÖÖ 
UserPermissions
ÖÖ )
,
ÖÖ) *
	expiresAt
ÜÜ 
=
ÜÜ 
DateTime
ÜÜ  
.
ÜÜ  !
UtcNow
ÜÜ! '
.
ÜÜ' (
AddHours
ÜÜ( 0
(
ÜÜ0 1
$num
ÜÜ1 2
)
ÜÜ2 3
,
ÜÜ3 4
}
áá 	
)
áá	 

;
áá
 
}
àà 
[
çç 
HttpGet
çç 
(
çç 
$str
çç 
)
çç 
]
çç 
[
éé "
ProducesResponseType
éé 
(
éé 
typeof
éé  
(
éé  !
object
éé! '
)
éé' (
,
éé( )
$num
éé* -
)
éé- .
]
éé. /
public
èè 

IActionResult
èè #
GenerateReadOnlyToken
èè .
(
èè. /
)
èè/ 0
{
êê 
var
ëë 
token
ëë 
=
ëë 
this
ëë 
.
ëë 

jwtService
ëë #
.
ëë# $
GenerateToken
ëë$ 1
(
ëë1 2
$str
íí 
,
íí 
new
ìì 
List
ìì 
<
ìì 
string
ìì 
>
ìì 
{
ìì 
$str
ìì )
}
ìì* +
,
ìì+ ,
new
îî 
List
îî 
<
îî 
string
îî 
>
îî 
{
îî !
CacheReadPermission
îî 2
}
îî3 4
)
îî4 5
;
îî5 6
return
ññ 
Ok
ññ 
(
ññ 
new
ññ 
{
óó 	
token
òò 
,
òò 
username
ôô 
=
ôô 
$str
ôô !
,
ôô! "
roles
öö 
=
öö 
ReadOnlyRoles
öö !
,
öö! "
permissions
õõ 
=
õõ !
ReadOnlyPermissions
õõ -
,
õõ- .
	expiresAt
úú 
=
úú 
DateTime
úú  
.
úú  !
UtcNow
úú! '
.
úú' (
AddHours
úú( 0
(
úú0 1
$num
úú1 2
)
úú2 3
,
úú3 4
}
ùù 	
)
ùù	 

;
ùù
 
}
ûû 
[
££ 
HttpGet
££ 
(
££ 
$str
££ 
)
££ 
]
££ 
[
§§ "
ProducesResponseType
§§ 
(
§§ 
typeof
§§  
(
§§  !
object
§§! '
)
§§' (
,
§§( )
$num
§§* -
)
§§- .
]
§§. /
public
•• 

IActionResult
••  
GenerateWriteToken
•• +
(
••+ ,
)
••, -
{
¶¶ 
var
ßß 
token
ßß 
=
ßß 
this
ßß 
.
ßß 

jwtService
ßß #
.
ßß# $
GenerateToken
ßß$ 1
(
ßß1 2
$str
®® 
,
®® 
new
©© 
List
©© 
<
©© 
string
©© 
>
©© 
{
©© 
$str
©© '
}
©©( )
,
©©) *
new
™™ 
List
™™ 
<
™™ 
string
™™ 
>
™™ 
{
™™ !
CacheReadPermission
™™ 2
,
™™2 3"
CacheWritePermission
™™4 H
}
™™I J
)
™™J K
;
™™K L
return
¨¨ 
Ok
¨¨ 
(
¨¨ 
new
¨¨ 
{
≠≠ 	
token
ÆÆ 
,
ÆÆ 
username
ØØ 
=
ØØ 
$str
ØØ 
,
ØØ  
roles
∞∞ 
=
∞∞ 
WriterRoles
∞∞ 
,
∞∞  
permissions
±± 
=
±± 
WriterPermissions
±± +
,
±±+ ,
	expiresAt
≤≤ 
=
≤≤ 
DateTime
≤≤  
.
≤≤  !
UtcNow
≤≤! '
.
≤≤' (
AddHours
≤≤( 0
(
≤≤0 1
$num
≤≤1 2
)
≤≤2 3
,
≤≤3 4
}
≥≥ 	
)
≥≥	 

;
≥≥
 
}
¥¥ 
[
ππ 
HttpPost
ππ 
(
ππ 
$str
ππ 
)
ππ 
]
ππ 
[
∫∫ "
ProducesResponseType
∫∫ 
(
∫∫ 
typeof
∫∫  
(
∫∫  !
object
∫∫! '
)
∫∫' (
,
∫∫( )
$num
∫∫* -
)
∫∫- .
]
∫∫. /
[
ªª "
ProducesResponseType
ªª 
(
ªª 
$num
ªª 
)
ªª 
]
ªª 
public
ºº 

IActionResult
ºº 
ValidateToken
ºº &
(
ºº& '
[
ºº' (
FromBody
ºº( 0
]
ºº0 1

Dictionary
ºº2 <
<
ºº< =
string
ºº= C
,
ººC D
string
ººE K
>
ººK L
request
ººM T
)
ººT U
{
ΩΩ #
ArgumentNullException
ææ 
.
ææ 
ThrowIfNull
ææ )
(
ææ) *
request
ææ* 1
)
ææ1 2
;
ææ2 3
if
¿¿ 

(
¿¿ 
!
¿¿ 
request
¿¿ 
.
¿¿ 
TryGetValue
¿¿  
(
¿¿  !
$str
¿¿! (
,
¿¿( )
out
¿¿* -
var
¿¿. 1
token
¿¿2 7
)
¿¿7 8
)
¿¿8 9
{
¡¡ 	
return
¬¬ 

BadRequest
¬¬ 
(
¬¬ 
$str
¬¬ 1
)
¬¬1 2
;
¬¬2 3
}
√√ 	
try
≈≈ 
{
∆∆ 	
var
«« 
isValid
«« 
=
«« 
this
«« 
.
«« 

jwtService
«« )
.
««) *
ValidateToken
««* 7
(
««7 8
token
««8 =
)
««= >
;
««> ?
var
»» 
username
»» 
=
»» 

JwtService
»» %
.
»»% &
ExtractUsername
»»& 5
(
»»5 6
token
»»6 ;
)
»»; <
;
»»< =
var
…… 
roles
…… 
=
…… 

JwtService
…… "
.
……" #
ExtractRoles
……# /
(
……/ 0
token
……0 5
)
……5 6
;
……6 7
var
   
permissions
   
=
   

JwtService
   (
.
  ( ) 
ExtractPermissions
  ) ;
(
  ; <
token
  < A
)
  A B
;
  B C
return
ÃÃ 
Ok
ÃÃ 
(
ÃÃ 
new
ÃÃ 
{
ÕÕ 
valid
ŒŒ 
=
ŒŒ 
isValid
ŒŒ 
,
ŒŒ  
username
œœ 
,
œœ 
roles
–– 
,
–– 
permissions
—— 
,
—— 
validatedAt
““ 
=
““ 
DateTime
““ &
.
““& '
UtcNow
““' -
,
““- .
}
”” 
)
”” 
;
”” 
}
‘‘ 	
catch
’’ 
(
’’ 
	Exception
’’ 
ex
’’ 
)
’’ 
{
÷÷ 	
return
◊◊ 
Ok
◊◊ 
(
◊◊ 
new
◊◊ 
{
ÿÿ 
valid
ŸŸ 
=
ŸŸ 
false
ŸŸ 
,
ŸŸ 
error
⁄⁄ 
=
⁄⁄ 
ex
⁄⁄ 
.
⁄⁄ 
Message
⁄⁄ "
,
⁄⁄" #
validatedAt
€€ 
=
€€ 
DateTime
€€ &
.
€€& '
UtcNow
€€' -
,
€€- .
}
‹‹ 
)
‹‹ 
;
‹‹ 
}
›› 	
}
ﬁﬁ 
}ﬂﬂ Ë‰
d/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/EnhancedAuthTestController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
[ 
Tags 
( 
$str #
)# $
]$ %
public 
class &
EnhancedAuthTestController '
:( )
ControllerBase* 8
{ 
private 
const 
string 
UnknownValue %
=& '
$str( 1
;1 2
private 
static 
readonly 
string "
[" #
]# $
NonePermissions% 4
=5 6
{7 8
$str9 ?
}@ A
;A B
private 
static 
readonly 
string "
[" #
]# $
BasicPermissions% 5
=6 7
{8 9
$str: H
}I J
;J K
private 
static 
readonly 
string "
[" #
]# $
UserPermissions% 4
=5 6
{7 8
$str9 F
,F G
$strH S
}T U
;U V
private 
static 
readonly 
string "
[" #
]# $
AdminPermissions% 5
=6 7
{8 9
$str: H
,H I
$strJ V
,V W
$strX e
}f g
;g h
private 
static 
readonly 
string "
[" #
]# $!
ManagementPermissions% :
=; <
{= >
$str? R
,R S
$strT f
}g h
;h i
private 
static 
readonly 
string "
[" #
]# $'
IdentityProviderPermissions% @
=A B
{C D
$strE _
}` a
;a b
private 
static 
readonly 
string "
[" #
]# $
HighAuthPermissions% 8
=9 :
{; <
$str= O
}P Q
;Q R
private 
static 
readonly 
string "
[" #
]# $
	NoneRoles% .
=/ 0
{1 2
$str3 9
}: ;
;; <
private 
const 
string 
PermissionClaimType ,
=- .
$str/ ;
;; <
public   
&
EnhancedAuthTestController   %
(  % &
)  & '
{!! 
}"" 
['' 
HttpGet'' 
('' 
$str'' 
)'' 
]'' 
[(( 
AllowAnonymous(( 
](( 
[))  
ProducesResponseType)) 
()) 
typeof))  
())  !
object))! '
)))' (
,))( )
$num))* -
)))- .
])). /
public** 

IActionResult** 
PublicEndpoint** '
(**' (
)**( )
{++ 
return,, 
Ok,, 
(,, 
new,, 
{-- 	
level.. 
=.. 
$num.. 
,.. 
message// 
=// 
$str// D
,//D E
	timestamp00 
=00 
DateTime00  
.00  !
UtcNow00! '
,00' (
user11 
=11 
UnknownValue11 
,11  
roles22 
=22 
	NoneRoles22 
,22 
permissions33 
=33 
NonePermissions33 )
,33) *
}44 	
)44	 

;44
 
}55 
[:: 
HttpGet:: 
(:: 
$str:: 
):: 
]:: 
[;; 
	Authorize;; 
];; 
[<<  
ProducesResponseType<< 
(<< 
typeof<<  
(<<  !
object<<! '
)<<' (
,<<( )
$num<<* -
)<<- .
]<<. /
public== 

IActionResult== !
AuthenticatedEndpoint== .
(==. /
)==/ 0
{>> 
var?? 
user?? 
=?? 
this?? 
.?? 
User?? 
.?? 
Identity?? %
???% &
.??& '
Name??' +
????, .
UnknownValue??/ ;
;??; <
var@@ 
roles@@ 
=@@ 
this@@ 
.@@ 
User@@ 
.@@ 
Claims@@ $
.AA 
WhereAA 
(AA 
cAA 
=>AA 
cAA 
.AA 
TypeAA 
==AA !

ClaimTypesAA" ,
.AA, -
RoleAA- 1
)AA1 2
.BB 
SelectBB 
(BB 
cBB 
=>BB 
cBB 
.BB 
ValueBB  
)BB  !
.CC 
ToArrayCC 
(CC 
)CC 
;CC 
returnEE 
OkEE 
(EE 
newEE 
{FF 	
levelGG 
=GG 
$numGG 
,GG 
messageHH 
=HH 
$strHH N
,HHN O
	timestampII 
=II 
DateTimeII  
.II  !
UtcNowII! '
,II' (
userJJ 
,JJ 
rolesKK 
,KK 
permissionsLL 
=LL 
BasicPermissionsLL *
,LL* +
}MM 	
)MM	 

;MM
 
}NN 
[SS 
HttpGetSS 
(SS 
$strSS 
)SS 
]SS 
[TT 
	AuthorizeTT 
(TT 
RolesTT 
=TT 
$strTT 
)TT 
]TT 
[UU  
ProducesResponseTypeUU 
(UU 
typeofUU  
(UU  !
objectUU! '
)UU' (
,UU( )
$numUU* -
)UU- .
]UU. /
publicVV 

IActionResultVV 
UserRoleEndpointVV )
(VV) *
)VV* +
{WW 
varXX 
userXX 
=XX 
thisXX 
.XX 
UserXX 
.XX 
IdentityXX %
?XX% &
.XX& '
NameXX' +
??XX, .
UnknownValueXX/ ;
;XX; <
varYY 
rolesYY 
=YY 
thisYY 
.YY 
UserYY 
.YY 
ClaimsYY $
.ZZ 
WhereZZ 
(ZZ 
cZZ 
=>ZZ 
cZZ 
.ZZ 
TypeZZ 
==ZZ !

ClaimTypesZZ" ,
.ZZ, -
RoleZZ- 1
)ZZ1 2
.[[ 
Select[[ 
([[ 
c[[ 
=>[[ 
c[[ 
.[[ 
Value[[  
)[[  !
.\\ 
ToArray\\ 
(\\ 
)\\ 
;\\ 
return^^ 
Ok^^ 
(^^ 
new^^ 
{__ 	
level`` 
=`` 
$num`` 
,`` 
messageaa 
=aa 
$straa ?
,aa? @
	timestampbb 
=bb 
DateTimebb  
.bb  !
UtcNowbb! '
,bb' (
usercc 
,cc 
rolesdd 
,dd 
permissionsee 
=ee 
UserPermissionsee )
,ee) *
}ff 	
)ff	 

;ff
 
}gg 
[ll 
HttpGetll 
(ll 
$strll 
)ll 
]ll 
[mm 
	Authorizemm 
(mm 
Rolesmm 
=mm 
$strmm 
)mm 
]mm  
[nn  
ProducesResponseTypenn 
(nn 
typeofnn  
(nn  !
objectnn! '
)nn' (
,nn( )
$numnn* -
)nn- .
]nn. /
publicoo 

IActionResultoo 
AdminRoleEndpointoo *
(oo* +
)oo+ ,
{pp 
varqq 
userqq 
=qq 
thisqq 
.qq 
Userqq 
.qq 
Identityqq %
?qq% &
.qq& '
Nameqq' +
??qq, .
UnknownValueqq/ ;
;qq; <
varrr 
rolesrr 
=rr 
thisrr 
.rr 
Userrr 
.rr 
Claimsrr $
.ss 
Wheress 
(ss 
css 
=>ss 
css 
.ss 
Typess 
==ss !

ClaimTypesss" ,
.ss, -
Roless- 1
)ss1 2
.tt 
Selecttt 
(tt 
ctt 
=>tt 
ctt 
.tt 
Valuett  
)tt  !
.uu 
ToArrayuu 
(uu 
)uu 
;uu 
returnww 
Okww 
(ww 
newww 
{xx 	
levelyy 
=yy 
$numyy 
,yy 
messagezz 
=zz 
$strzz A
,zzA B
	timestamp{{ 
={{ 
DateTime{{  
.{{  !
UtcNow{{! '
,{{' (
user|| 
,|| 
roles}} 
,}} 
permissions~~ 
=~~ 
AdminPermissions~~ *
,~~* +
} 	
)	 

;
 
}
ÄÄ 
[
ÖÖ 
HttpGet
ÖÖ 
(
ÖÖ 
$str
ÖÖ 
)
ÖÖ 
]
ÖÖ 
[
ÜÜ 
	Authorize
ÜÜ 
(
ÜÜ 
Policy
ÜÜ 
=
ÜÜ 
$str
ÜÜ )
)
ÜÜ) *
]
ÜÜ* +
[
áá "
ProducesResponseType
áá 
(
áá 
typeof
áá  
(
áá  !
object
áá! '
)
áá' (
,
áá( )
$num
áá* -
)
áá- .
]
áá. /
public
àà 

IActionResult
àà 
CacheReadEndpoint
àà *
(
àà* +
)
àà+ ,
{
ââ 
var
ää 
user
ää 
=
ää 
this
ää 
.
ää 
User
ää 
.
ää 
Identity
ää %
?
ää% &
.
ää& '
Name
ää' +
??
ää, .
UnknownValue
ää/ ;
;
ää; <
var
ãã 
roles
ãã 
=
ãã 
this
ãã 
.
ãã 
User
ãã 
.
ãã 
Claims
ãã $
.
åå 
Where
åå 
(
åå 
c
åå 
=>
åå 
c
åå 
.
åå 
Type
åå 
==
åå !

ClaimTypes
åå" ,
.
åå, -
Role
åå- 1
)
åå1 2
.
çç 
Select
çç 
(
çç 
c
çç 
=>
çç 
c
çç 
.
çç 
Value
çç  
)
çç  !
.
éé 
ToArray
éé 
(
éé 
)
éé 
;
éé 
var
èè 
permissions
èè 
=
èè 
this
èè 
.
èè 
User
èè #
.
èè# $
Claims
èè$ *
.
êê 
Where
êê 
(
êê 
c
êê 
=>
êê 
c
êê 
.
êê 
Type
êê 
==
êê !!
PermissionClaimType
êê" 5
)
êê5 6
.
ëë 
Select
ëë 
(
ëë 
c
ëë 
=>
ëë 
c
ëë 
.
ëë 
Value
ëë  
)
ëë  !
.
íí 
ToArray
íí 
(
íí 
)
íí 
;
íí 
return
îî 
Ok
îî 
(
îî 
new
îî 
{
ïï 	
level
ññ 
=
ññ 
$num
ññ 
,
ññ 
message
óó 
=
óó 
$str
óó L
,
óóL M
	timestamp
òò 
=
òò 
DateTime
òò  
.
òò  !
UtcNow
òò! '
,
òò' (
user
ôô 
,
ôô 
roles
öö 
,
öö 
permissions
õõ 
,
õõ 
}
úú 	
)
úú	 

;
úú
 
}
ùù 
[
¢¢ 
HttpGet
¢¢ 
(
¢¢ 
$str
¢¢ 
)
¢¢ 
]
¢¢ 
[
££ 
	Authorize
££ 
(
££ 
Policy
££ 
=
££ 
$str
££ *
)
££* +
]
££+ ,
[
§§ "
ProducesResponseType
§§ 
(
§§ 
typeof
§§  
(
§§  !
object
§§! '
)
§§' (
,
§§( )
$num
§§* -
)
§§- .
]
§§. /
public
•• 

IActionResult
••  
CacheWriteEndpoint
•• +
(
••+ ,
)
••, -
{
¶¶ 
var
ßß 
user
ßß 
=
ßß 
this
ßß 
.
ßß 
User
ßß 
.
ßß 
Identity
ßß %
?
ßß% &
.
ßß& '
Name
ßß' +
??
ßß, .
UnknownValue
ßß/ ;
;
ßß; <
var
®® 
roles
®® 
=
®® 
this
®® 
.
®® 
User
®® 
.
®® 
Claims
®® $
.
©© 
Where
©© 
(
©© 
c
©© 
=>
©© 
c
©© 
.
©© 
Type
©© 
==
©© !

ClaimTypes
©©" ,
.
©©, -
Role
©©- 1
)
©©1 2
.
™™ 
Select
™™ 
(
™™ 
c
™™ 
=>
™™ 
c
™™ 
.
™™ 
Value
™™  
)
™™  !
.
´´ 
ToArray
´´ 
(
´´ 
)
´´ 
;
´´ 
var
¨¨ 
permissions
¨¨ 
=
¨¨ 
this
¨¨ 
.
¨¨ 
User
¨¨ #
.
¨¨# $
Claims
¨¨$ *
.
≠≠ 
Where
≠≠ 
(
≠≠ 
c
≠≠ 
=>
≠≠ 
c
≠≠ 
.
≠≠ 
Type
≠≠ 
==
≠≠ !!
PermissionClaimType
≠≠" 5
)
≠≠5 6
.
ÆÆ 
Select
ÆÆ 
(
ÆÆ 
c
ÆÆ 
=>
ÆÆ 
c
ÆÆ 
.
ÆÆ 
Value
ÆÆ  
)
ÆÆ  !
.
ØØ 
ToArray
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
return
±± 
Ok
±± 
(
±± 
new
±± 
{
≤≤ 	
level
≥≥ 
=
≥≥ 
$num
≥≥ 
,
≥≥ 
message
¥¥ 
=
¥¥ 
$str
¥¥ N
,
¥¥N O
	timestamp
µµ 
=
µµ 
DateTime
µµ  
.
µµ  !
UtcNow
µµ! '
,
µµ' (
user
∂∂ 
,
∂∂ 
roles
∑∑ 
,
∑∑ 
permissions
∏∏ 
,
∏∏ 
}
ππ 	
)
ππ	 

;
ππ
 
}
∫∫ 
[
øø 
HttpGet
øø 
(
øø 
$str
øø 
)
øø  
]
øø  !
[
¿¿ 
	Authorize
¿¿ 
(
¿¿ 
Roles
¿¿ 
=
¿¿ 
$str
¿¿ &
)
¿¿& '
]
¿¿' (
[
¡¡ "
ProducesResponseType
¡¡ 
(
¡¡ 
typeof
¡¡  
(
¡¡  !
object
¡¡! '
)
¡¡' (
,
¡¡( )
$num
¡¡* -
)
¡¡- .
]
¡¡. /
public
¬¬ 

IActionResult
¬¬ $
AdminOrManagerEndpoint
¬¬ /
(
¬¬/ 0
)
¬¬0 1
{
√√ 
var
ƒƒ 
user
ƒƒ 
=
ƒƒ 
this
ƒƒ 
.
ƒƒ 
User
ƒƒ 
.
ƒƒ 
Identity
ƒƒ %
?
ƒƒ% &
.
ƒƒ& '
Name
ƒƒ' +
??
ƒƒ, .
UnknownValue
ƒƒ/ ;
;
ƒƒ; <
var
≈≈ 
roles
≈≈ 
=
≈≈ 
this
≈≈ 
.
≈≈ 
User
≈≈ 
.
≈≈ 
Claims
≈≈ $
.
∆∆ 
Where
∆∆ 
(
∆∆ 
c
∆∆ 
=>
∆∆ 
c
∆∆ 
.
∆∆ 
Type
∆∆ 
==
∆∆ !

ClaimTypes
∆∆" ,
.
∆∆, -
Role
∆∆- 1
)
∆∆1 2
.
«« 
Select
«« 
(
«« 
c
«« 
=>
«« 
c
«« 
.
«« 
Value
««  
)
««  !
.
»» 
ToArray
»» 
(
»» 
)
»» 
;
»» 
return
   
Ok
   
(
   
new
   
{
ÀÀ 	
level
ÃÃ 
=
ÃÃ 
$num
ÃÃ 
,
ÃÃ 
message
ÕÕ 
=
ÕÕ 
$str
ÕÕ R
,
ÕÕR S
	timestamp
ŒŒ 
=
ŒŒ 
DateTime
ŒŒ  
.
ŒŒ  !
UtcNow
ŒŒ! '
,
ŒŒ' (
user
œœ 
,
œœ 
roles
–– 
,
–– 
permissions
—— 
=
—— #
ManagementPermissions
—— /
,
——/ 0
}
““ 	
)
““	 

;
““
 
}
”” 
[
ÿÿ 
HttpGet
ÿÿ 
(
ÿÿ 
$str
ÿÿ  
)
ÿÿ  !
]
ÿÿ! "
[
ŸŸ 
	Authorize
ŸŸ 
(
ŸŸ 
Roles
ŸŸ 
=
ŸŸ 
$str
ŸŸ 
,
ŸŸ 
Policy
ŸŸ  &
=
ŸŸ' (
$str
ŸŸ) ;
)
ŸŸ; <
]
ŸŸ< =
[
⁄⁄ "
ProducesResponseType
⁄⁄ 
(
⁄⁄ 
typeof
⁄⁄  
(
⁄⁄  !
object
⁄⁄! '
)
⁄⁄' (
,
⁄⁄( )
$num
⁄⁄* -
)
⁄⁄- .
]
⁄⁄. /
public
€€ 

IActionResult
€€ %
AdminCacheWriteEndpoint
€€ 0
(
€€0 1
)
€€1 2
{
‹‹ 
var
›› 
user
›› 
=
›› 
this
›› 
.
›› 
User
›› 
.
›› 
Identity
›› %
?
››% &
.
››& '
Name
››' +
??
››, .
UnknownValue
››/ ;
;
››; <
var
ﬁﬁ 
roles
ﬁﬁ 
=
ﬁﬁ 
this
ﬁﬁ 
.
ﬁﬁ 
User
ﬁﬁ 
.
ﬁﬁ 
Claims
ﬁﬁ $
.
ﬂﬂ 
Where
ﬂﬂ 
(
ﬂﬂ 
c
ﬂﬂ 
=>
ﬂﬂ 
c
ﬂﬂ 
.
ﬂﬂ 
Type
ﬂﬂ 
==
ﬂﬂ !

ClaimTypes
ﬂﬂ" ,
.
ﬂﬂ, -
Role
ﬂﬂ- 1
)
ﬂﬂ1 2
.
‡‡ 
Select
‡‡ 
(
‡‡ 
c
‡‡ 
=>
‡‡ 
c
‡‡ 
.
‡‡ 
Value
‡‡  
)
‡‡  !
.
·· 
ToArray
·· 
(
·· 
)
·· 
;
·· 
var
‚‚ 
permissions
‚‚ 
=
‚‚ 
this
‚‚ 
.
‚‚ 
User
‚‚ #
.
‚‚# $
Claims
‚‚$ *
.
„„ 
Where
„„ 
(
„„ 
c
„„ 
=>
„„ 
c
„„ 
.
„„ 
Type
„„ 
==
„„ !!
PermissionClaimType
„„" 5
)
„„5 6
.
‰‰ 
Select
‰‰ 
(
‰‰ 
c
‰‰ 
=>
‰‰ 
c
‰‰ 
.
‰‰ 
Value
‰‰  
)
‰‰  !
.
ÂÂ 
ToArray
ÂÂ 
(
ÂÂ 
)
ÂÂ 
;
ÂÂ 
return
ÁÁ 
Ok
ÁÁ 
(
ÁÁ 
new
ÁÁ 
{
ËË 	
level
ÈÈ 
=
ÈÈ 
$num
ÈÈ 
,
ÈÈ 
message
ÍÍ 
=
ÍÍ 
$str
ÍÍ c
,
ÍÍc d
	timestamp
ÎÎ 
=
ÎÎ 
DateTime
ÎÎ  
.
ÎÎ  !
UtcNow
ÎÎ! '
,
ÎÎ' (
user
ÏÏ 
,
ÏÏ 
roles
ÌÌ 
,
ÌÌ 
permissions
ÓÓ 
,
ÓÓ 
}
ÔÔ 	
)
ÔÔ	 

;
ÔÔ
 
}
 
[
ıı 
HttpGet
ıı 
(
ıı 
$str
ıı  
)
ıı  !
]
ıı! "
[
ˆˆ 
	Authorize
ˆˆ 
(
ˆˆ 
Policy
ˆˆ 
=
ˆˆ 
$str
ˆˆ 0
)
ˆˆ0 1
]
ˆˆ1 2
[
˜˜ "
ProducesResponseType
˜˜ 
(
˜˜ 
typeof
˜˜  
(
˜˜  !
object
˜˜! '
)
˜˜' (
,
˜˜( )
$num
˜˜* -
)
˜˜- .
]
˜˜. /
public
¯¯ 

IActionResult
¯¯ &
IdentityProviderEndpoint
¯¯ 1
(
¯¯1 2
)
¯¯2 3
{
˘˘ 
var
˙˙ 
user
˙˙ 
=
˙˙ 
this
˙˙ 
.
˙˙ 
User
˙˙ 
.
˙˙ 
Identity
˙˙ %
?
˙˙% &
.
˙˙& '
Name
˙˙' +
??
˙˙, .
UnknownValue
˙˙/ ;
;
˙˙; <
var
˚˚ 
roles
˚˚ 
=
˚˚ 
this
˚˚ 
.
˚˚ 
User
˚˚ 
.
˚˚ 
Claims
˚˚ $
.
¸¸ 
Where
¸¸ 
(
¸¸ 
c
¸¸ 
=>
¸¸ 
c
¸¸ 
.
¸¸ 
Type
¸¸ 
==
¸¸ !

ClaimTypes
¸¸" ,
.
¸¸, -
Role
¸¸- 1
)
¸¸1 2
.
˝˝ 
Select
˝˝ 
(
˝˝ 
c
˝˝ 
=>
˝˝ 
c
˝˝ 
.
˝˝ 
Value
˝˝  
)
˝˝  !
.
˛˛ 
ToArray
˛˛ 
(
˛˛ 
)
˛˛ 
;
˛˛ 
var
ˇˇ 
identityProvider
ˇˇ 
=
ˇˇ 
this
ˇˇ #
.
ˇˇ# $
User
ˇˇ$ (
.
ˇˇ( )
Claims
ˇˇ) /
.
ÄÄ 
FirstOrDefault
ÄÄ 
(
ÄÄ 
c
ÄÄ 
=>
ÄÄ  
c
ÄÄ! "
.
ÄÄ" #
Type
ÄÄ# '
==
ÄÄ( *
$str
ÄÄ+ >
)
ÄÄ> ?
?
ÄÄ? @
.
ÄÄ@ A
Value
ÄÄA F
??
ÄÄG I
UnknownValue
ÄÄJ V
;
ÄÄV W
return
ÇÇ 
Ok
ÇÇ 
(
ÇÇ 
new
ÇÇ 
{
ÉÉ 	
level
ÑÑ 
=
ÑÑ 
$num
ÑÑ 
,
ÑÑ 
message
ÖÖ 
=
ÖÖ 
$str
ÖÖ X
,
ÖÖX Y
	timestamp
ÜÜ 
=
ÜÜ 
DateTime
ÜÜ  
.
ÜÜ  !
UtcNow
ÜÜ! '
,
ÜÜ' (
user
áá 
,
áá 
roles
àà 
,
àà 
identityProvider
ââ 
,
ââ 
permissions
ää 
=
ää )
IdentityProviderPermissions
ää 5
,
ää5 6
}
ãã 	
)
ãã	 

;
ãã
 
}
åå 
[
ëë 
HttpGet
ëë 
(
ëë 
$str
ëë 
)
ëë 
]
ëë 
[
íí 
	Authorize
íí 
(
íí 
Policy
íí 
=
íí 
$str
íí )
)
íí) *
]
íí* +
[
ìì "
ProducesResponseType
ìì 
(
ìì 
typeof
ìì  
(
ìì  !
object
ìì! '
)
ìì' (
,
ìì( )
$num
ìì* -
)
ìì- .
]
ìì. /
public
îî 

IActionResult
îî 
AuthLevelEndpoint
îî *
(
îî* +
)
îî+ ,
{
ïï 
var
ññ 
user
ññ 
=
ññ 
this
ññ 
.
ññ 
User
ññ 
.
ññ 
Identity
ññ %
?
ññ% &
.
ññ& '
Name
ññ' +
??
ññ, .
UnknownValue
ññ/ ;
;
ññ; <
var
óó 
roles
óó 
=
óó 
this
óó 
.
óó 
User
óó 
.
óó 
Claims
óó $
.
òò 
Where
òò 
(
òò 
c
òò 
=>
òò 
c
òò 
.
òò 
Type
òò 
==
òò !

ClaimTypes
òò" ,
.
òò, -
Role
òò- 1
)
òò1 2
.
ôô 
Select
ôô 
(
ôô 
c
ôô 
=>
ôô 
c
ôô 
.
ôô 
Value
ôô  
)
ôô  !
.
öö 
ToArray
öö 
(
öö 
)
öö 
;
öö 
var
õõ 
	authLevel
õõ 
=
õõ 
this
õõ 
.
õõ 
User
õõ !
.
õõ! "
Claims
õõ" (
.
úú 
FirstOrDefault
úú 
(
úú 
c
úú 
=>
úú  
c
úú! "
.
úú" #
Type
úú# '
==
úú( *
$str
úú+ 7
)
úú7 8
?
úú8 9
.
úú9 :
Value
úú: ?
??
úú@ B
UnknownValue
úúC O
;
úúO P
return
ûû 
Ok
ûû 
(
ûû 
new
ûû 
{
üü 	
level
†† 
=
†† 
$num
†† 
,
†† 
message
°° 
=
°° 
$str
°° T
,
°°T U
	timestamp
¢¢ 
=
¢¢ 
DateTime
¢¢  
.
¢¢  !
UtcNow
¢¢! '
,
¢¢' (
user
££ 
,
££ 
roles
§§ 
,
§§ 
	authLevel
•• 
,
•• 
permissions
¶¶ 
=
¶¶ !
HighAuthPermissions
¶¶ -
,
¶¶- .
}
ßß 	
)
ßß	 

;
ßß
 
}
®® 
[
≠≠ 
HttpGet
≠≠ 
(
≠≠ 
$str
≠≠ 
)
≠≠  
]
≠≠  !
[
ÆÆ 
	Authorize
ÆÆ 
(
ÆÆ 
Roles
ÆÆ 
=
ÆÆ 
$str
ÆÆ 
,
ÆÆ 
Policy
ÆÆ  &
=
ÆÆ' (
$str
ÆÆ) b
)
ÆÆb c
]
ÆÆc d
[
ØØ "
ProducesResponseType
ØØ 
(
ØØ 
typeof
ØØ  
(
ØØ  !
object
ØØ! '
)
ØØ' (
,
ØØ( )
$num
ØØ* -
)
ØØ- .
]
ØØ. /
public
∞∞ 

IActionResult
∞∞ %
MaximumSecurityEndpoint
∞∞ 0
(
∞∞0 1
)
∞∞1 2
{
±± 
var
≤≤ 
user
≤≤ 
=
≤≤ 
this
≤≤ 
.
≤≤ 
User
≤≤ 
.
≤≤ 
Identity
≤≤ %
?
≤≤% &
.
≤≤& '
Name
≤≤' +
??
≤≤, .
UnknownValue
≤≤/ ;
;
≤≤; <
var
≥≥ 
roles
≥≥ 
=
≥≥ 
this
≥≥ 
.
≥≥ 
User
≥≥ 
.
≥≥ 
Claims
≥≥ $
.
¥¥ 
Where
¥¥ 
(
¥¥ 
c
¥¥ 
=>
¥¥ 
c
¥¥ 
.
¥¥ 
Type
¥¥ 
==
¥¥ !

ClaimTypes
¥¥" ,
.
¥¥, -
Role
¥¥- 1
)
¥¥1 2
.
µµ 
Select
µµ 
(
µµ 
c
µµ 
=>
µµ 
c
µµ 
.
µµ 
Value
µµ  
)
µµ  !
.
∂∂ 
ToArray
∂∂ 
(
∂∂ 
)
∂∂ 
;
∂∂ 
var
∑∑ 
permissions
∑∑ 
=
∑∑ 
this
∑∑ 
.
∑∑ 
User
∑∑ #
.
∑∑# $
Claims
∑∑$ *
.
∏∏ 
Where
∏∏ 
(
∏∏ 
c
∏∏ 
=>
∏∏ 
c
∏∏ 
.
∏∏ 
Type
∏∏ 
==
∏∏ !!
PermissionClaimType
∏∏" 5
)
∏∏5 6
.
ππ 
Select
ππ 
(
ππ 
c
ππ 
=>
ππ 
c
ππ 
.
ππ 
Value
ππ  
)
ππ  !
.
∫∫ 
ToArray
∫∫ 
(
∫∫ 
)
∫∫ 
;
∫∫ 
var
ªª 
identityProvider
ªª 
=
ªª 
this
ªª #
.
ªª# $
User
ªª$ (
.
ªª( )
Claims
ªª) /
.
ºº 
FirstOrDefault
ºº 
(
ºº 
c
ºº 
=>
ºº  
c
ºº! "
.
ºº" #
Type
ºº# '
==
ºº( *
$str
ºº+ >
)
ºº> ?
?
ºº? @
.
ºº@ A
Value
ººA F
??
ººG I
UnknownValue
ººJ V
;
ººV W
var
ΩΩ 
	authLevel
ΩΩ 
=
ΩΩ 
this
ΩΩ 
.
ΩΩ 
User
ΩΩ !
.
ΩΩ! "
Claims
ΩΩ" (
.
ææ 
FirstOrDefault
ææ 
(
ææ 
c
ææ 
=>
ææ  
c
ææ! "
.
ææ" #
Type
ææ# '
==
ææ( *
$str
ææ+ 7
)
ææ7 8
?
ææ8 9
.
ææ9 :
Value
ææ: ?
??
ææ@ B
UnknownValue
ææC O
;
ææO P
return
¿¿ 
Ok
¿¿ 
(
¿¿ 
new
¿¿ 
{
¡¡ 	
level
¬¬ 
=
¬¬ 
$num
¬¬ 
,
¬¬ 
message
√√ 
=
√√ 
$str
√√ R
,
√√R S
	timestamp
ƒƒ 
=
ƒƒ 
DateTime
ƒƒ  
.
ƒƒ  !
UtcNow
ƒƒ! '
,
ƒƒ' (
user
≈≈ 
,
≈≈ 
roles
∆∆ 
,
∆∆ 
permissions
«« 
,
«« 
identityProvider
»» 
,
»» 
	authLevel
…… 
,
…… 
}
   	
)
  	 

;
  
 
}
ÀÀ 
}ÃÃ ≠&
a/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Authorization/PermissionRequirement.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Authorization ,
;, -
public 
class !
PermissionRequirement "
:# $%
IAuthorizationRequirement% >
{ 
public 

string 

Permission 
{ 
get "
;" #
}$ %
public 
!
PermissionRequirement  
(  !
string! '

permission( 2
)2 3
{ 
this 
. 

Permission 
= 

permission $
??% '
throw( -
new. 1!
ArgumentNullException2 G
(G H
nameofH N
(N O

permissionO Y
)Y Z
)Z [
;[ \
} 
} 
public 
class $
AnyPermissionRequirement %
:& '%
IAuthorizationRequirement( A
{ 
public 

string 
[ 
] 
Permissions 
{  !
get" %
;% &
}' (
public 
$
AnyPermissionRequirement #
(# $
params$ *
string+ 1
[1 2
]2 3
permissions4 ?
)? @
{ 
this 
. 
Permissions 
= 
permissions &
??' )
throw* /
new0 3!
ArgumentNullException4 I
(I J
nameofJ P
(P Q
permissionsQ \
)\ ]
)] ^
;^ _
}   
}!! 
public&& 
class&& %
AllPermissionsRequirement&& &
:&&' (%
IAuthorizationRequirement&&) B
{'' 
public(( 

string(( 
[(( 
](( 
Permissions(( 
{((  !
get((" %
;((% &
}((' (
public** 
%
AllPermissionsRequirement** $
(**$ %
params**% +
string**, 2
[**2 3
]**3 4
permissions**5 @
)**@ A
{++ 
this,, 
.,, 
Permissions,, 
=,, 
permissions,, &
??,,' )
throw,,* /
new,,0 3!
ArgumentNullException,,4 I
(,,I J
nameof,,J P
(,,P Q
permissions,,Q \
),,\ ]
),,] ^
;,,^ _
}-- 
}.. 
public33 
class33  
AuthLevelRequirement33 !
:33" #%
IAuthorizationRequirement33$ =
{44 
public55 

string55 
RequiredAuthLevel55 #
{55$ %
get55& )
;55) *
}55+ ,
public77 
 
AuthLevelRequirement77 
(77  
string77  &
requiredAuthLevel77' 8
)778 9
{88 
this99 
.99 
RequiredAuthLevel99 
=99  
requiredAuthLevel99! 2
??993 5
throw996 ;
new99< ?!
ArgumentNullException99@ U
(99U V
nameof99V \
(99\ ]
requiredAuthLevel99] n
)99n o
)99o p
;99p q
}:: 
};; 
public@@ 
class@@ '
IdentityProviderRequirement@@ (
:@@) *%
IAuthorizationRequirement@@+ D
{AA 
publicBB 

stringBB $
RequiredIdentityProviderBB *
{BB+ ,
getBB- 0
;BB0 1
}BB2 3
publicDD 
'
IdentityProviderRequirementDD &
(DD& '
stringDD' -$
requiredIdentityProviderDD. F
)DDF G
{EE 
thisFF 
.FF $
RequiredIdentityProviderFF %
=FF& '$
requiredIdentityProviderFF( @
??FFA C
throwFFD I
newFFJ M!
ArgumentNullExceptionFFN c
(FFc d
nameofFFd j
(FFj k%
requiredIdentityProvider	FFk É
)
FFÉ Ñ
)
FFÑ Ö
;
FFÖ Ü
}GG 
}HH 
publicMM 
classMM 
RoleRequirementMM 
:MM %
IAuthorizationRequirementMM 8
{NN 
publicOO 

stringOO 
RoleOO 
{OO 
getOO 
;OO 
}OO 
publicQQ 

RoleRequirementQQ 
(QQ 
stringQQ !
roleQQ" &
)QQ& '
{RR 
thisSS 
.SS 
RoleSS 
=SS 
roleSS 
??SS 
throwSS !
newSS" %!
ArgumentNullExceptionSS& ;
(SS; <
nameofSS< B
(SSB C
roleSSC G
)SSG H
)SSH I
;SSI J
}TT 
}UU ÍF
]/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Authorization/PermissionHandler.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Authorization ,
;, -
internal 
class	 
PermissionHandler  
:! " 
AuthorizationHandler# 7
<7 8!
PermissionRequirement8 M
>M N
{ 
	protected 
override 
Task "
HandleRequirementAsync 2
(2 3'
AuthorizationHandlerContext3 N
contextO V
,V W!
PermissionRequirementX m
requirementn y
)y z
{ !
ArgumentNullException 
. 
ThrowIfNull )
() *
context* 1
)1 2
;2 3!
ArgumentNullException 
. 
ThrowIfNull )
() *
requirement* 5
)5 6
;6 7
var 
hasPermission 
= 
context #
.# $
User$ (
.( )
HasClaim) 1
(1 2
$str2 >
,> ?
requirement@ K
.K L

PermissionL V
)V W
;W X
if 

( 
hasPermission 
) 
{ 	
context 
. 
Succeed 
( 
requirement '
)' (
;( )
} 	
return 
Task 
. 
CompletedTask !
;! "
} 
} 
internal"" 
class""	  
AnyPermissionHandler"" #
:""$ % 
AuthorizationHandler""& :
<"": ;$
AnyPermissionRequirement""; S
>""S T
{## 
	protected$$ 
override$$ 
Task$$ "
HandleRequirementAsync$$ 2
($$2 3'
AuthorizationHandlerContext$$3 N
context$$O V
,$$V W$
AnyPermissionRequirement$$X p
requirement$$q |
)$$| }
{%% !
ArgumentNullException&& 
.&& 
ThrowIfNull&& )
(&&) *
context&&* 1
)&&1 2
;&&2 3!
ArgumentNullException'' 
.'' 
ThrowIfNull'' )
('') *
requirement''* 5
)''5 6
;''6 7
var)) 
hasAnyPermission)) 
=)) 
requirement)) *
.))* +
Permissions))+ 6
.))6 7
Any))7 :
()): ;

permission)); E
=>))F H
context** 
.** 
User** 
.** 
HasClaim** !
(**! "
$str**" .
,**. /

permission**0 :
)**: ;
)**; <
;**< =
if,, 

(,, 
hasAnyPermission,, 
),, 
{-- 	
context.. 
... 
Succeed.. 
(.. 
requirement.. '
)..' (
;..( )
}// 	
return11 
Task11 
.11 
CompletedTask11 !
;11! "
}22 
}33 
internal88 
class88	 !
AllPermissionsHandler88 $
:88% & 
AuthorizationHandler88' ;
<88; <%
AllPermissionsRequirement88< U
>88U V
{99 
	protected:: 
override:: 
Task:: "
HandleRequirementAsync:: 2
(::2 3'
AuthorizationHandlerContext::3 N
context::O V
,::V W%
AllPermissionsRequirement::X q
requirement::r }
)::} ~
{;; !
ArgumentNullException<< 
.<< 
ThrowIfNull<< )
(<<) *
context<<* 1
)<<1 2
;<<2 3!
ArgumentNullException== 
.== 
ThrowIfNull== )
(==) *
requirement==* 5
)==5 6
;==6 7
var?? 
hasAllPermissions?? 
=?? 
requirement??  +
.??+ ,
Permissions??, 7
.??7 8
All??8 ;
(??; <

permission??< F
=>??G I
context@@ 
.@@ 
User@@ 
.@@ 
HasClaim@@ !
(@@! "
$str@@" .
,@@. /

permission@@0 :
)@@: ;
)@@; <
;@@< =
ifBB 

(BB 
hasAllPermissionsBB 
)BB 
{CC 	
contextDD 
.DD 
SucceedDD 
(DD 
requirementDD '
)DD' (
;DD( )
}EE 	
returnGG 
TaskGG 
.GG 
CompletedTaskGG !
;GG! "
}HH 
}II 
internalNN 
classNN	 
RoleHandlerNN 
:NN  
AuthorizationHandlerNN 1
<NN1 2
RoleRequirementNN2 A
>NNA B
{OO 
	protectedPP 
overridePP 
TaskPP "
HandleRequirementAsyncPP 2
(PP2 3'
AuthorizationHandlerContextPP3 N
contextPPO V
,PPV W
RoleRequirementPPX g
requirementPPh s
)PPs t
{QQ !
ArgumentNullExceptionRR 
.RR 
ThrowIfNullRR )
(RR) *
contextRR* 1
)RR1 2
;RR2 3!
ArgumentNullExceptionSS 
.SS 
ThrowIfNullSS )
(SS) *
requirementSS* 5
)SS5 6
;SS6 7
varUU 
hasRoleUU 
=UU 
contextUU 
.UU 
UserUU "
.UU" #
IsInRoleUU# +
(UU+ ,
requirementUU, 7
.UU7 8
RoleUU8 <
)UU< =
;UU= >
ifWW 

(WW 
hasRoleWW 
)WW 
{XX 	
contextYY 
.YY 
SucceedYY 
(YY 
requirementYY '
)YY' (
;YY( )
}ZZ 	
return\\ 
Task\\ 
.\\ 
CompletedTask\\ !
;\\! "
}]] 
}^^ 
internalcc 
classcc	 #
IdentityProviderHandlercc &
:cc' ( 
AuthorizationHandlercc) =
<cc= >'
IdentityProviderRequirementcc> Y
>ccY Z
{dd 
	protectedee 
overrideee 
Taskee "
HandleRequirementAsyncee 2
(ee2 3'
AuthorizationHandlerContextee3 N
contexteeO V
,eeV W'
IdentityProviderRequirementeeX s
requirementeet 
)	ee Ä
{ff !
ArgumentNullExceptiongg 
.gg 
ThrowIfNullgg )
(gg) *
contextgg* 1
)gg1 2
;gg2 3!
ArgumentNullExceptionhh 
.hh 
ThrowIfNullhh )
(hh) *
requirementhh* 5
)hh5 6
;hh6 7
varjj 
identityProviderjj 
=jj 
contextjj &
.jj& '
Userjj' +
.jj+ ,
	FindFirstjj, 5
(jj5 6
$strjj6 I
)jjI J
?jjJ K
.jjK L
ValuejjL Q
;jjQ R
ifll 

(ll 
identityProviderll 
==ll 
requirementll  +
.ll+ ,$
RequiredIdentityProviderll, D
)llD E
{mm 	
contextnn 
.nn 
Succeednn 
(nn 
requirementnn '
)nn' (
;nn( )
}oo 	
returnqq 
Taskqq 
.qq 
CompletedTaskqq !
;qq! "
}rr 
}ss 
internalxx 
classxx	 
AuthLevelHandlerxx 
:xx  ! 
AuthorizationHandlerxx" 6
<xx6 7 
AuthLevelRequirementxx7 K
>xxK L
{yy 
	protectedzz 
overridezz 
Taskzz "
HandleRequirementAsynczz 2
(zz2 3'
AuthorizationHandlerContextzz3 N
contextzzO V
,zzV W 
AuthLevelRequirementzzX l
requirementzzm x
)zzx y
{{{ !
ArgumentNullException|| 
.|| 
ThrowIfNull|| )
(||) *
context||* 1
)||1 2
;||2 3!
ArgumentNullException}} 
.}} 
ThrowIfNull}} )
(}}) *
requirement}}* 5
)}}5 6
;}}6 7
var 
	authLevel 
= 
context 
.  
User  $
.$ %
	FindFirst% .
(. /
$str/ ;
); <
?< =
.= >
Value> C
;C D
if
ÅÅ 

(
ÅÅ 
	authLevel
ÅÅ 
==
ÅÅ 
requirement
ÅÅ $
.
ÅÅ$ %
RequiredAuthLevel
ÅÅ% 6
)
ÅÅ6 7
{
ÇÇ 	
context
ÉÉ 
.
ÉÉ 
Succeed
ÉÉ 
(
ÉÉ 
requirement
ÉÉ '
)
ÉÉ' (
;
ÉÉ( )
}
ÑÑ 	
return
ÜÜ 
Task
ÜÜ 
.
ÜÜ 
CompletedTask
ÜÜ !
;
ÜÜ! "
}
áá 
}àà 