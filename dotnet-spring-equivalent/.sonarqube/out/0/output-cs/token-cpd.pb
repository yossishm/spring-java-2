ºR
V/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Services/LocalRestClient.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Services '
;' (
public 
class 
LocalRestClient 
: 
IDisposable *
{ 
private 
readonly 

HttpClient 

httpClient  *
;* +
private 
readonly 
string 
server "
=# $
$str% <
;< =
public 

LocalRestClient 
( 
string !
authorization" /
=0 1
$str2 4
)4 5
{ 
this 
. 

httpClient 
= 
new 

HttpClient (
(( )
)) *
;* +
this 
. 

httpClient 
. !
DefaultRequestHeaders -
.- .
Add. 1
(1 2
$str2 @
,@ A
$strB T
)T U
;U V
this 
. 

httpClient 
. !
DefaultRequestHeaders -
.- .
Add. 1
(1 2
$str2 :
,: ;
$str< A
)A B
;B C
var 
	jwsHeader 
= 
Convert 
.  
ToBase64String  .
(. /
Encoding/ 7
.7 8
UTF88 <
.< =
GetBytes= E
(E F
$strF ]
)] ^
)^ _
;_ `
this 
. 

httpClient 
. !
DefaultRequestHeaders -
.- .
Add. 1
(1 2
	jwsHeader2 ;
,; <
authorization= J
)J K
;K L
} 
public   

async   
Task   
<   
string   
>   
GetAsync   &
(  & '
Uri  ' *
uri  + .
)  . /
{!! !
ArgumentNullException"" 
."" 
ThrowIfNull"" )
("") *
uri""* -
)""- .
;"". /
try$$ 
{%% 	
var&& 
response&& 
=&& 
await&&  
this&&! %
.&&% &

httpClient&&& 0
.&&0 1
GetAsync&&1 9
(&&9 :
new&&: =
Uri&&> A
(&&A B
this&&B F
.&&F G
server&&G M
+&&N O
uri&&P S
.&&S T
ToString&&T \
(&&\ ]
)&&] ^
)&&^ _
)&&_ `
.&&` a
ConfigureAwait&&a o
(&&o p
false&&p u
)&&u v
;&&v w
var'' 
content'' 
='' 
await'' 
response''  (
.''( )
Content'') 0
.''0 1
ReadAsStringAsync''1 B
(''B C
)''C D
.''D E
ConfigureAwait''E S
(''S T
false''T Y
)''Y Z
;''Z [
return(( 
content(( 
;(( 
})) 	
catch** 
(** 
	Exception** 
ex** 
)** 
{++ 	
throw,, 
new,,  
HttpRequestException,, *
(,,* +
$",,+ -
$str,,- A
{,,A B
ex,,B D
.,,D E
Message,,E L
},,L M
",,M N
,,,N O
ex,,P R
),,R S
;,,S T
}-- 	
}.. 
public33 

async33 
Task33 
<33 
string33 
>33 
	PostAsync33 '
(33' (
Uri33( +
uri33, /
,33/ 0
string331 7
json338 <
)33< =
{44 !
ArgumentNullException55 
.55 
ThrowIfNull55 )
(55) *
uri55* -
)55- .
;55. /!
ArgumentNullException66 
.66 
ThrowIfNull66 )
(66) *
json66* .
)66. /
;66/ 0
try88 
{99 	
using:: 
var:: 
content:: 
=:: 
new::  #
StringContent::$ 1
(::1 2
json::2 6
,::6 7
Encoding::8 @
.::@ A
UTF8::A E
,::E F
$str::G Y
)::Y Z
;::Z [
var;; 
response;; 
=;; 
await;;  
this;;! %
.;;% &

httpClient;;& 0
.;;0 1
	PostAsync;;1 :
(;;: ;
new;;; >
Uri;;? B
(;;B C
this;;C G
.;;G H
server;;H N
+;;O P
uri;;Q T
.;;T U
ToString;;U ]
(;;] ^
);;^ _
);;_ `
,;;` a
content;;b i
);;i j
.;;j k
ConfigureAwait;;k y
(;;y z
false;;z 
)	;; Ä
;
;;Ä Å
var<< 
responseContent<< 
=<<  !
await<<" '
response<<( 0
.<<0 1
Content<<1 8
.<<8 9
ReadAsStringAsync<<9 J
(<<J K
)<<K L
.<<L M
ConfigureAwait<<M [
(<<[ \
false<<\ a
)<<a b
;<<b c
return== 
responseContent== "
;==" #
}>> 	
catch?? 
(?? 
	Exception?? 
ex?? 
)?? 
{@@ 	
throwAA 
newAA  
HttpRequestExceptionAA *
(AA* +
$"AA+ -
$strAA- B
{AAB C
exAAC E
.AAE F
MessageAAF M
}AAM N
"AAN O
,AAO P
exAAQ S
)AAS T
;AAT U
}BB 	
}CC 
publicHH 

asyncHH 
TaskHH 
<HH 
stringHH 
>HH 
PutAsyncHH &
(HH& '
UriHH' *
uriHH+ .
,HH. /
stringHH0 6
jsonHH7 ;
)HH; <
{II !
ArgumentNullExceptionJJ 
.JJ 
ThrowIfNullJJ )
(JJ) *
uriJJ* -
)JJ- .
;JJ. /!
ArgumentNullExceptionKK 
.KK 
ThrowIfNullKK )
(KK) *
jsonKK* .
)KK. /
;KK/ 0
tryMM 
{NN 	
usingOO 
varOO 
contentOO 
=OO 
newOO  #
StringContentOO$ 1
(OO1 2
jsonOO2 6
,OO6 7
EncodingOO8 @
.OO@ A
UTF8OOA E
,OOE F
$strOOG Y
)OOY Z
;OOZ [
varPP 
responsePP 
=PP 
awaitPP  
thisPP! %
.PP% &

httpClientPP& 0
.PP0 1
PutAsyncPP1 9
(PP9 :
newPP: =
UriPP> A
(PPA B
thisPPB F
.PPF G
serverPPG M
+PPN O
uriPPP S
.PPS T
ToStringPPT \
(PP\ ]
)PP] ^
)PP^ _
,PP_ `
contentPPa h
)PPh i
.PPi j
ConfigureAwaitPPj x
(PPx y
falsePPy ~
)PP~ 
;	PP Ä
varQQ 
responseContentQQ 
=QQ  !
awaitQQ" '
responseQQ( 0
.QQ0 1
ContentQQ1 8
.QQ8 9
ReadAsStringAsyncQQ9 J
(QQJ K
)QQK L
.QQL M
ConfigureAwaitQQM [
(QQ[ \
falseQQ\ a
)QQa b
;QQb c
returnRR 
responseContentRR "
;RR" #
}SS 	
catchTT 
(TT 
	ExceptionTT 
exTT 
)TT 
{UU 	
throwVV 
newVV  
HttpRequestExceptionVV *
(VV* +
$"VV+ -
$strVV- A
{VVA B
exVVB D
.VVD E
MessageVVE L
}VVL M
"VVM N
,VVN O
exVVP R
)VVR S
;VVS T
}WW 	
}XX 
public]] 

async]] 
Task]] 
<]] 
string]] 
>]] 
DeleteAsync]] )
(]]) *
Uri]]* -
uri]]. 1
)]]1 2
{^^ !
ArgumentNullException__ 
.__ 
ThrowIfNull__ )
(__) *
uri__* -
)__- .
;__. /
tryaa 
{bb 	
varcc 
responsecc 
=cc 
awaitcc  
thiscc! %
.cc% &

httpClientcc& 0
.cc0 1
DeleteAsynccc1 <
(cc< =
newcc= @
UriccA D
(ccD E
thisccE I
.ccI J
serverccJ P
+ccQ R
uriccS V
.ccV W
ToStringccW _
(cc_ `
)cc` a
)cca b
)ccb c
.ccc d
ConfigureAwaitccd r
(ccr s
falseccs x
)ccx y
;ccy z
vardd 
contentdd 
=dd 
awaitdd 
responsedd  (
.dd( )
Contentdd) 0
.dd0 1
ReadAsStringAsyncdd1 B
(ddB C
)ddC D
.ddD E
ConfigureAwaitddE S
(ddS T
falseddT Y
)ddY Z
;ddZ [
returnee 
contentee 
;ee 
}ff 	
catchgg 
(gg 
	Exceptiongg 
exgg 
)gg 
{hh 	
throwii 
newii  
HttpRequestExceptionii *
(ii* +
$"ii+ -
$strii- D
{iiD E
exiiE G
.iiG H
MessageiiH O
}iiO P
"iiP Q
,iiQ R
exiiS U
)iiU V
;iiV W
}jj 	
}kk 
publicmm 

voidmm 
Disposemm 
(mm 
)mm 
{nn 
thisoo 
.oo 
Disposeoo 
(oo 
trueoo 
)oo 
;oo 
GCpp 

.pp
 
SuppressFinalizepp 
(pp 
thispp  
)pp  !
;pp! "
}qq 
	protectedss 
virtualss 
voidss 
Disposess "
(ss" #
boolss# '
	disposingss( 1
)ss1 2
{tt 
ifuu 

(uu 
	disposinguu 
)uu 
{vv 	
thisww 
.ww 

httpClientww 
?ww 
.ww 
Disposeww $
(ww$ %
)ww% &
;ww& '
}xx 	
}yy 
}zz äu
Q/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Services/JwtService.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Services '
;' (
public 
class 

JwtService 
{ 
private 
readonly 
string 
	secretKey %
;% &
private 
readonly 
int 
expirationHours (
;( )
public 


JwtService 
( 
IConfiguration $
configuration% 2
)2 3
{ 
this 
. 
	secretKey 
= 
configuration &
[& '
$str' 3
]3 4
??5 7
throw8 =
new> A%
InvalidOperationExceptionB [
([ \
$str\ {
){ |
;| }
this 
. 
expirationHours 
= 
int "
." #
Parse# (
(( )
configuration) 6
[6 7
$str7 L
]L M
??N P
$strQ U
,U V
SystemW ]
.] ^
Globalization^ k
.k l
CultureInfol w
.w x
InvariantCulture	x à
)
à â
;
â ä
} 
public 

static 
string 
ExtractUsername (
(( )
string) /
token0 5
)5 6
{   
try!! 
{"" 	
var## 
tokenHandler## 
=## 
new## "#
JwtSecurityTokenHandler### :
(##: ;
)##; <
;##< =
var$$ 
	jsonToken$$ 
=$$ 
tokenHandler$$ (
.$$( )
ReadJwtToken$$) 5
($$5 6
token$$6 ;
)$$; <
;$$< =
return%% 
	jsonToken%% 
.%% 
Claims%% #
.%%# $
FirstOrDefault%%$ 2
(%%2 3
x%%3 4
=>%%5 7
x%%8 9
.%%9 :
Type%%: >
==%%? A
$str%%B L
)%%L M
?%%M N
.%%N O
Value%%O T
??%%U W
string%%X ^
.%%^ _
Empty%%_ d
;%%d e
}&& 	
catch'' 
{(( 	
return)) 
string)) 
.)) 
Empty)) 
;))  
}** 	
}++ 
public00 

static00 
IReadOnlyList00 
<00  
string00  &
>00& '
ExtractRoles00( 4
(004 5
string005 ;
token00< A
)00A B
{11 
try22 
{33 	
var44 
tokenHandler44 
=44 
new44 "#
JwtSecurityTokenHandler44# :
(44: ;
)44; <
;44< =
var55 
	jsonToken55 
=55 
tokenHandler55 (
.55( )
ReadJwtToken55) 5
(555 6
token556 ;
)55; <
;55< =
return66 
	jsonToken66 
.66 
Claims66 #
.77 
Where77 
(77 
x77 
=>77 
x77 
.77 
Type77 "
==77# %

ClaimTypes77& 0
.770 1
Role771 5
)775 6
.88 
Select88 
(88 
x88 
=>88 
x88 
.88 
Value88 $
)88$ %
.99 
ToList99 
(99 
)99 
;99 
}:: 	
catch;; 
{<< 	
return== 
new== 
List== 
<== 
string== "
>==" #
(==# $
)==$ %
;==% &
}>> 	
}?? 
publicDD 

staticDD 
IReadOnlyListDD 
<DD  
stringDD  &
>DD& '
ExtractPermissionsDD( :
(DD: ;
stringDD; A
tokenDDB G
)DDG H
{EE 
tryFF 
{GG 	
varHH 
tokenHandlerHH 
=HH 
newHH "#
JwtSecurityTokenHandlerHH# :
(HH: ;
)HH; <
;HH< =
varII 
	jsonTokenII 
=II 
tokenHandlerII (
.II( )
ReadJwtTokenII) 5
(II5 6
tokenII6 ;
)II; <
;II< =
returnJJ 
	jsonTokenJJ 
.JJ 
ClaimsJJ #
.KK 
WhereKK 
(KK 
xKK 
=>KK 
xKK 
.KK 
TypeKK "
==KK# %
$strKK& 2
)KK2 3
.LL 
SelectLL 
(LL 
xLL 
=>LL 
xLL 
.LL 
ValueLL $
)LL$ %
.MM 
ToListMM 
(MM 
)MM 
;MM 
}NN 	
catchOO 
{PP 	
returnQQ 
newQQ 
ListQQ 
<QQ 
stringQQ "
>QQ" #
(QQ# $
)QQ$ %
;QQ% &
}RR 	
}SS 
publicXX 

staticXX 
stringXX 
ExtractAuthLevelXX )
(XX) *
stringXX* 0
tokenXX1 6
)XX6 7
{YY 
tryZZ 
{[[ 	
var\\ 
tokenHandler\\ 
=\\ 
new\\ "#
JwtSecurityTokenHandler\\# :
(\\: ;
)\\; <
;\\< =
var]] 
	jsonToken]] 
=]] 
tokenHandler]] (
.]]( )
ReadJwtToken]]) 5
(]]5 6
token]]6 ;
)]]; <
;]]< =
return^^ 
	jsonToken^^ 
.^^ 
Claims^^ #
.^^# $
FirstOrDefault^^$ 2
(^^2 3
x^^3 4
=>^^5 7
x^^8 9
.^^9 :
Type^^: >
==^^? A
$str^^B N
)^^N O
?^^O P
.^^P Q
Value^^Q V
??^^W Y
string^^Z `
.^^` a
Empty^^a f
;^^f g
}__ 	
catch`` 
{aa 	
returnbb 
stringbb 
.bb 
Emptybb 
;bb  
}cc 	
}dd 
publicii 

staticii 
stringii #
ExtractIdentityProviderii 0
(ii0 1
stringii1 7
tokenii8 =
)ii= >
{jj 
trykk 
{ll 	
varmm 
tokenHandlermm 
=mm 
newmm "#
JwtSecurityTokenHandlermm# :
(mm: ;
)mm; <
;mm< =
varnn 
	jsonTokennn 
=nn 
tokenHandlernn (
.nn( )
ReadJwtTokennn) 5
(nn5 6
tokennn6 ;
)nn; <
;nn< =
returnoo 
	jsonTokenoo 
.oo 
Claimsoo #
.oo# $
FirstOrDefaultoo$ 2
(oo2 3
xoo3 4
=>oo5 7
xoo8 9
.oo9 :
Typeoo: >
==oo? A
$strooB U
)ooU V
?ooV W
.ooW X
ValueooX ]
??oo^ `
stringooa g
.oog h
Emptyooh m
;oom n
}pp 	
catchqq 
{rr 	
returnss 
stringss 
.ss 
Emptyss 
;ss  
}tt 	
}uu 
publiczz 

staticzz 

Dictionaryzz 
<zz 
stringzz #
,zz# $
stringzz% +
>zz+ ,
ExtractAllClaimszz- =
(zz= >
stringzz> D
tokenzzE J
)zzJ K
{{{ 
try|| 
{}} 	
var~~ 
tokenHandler~~ 
=~~ 
new~~ "#
JwtSecurityTokenHandler~~# :
(~~: ;
)~~; <
;~~< =
var 
	jsonToken 
= 
tokenHandler (
.( )
ReadJwtToken) 5
(5 6
token6 ;
); <
;< =
return
ÄÄ 
	jsonToken
ÄÄ 
.
ÄÄ 
Claims
ÄÄ #
.
ÄÄ# $
ToDictionary
ÄÄ$ 0
(
ÄÄ0 1
x
ÄÄ1 2
=>
ÄÄ3 5
x
ÄÄ6 7
.
ÄÄ7 8
Type
ÄÄ8 <
,
ÄÄ< =
x
ÄÄ> ?
=>
ÄÄ@ B
x
ÄÄC D
.
ÄÄD E
Value
ÄÄE J
)
ÄÄJ K
;
ÄÄK L
}
ÅÅ 	
catch
ÇÇ 
{
ÉÉ 	
return
ÑÑ 
new
ÑÑ 

Dictionary
ÑÑ !
<
ÑÑ! "
string
ÑÑ" (
,
ÑÑ( )
string
ÑÑ* 0
>
ÑÑ0 1
(
ÑÑ1 2
)
ÑÑ2 3
;
ÑÑ3 4
}
ÖÖ 	
}
ÜÜ 
public
ãã 

string
ãã 
GenerateToken
ãã 
(
ãã  
string
ãã  &
username
ãã' /
,
ãã/ 0
IReadOnlyList
ãã1 >
<
ãã> ?
string
ãã? E
>
ããE F
roles
ããG L
,
ããL M
IReadOnlyList
ããN [
<
ãã[ \
string
ãã\ b
>
ããb c
permissions
ããd o
,
ãão p
string
åå 
	authLevel
åå 
=
åå 
$str
åå !
,
åå! "
string
åå# )
idp
åå* -
=
åå. /
$str
åå0 7
)
åå7 8
{
çç #
ArgumentNullException
éé 
.
éé 
ThrowIfNull
éé )
(
éé) *
username
éé* 2
)
éé2 3
;
éé3 4#
ArgumentNullException
èè 
.
èè 
ThrowIfNull
èè )
(
èè) *
roles
èè* /
)
èè/ 0
;
èè0 1#
ArgumentNullException
êê 
.
êê 
ThrowIfNull
êê )
(
êê) *
permissions
êê* 5
)
êê5 6
;
êê6 7
var
íí 
tokenHandler
íí 
=
íí 
new
íí %
JwtSecurityTokenHandler
íí 6
(
íí6 7
)
íí7 8
;
íí8 9
var
ìì 
key
ìì 
=
ìì 
Encoding
ìì 
.
ìì 
ASCII
ìì  
.
ìì  !
GetBytes
ìì! )
(
ìì) *
this
ìì* .
.
ìì. /
	secretKey
ìì/ 8
)
ìì8 9
;
ìì9 :
var
ïï 
claims
ïï 
=
ïï 
new
ïï 
List
ïï 
<
ïï 
Claim
ïï #
>
ïï# $
{
ññ 	
new
óó 
(
óó 

ClaimTypes
óó 
.
óó 
Name
óó 
,
óó  
username
óó! )
)
óó) *
,
óó* +
new
òò 
(
òò 
$str
òò 
,
òò 
username
òò $
)
òò$ %
,
òò% &
new
ôô 
(
ôô 
$str
ôô 
,
ôô 
	authLevel
ôô '
)
ôô' (
,
ôô( )
new
öö 
(
öö 
$str
öö #
,
öö# $
idp
öö% (
)
öö( )
,
öö) *
}
õõ 	
;
õõ	 

foreach
ûû 
(
ûû 
var
ûû 
role
ûû 
in
ûû 
roles
ûû "
)
ûû" #
{
üü 	
claims
†† 
.
†† 
Add
†† 
(
†† 
new
†† 
Claim
††  
(
††  !

ClaimTypes
††! +
.
††+ ,
Role
††, 0
,
††0 1
role
††2 6
)
††6 7
)
††7 8
;
††8 9
}
°° 	
foreach
§§ 
(
§§ 
var
§§ 

permission
§§ 
in
§§  "
permissions
§§# .
)
§§. /
{
•• 	
claims
¶¶ 
.
¶¶ 
Add
¶¶ 
(
¶¶ 
new
¶¶ 
Claim
¶¶  
(
¶¶  !
$str
¶¶! -
,
¶¶- .

permission
¶¶/ 9
)
¶¶9 :
)
¶¶: ;
;
¶¶; <
}
ßß 	
var
©© 
tokenDescriptor
©© 
=
©© 
new
©© !%
SecurityTokenDescriptor
©©" 9
{
™™ 	
Subject
´´ 
=
´´ 
new
´´ 
ClaimsIdentity
´´ (
(
´´( )
claims
´´) /
)
´´/ 0
,
´´0 1
Expires
¨¨ 
=
¨¨ 
DateTime
¨¨ 
.
¨¨ 
UtcNow
¨¨ %
.
¨¨% &
AddHours
¨¨& .
(
¨¨. /
this
¨¨/ 3
.
¨¨3 4
expirationHours
¨¨4 C
)
¨¨C D
,
¨¨D E 
SigningCredentials
≠≠ 
=
≠≠  
new
≠≠! $ 
SigningCredentials
≠≠% 7
(
≠≠7 8
new
≠≠8 ;"
SymmetricSecurityKey
≠≠< P
(
≠≠P Q
key
≠≠Q T
)
≠≠T U
,
≠≠U V 
SecurityAlgorithms
≠≠W i
.
≠≠i j!
HmacSha256Signature
≠≠j }
)
≠≠} ~
,
≠≠~ 
}
ÆÆ 	
;
ÆÆ	 

var
∞∞ 
token
∞∞ 
=
∞∞ 
tokenHandler
∞∞  
.
∞∞  !
CreateToken
∞∞! ,
(
∞∞, -
tokenDescriptor
∞∞- <
)
∞∞< =
;
∞∞= >
return
±± 
tokenHandler
±± 
.
±± 

WriteToken
±± &
(
±±& '
token
±±' ,
)
±±, -
;
±±- .
}
≤≤ 
public
∑∑ 

bool
∑∑ 
ValidateToken
∑∑ 
(
∑∑ 
string
∑∑ $
token
∑∑% *
)
∑∑* +
{
∏∏ 
try
ππ 
{
∫∫ 	
var
ªª 
tokenHandler
ªª 
=
ªª 
new
ªª "%
JwtSecurityTokenHandler
ªª# :
(
ªª: ;
)
ªª; <
;
ªª< =
var
ºº 
key
ºº 
=
ºº 
Encoding
ºº 
.
ºº 
ASCII
ºº $
.
ºº$ %
GetBytes
ºº% -
(
ºº- .
this
ºº. 2
.
ºº2 3
	secretKey
ºº3 <
)
ºº< =
;
ºº= >
tokenHandler
ææ 
.
ææ 
ValidateToken
ææ &
(
ææ& '
token
ææ' ,
,
ææ, -
new
ææ. 1'
TokenValidationParameters
ææ2 K
{
øø &
ValidateIssuerSigningKey
¿¿ (
=
¿¿) *
true
¿¿+ /
,
¿¿/ 0
IssuerSigningKey
¡¡  
=
¡¡! "
new
¡¡# &"
SymmetricSecurityKey
¡¡' ;
(
¡¡; <
key
¡¡< ?
)
¡¡? @
,
¡¡@ A
ValidateIssuer
¬¬ 
=
¬¬  
false
¬¬! &
,
¬¬& '
ValidateAudience
√√  
=
√√! "
false
√√# (
,
√√( )
	ClockSkew
ƒƒ 
=
ƒƒ 
TimeSpan
ƒƒ $
.
ƒƒ$ %
Zero
ƒƒ% )
,
ƒƒ) *
}
≈≈ 
,
≈≈ 
out
≈≈ 
_
≈≈ 
)
≈≈ 
;
≈≈ 
return
«« 
true
«« 
;
«« 
}
»» 	
catch
…… 
{
   	
return
ÀÀ 
false
ÀÀ 
;
ÀÀ 
}
ÃÃ 	
}
ÕÕ 
}ŒŒ ∂m
E/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Logging 
. 
ClearProviders 
( 
)  
;  !
builder 
. 
Logging 
. 

AddConsole 
( 
) 
; 
builder 
. 
Logging 
. 
SetMinimumLevel 
(  
LogLevel  (
.( )
Information) 4
)4 5
;5 6
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
c  
=>! #
{ 
c   
.   

SwaggerDoc   
(   
$str   
,   
new   
	Microsoft   $
.  $ %
OpenApi  % ,
.  , -
Models  - 3
.  3 4
OpenApiInfo  4 ?
{!! 
Title"" 
="" 
$str"" 5
,""5 6
Version## 
=## 
$str## 
,## 
Description$$ 
=$$ 
$str$I 
,II 
}JJ 
)JJ 
;JJ 
}KK 
)KK 
;KK 
builderNN 
.NN 
ServicesNN 
.NN 
AddAuthenticationNN "
(NN" #
JwtBearerDefaultsNN# 4
.NN4 5 
AuthenticationSchemeNN5 I
)NNI J
.OO 
AddJwtBearerOO 
(OO 
optionsOO 
=>OO 
{PP 
optionsQQ 
.QQ %
TokenValidationParametersQQ )
=QQ* +
newQQ, /%
TokenValidationParametersQQ0 I
{RR 	$
ValidateIssuerSigningKeySS $
=SS% &
trueSS' +
,SS+ ,
IssuerSigningKeyTT 
=TT 
newTT " 
SymmetricSecurityKeyTT# 7
(TT7 8
EncodingTT8 @
.TT@ A
ASCIITTA F
.TTF G
GetBytesTTG O
(TTO P
builderUU 
.UU 
ConfigurationUU %
[UU% &
$strUU& 2
]UU2 3
??UU4 6
throwUU7 <
newUU= @%
InvalidOperationExceptionUUA Z
(UUZ [
$strUU[ z
)UUz {
)UU{ |
)UU| }
,UU} ~
ValidateIssuerVV 
=VV 
falseVV "
,VV" #
ValidateAudienceWW 
=WW 
falseWW $
,WW$ %
	ClockSkewXX 
=XX 
TimeSpanXX  
.XX  !
ZeroXX! %
,XX% &
}YY 	
;YY	 

}ZZ 
)ZZ 
;ZZ 
builder]] 
.]] 
Services]] 
.]] #
AddAuthorizationBuilder]] (
(]]( )
)]]) *
.^^ 
	AddPolicy^^ 
(^^ 
$str^^  
,^^  !
policy^^" (
=>^^) +
policy__ 
.__ 
Requirements__ 
.__ 
Add__ 
(__  
new__  #!
PermissionRequirement__$ 9
(__9 :
$str__: F
)__F G
)__G H
)__H I
.`` 
	AddPolicy`` 
(`` 
$str`` !
,``! "
policy``# )
=>``* ,
policyaa 
.aa 
Requirementsaa 
.aa 
Addaa 
(aa  
newaa  #!
PermissionRequirementaa$ 9
(aa9 :
$straa: G
)aaG H
)aaH I
)aaI J
.bb 
	AddPolicybb 
(bb 
$strbb "
,bb" #
policybb$ *
=>bb+ -
policycc 
.cc 
Requirementscc 
.cc 
Addcc 
(cc  
newcc  #!
PermissionRequirementcc$ 9
(cc9 :
$strcc: H
)ccH I
)ccI J
)ccJ K
.dd 
	AddPolicydd 
(dd 
$strdd '
,dd' (
policydd) /
=>dd0 2
policyee 
.ee 
Requirementsee 
.ee 
Addee 
(ee  
newee  #'
IdentityProviderRequirementee$ ?
(ee? @
$stree@ L
)eeL M
)eeM N
)eeN O
.ff 
	AddPolicyff 
(ff 
$strff  
,ff  !
policyff" (
=>ff) +
policygg 
.gg 
Requirementsgg 
.gg 
Addgg 
(gg  
newgg  # 
AuthLevelRequirementgg$ 8
(gg8 9
$strgg9 ?
)gg? @
)gg@ A
)ggA B
.hh 
	AddPolicyhh 
(hh 
$strhh 2
,hh2 3
policyhh4 :
=>hh; =
policyii 
.ii 
RequireAssertionii 
(ii  
contextii  '
=>ii( *
contextjj 
.jj 
Userjj 
.jj 
HasClaimjj !
(jj! "
$strjj" .
,jj. /
$strjj0 <
)jj< =
||jj> @
contextkk 
.kk 
Userkk 
.kk 
IsInRolekk !
(kk! "
$strkk" )
)kk) *
)kk* +
)kk+ ,
.ll 
	AddPolicyll 
(ll 
$strll 3
,ll3 4
policyll5 ;
=>ll< >
policymm 
.mm 
RequireAssertionmm 
(mm  
contextmm  '
=>mm( *
contextnn 
.nn 
Usernn 
.nn 
HasClaimnn !
(nn! "
$strnn" .
,nn. /
$strnn0 =
)nn= >
||nn? A
contextoo 
.oo 
Useroo 
.oo 
IsInRoleoo !
(oo! "
$stroo" )
)oo) *
)oo* +
)oo+ ,
.pp 
	AddPolicypp 
(pp 
$strpp 4
,pp4 5
policypp6 <
=>pp= ?
policyqq 
.qq 
RequireAssertionqq 
(qq  
contextqq  '
=>qq( *
contextrr 
.rr 
Userrr 
.rr 
HasClaimrr !
(rr! "
$strrr" .
,rr. /
$strrr0 >
)rr> ?
||rr@ B
contextss 
.ss 
Userss 
.ss 
IsInRoless !
(ss! "
$strss" )
)ss) *
)ss* +
)ss+ ,
;ss, -
buildervv 
.vv 
Servicesvv 
.vv 
	AddScopedvv 
<vv !
IAuthorizationHandlervv 0
,vv0 1
PermissionHandlervv2 C
>vvC D
(vvD E
)vvE F
;vvF G
builderww 
.ww 
Servicesww 
.ww 
	AddScopedww 
<ww !
IAuthorizationHandlerww 0
,ww0 1 
AnyPermissionHandlerww2 F
>wwF G
(wwG H
)wwH I
;wwI J
builderxx 
.xx 
Servicesxx 
.xx 
	AddScopedxx 
<xx !
IAuthorizationHandlerxx 0
,xx0 1!
AllPermissionsHandlerxx2 G
>xxG H
(xxH I
)xxI J
;xxJ K
builderyy 
.yy 
Servicesyy 
.yy 
	AddScopedyy 
<yy !
IAuthorizationHandleryy 0
,yy0 1
RoleHandleryy2 =
>yy= >
(yy> ?
)yy? @
;yy@ A
builderzz 
.zz 
Serviceszz 
.zz 
	AddScopedzz 
<zz !
IAuthorizationHandlerzz 0
,zz0 1#
IdentityProviderHandlerzz2 I
>zzI J
(zzJ K
)zzK L
;zzL M
builder{{ 
.{{ 
Services{{ 
.{{ 
	AddScoped{{ 
<{{ !
IAuthorizationHandler{{ 0
,{{0 1
AuthLevelHandler{{2 B
>{{B C
({{C D
){{D E
;{{E F
builder~~ 
.~~ 
Services~~ 
.~~ 
	AddScoped~~ 
<~~ 

JwtService~~ %
>~~% &
(~~& '
)~~' (
;~~( )
builder 
. 
Services 
. 
	AddScoped 
< 
LocalRestClient *
>* +
(+ ,
), -
;- .
builderÇÇ 
.
ÇÇ 
Services
ÇÇ 
.
ÇÇ 
AddHealthChecks
ÇÇ  
(
ÇÇ  !
)
ÇÇ! "
.
ÉÉ 
AddCheck
ÉÉ 
(
ÉÉ 
$str
ÉÉ 
,
ÉÉ 
(
ÉÉ 
)
ÉÉ 
=>
ÉÉ 
HealthCheckResult
ÉÉ -
.
ÉÉ- .
Healthy
ÉÉ. 5
(
ÉÉ5 6
)
ÉÉ6 7
,
ÉÉ7 8
new
ÉÉ9 <
[
ÉÉ< =
]
ÉÉ= >
{
ÉÉ? @
$str
ÉÉA H
}
ÉÉI J
)
ÉÉJ K
;
ÉÉK L
builderÜÜ 
.
ÜÜ 
Services
ÜÜ 
.
ÜÜ 
AddOpenTelemetry
ÜÜ !
(
ÜÜ! "
)
ÜÜ" #
.
áá 
ConfigureResource
áá 
(
áá 
resource
áá 
=>
áá  "
resource
áá# +
.
àà 	

AddService
àà	 
(
àà 
$str
àà *
,
àà* +
serviceVersion
àà, :
:
àà: ;
$str
àà< C
)
ààC D
.
ââ 	
AddAttributes
ââ	 
(
ââ 
new
ââ 

Dictionary
ââ %
<
ââ% &
string
ââ& ,
,
ââ, -
object
ââ. 4
>
ââ4 5
{
ää 	
[
ãã 
$str
ãã %
]
ãã% &
=
ãã' (
builder
ãã) 0
.
ãã0 1
Environment
ãã1 <
.
ãã< =
EnvironmentName
ãã= L
,
ããL M
}
åå 	
)
åå	 

)
åå
 
.
çç 
WithTracing
çç 
(
çç 
tracing
çç 
=>
çç 
tracing
çç #
.
éé 	*
AddAspNetCoreInstrumentation
éé	 %
(
éé% &
)
éé& '
.
èè 	*
AddHttpClientInstrumentation
èè	 %
(
èè% &
)
èè& '
.
êê 	
AddOtlpExporter
êê	 
(
êê 
)
êê 
)
êê 
.
ëë 
WithMetrics
ëë 
(
ëë 
metrics
ëë 
=>
ëë 
metrics
ëë #
.
íí 	*
AddAspNetCoreInstrumentation
íí	 %
(
íí% &
)
íí& '
.
ìì 	*
AddHttpClientInstrumentation
ìì	 %
(
ìì% &
)
ìì& '
.
îî 	'
AddRuntimeInstrumentation
îî	 "
(
îî" #
)
îî# $
.
ïï 	
AddOtlpExporter
ïï	 
(
ïï 
)
ïï 
)
ïï 
;
ïï 
builderòò 
.
òò 
Services
òò 
.
òò 
AddSingleton
òò 
<
òò 
MetricServer
òò *
>
òò* +
(
òò+ ,
)
òò, -
;
òò- .
varöö 
app
öö 
=
öö 	
builder
öö
 
.
öö 
Build
öö 
(
öö 
)
öö 
;
öö 
ifùù 
(
ùù 
app
ùù 
.
ùù 
Environment
ùù 
.
ùù 
IsDevelopment
ùù !
(
ùù! "
)
ùù" #
)
ùù# $
{ûû 
app
üü 
.
üü 

UseSwagger
üü 
(
üü 
)
üü 
;
üü 
app
†† 
.
†† 
UseSwaggerUI
†† 
(
†† 
)
†† 
;
†† 
}°° 
app§§ 
.
§§ 
UseHttpMetrics
§§ 
(
§§ 
)
§§ 
;
§§ 
appßß 
.
ßß 
UseAuthentication
ßß 
(
ßß 
)
ßß 
;
ßß 
app®® 
.
®® 
UseAuthorization
®® 
(
®® 
)
®® 
;
®® 
app´´ 
.
´´ 
MapControllers
´´ 
(
´´ 
)
´´ 
;
´´ 
appÆÆ 
.
ÆÆ 
MapHealthChecks
ÆÆ 
(
ÆÆ 
$str
ÆÆ #
,
ÆÆ# $
new
ÆÆ% ( 
HealthCheckOptions
ÆÆ) ;
{ØØ 
	Predicate
∞∞ 
=
∞∞ 
check
∞∞ 
=>
∞∞ 
check
∞∞ 
.
∞∞ 
Tags
∞∞ #
.
∞∞# $
Contains
∞∞$ ,
(
∞∞, -
$str
∞∞- 4
)
∞∞4 5
,
∞∞5 6
}±± 
)
±± 
;
±± 
app≥≥ 
.
≥≥ 
MapHealthChecks
≥≥ 
(
≥≥ 
$str
≥≥ "
,
≥≥" #
new
≥≥$ ' 
HealthCheckOptions
≥≥( :
{¥¥ 
	Predicate
µµ 
=
µµ 
_
µµ 
=>
µµ 
false
µµ 
,
µµ 
}∂∂ 
)
∂∂ 
;
∂∂ 
appππ 
.
ππ 

MapMetrics
ππ 
(
ππ 
)
ππ 
;
ππ 
varºº 
metricServer
ºº 
=
ºº 
app
ºº 
.
ºº 
Services
ºº 
.
ºº   
GetRequiredService
ºº  2
<
ºº2 3
MetricServer
ºº3 ?
>
ºº? @
(
ºº@ A
)
ººA B
;
ººB C
metricServerΩΩ 
.
ΩΩ 
Start
ΩΩ 
(
ΩΩ 
)
ΩΩ 
;
ΩΩ 
appøø 
.
øø 
Run
øø 
(
øø 
)
øø 	
;
øø	 
≥^
a/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/VulnerableJWTController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class #
VulnerableJwtController $
:% &
ControllerBase' 5
{ 
private 
const 
string 

WeakSecret #
=$ %
$str& Q
;Q R
private 
const 
string 
TokenKey !
=" #
$str$ +
;+ ,
private 
const 
string 
AlgorithmKey %
=& '
$str( 3
;3 4
private 
const 
string 
ValidKey !
=" #
$str$ +
;+ ,
private 
const 
string 

DecodedKey #
=$ %
$str& /
;/ 0
private 
const 
string 
	HeaderKey "
=# $
$str% -
;- .
private 
const 
string 

PayloadKey #
=$ %
$str& /
;/ 0
private 
const 
string 
SignatureKey %
=& '
$str( 3
;3 4
private 
const 
string 
ErrorKey !
=" #
$str$ +
;+ ,
private 
const 
string 

MessageKey #
=$ %
$str& /
;/ 0
public 
#
VulnerableJwtController "
(" #
)# $
{ 
} 
[$$ 
HttpPost$$ 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 

IActionResult%% 
CreateToken%% $
(%%$ %
[%%% &
FromBody%%& .
]%%. /

Dictionary%%0 :
<%%: ;
string%%; A
,%%A B
object%%C I
>%%I J
payload%%K R
)%%R S
{&& 
try'' 
{(( 	
var** 
header** 
=** 
Convert**  
.**  !
ToBase64String**! /
(**/ 0
Encoding**0 8
.**8 9
UTF8**9 =
.**= >
GetBytes**> F
(**F G
$str**G l
)**l m
)**m n
;**n o
var++ 

payloadStr++ 
=++ 
Convert++ $
.++$ %
ToBase64String++% 3
(++3 4
Encoding++4 <
.++< =
UTF8++= A
.++A B
GetBytes++B J
(++J K
JsonSerializer++K Y
.++Y Z
	Serialize++Z c
(++c d
payload++d k
)++k l
)++l m
)++m n
;++n o
var,, 
	signature,, 
=,, 
Convert,, #
.,,# $
ToBase64String,,$ 2
(,,2 3
Encoding,,3 ;
.,,; <
UTF8,,< @
.,,@ A
GetBytes,,A I
(,,I J

WeakSecret,,J T
),,T U
),,U V
;,,V W
var.. 
token.. 
=.. 
$".. 
{.. 
header.. !
}..! "
$str.." #
{..# $

payloadStr..$ .
}... /
$str../ 0
{..0 1
	signature..1 :
}..: ;
"..; <
;..< =
return// 
Ok// 
(// 
token// 
)// 
;// 
}00 	
catch11 
(11 
	Exception11 
e11 
)11 
{22 	
return33 

BadRequest33 
(33 
$"33  
$str33  6
{336 7
e337 8
.338 9
Message339 @
}33@ A
"33A B
)33B C
;33C D
}44 	
}55 
[:: 
HttpPost:: 
(:: 
$str:: 
):: 
]:: 
public;; 

IActionResult;; 
VerifyToken;; $
(;;$ %
[;;% &
FromBody;;& .
];;. /

Dictionary;;0 :
<;;: ;
string;;; A
,;;A B
string;;C I
>;;I J
request;;K R
);;R S
{<< 
try== 
{>> 	
var?? 
token?? 
=?? 
request?? 
.??  
GetValueOrDefault??  1
(??1 2
TokenKey??2 :
,??: ;
string??< B
.??B C
Empty??C H
)??H I
;??I J
varBB 
responseBB 
=BB 
newBB 

DictionaryBB )
<BB) *
stringBB* 0
,BB0 1
objectBB2 8
>BB8 9
{CC 
[DD 
ValidKeyDD 
]DD 
=DD 
trueDD !
,DD! "
[EE 
TokenKeyEE 
]EE 
=EE 
tokenEE "
,EE" #
[FF 

MessageKeyFF 
]FF 
=FF 
$strFF I
,FFI J
}GG 
;GG 
returnII 
OkII 
(II 
responseII 
)II 
;II  
}JJ 	
catchKK 
(KK 
	ExceptionKK 
eKK 
)KK 
{LL 	
varMM 
responseMM 
=MM 
newMM 

DictionaryMM )
<MM) *
stringMM* 0
,MM0 1
objectMM2 8
>MM8 9
{NN 
[OO 
ValidKeyOO 
]OO 
=OO 
falseOO "
,OO" #
[PP 
ErrorKeyPP 
]PP 
=PP 
ePP 
.PP 
MessagePP &
,PP& '
}QQ 
;QQ 
returnSS 
OkSS 
(SS 
responseSS 
)SS 
;SS  
}TT 	
}UU 
[ZZ 
HttpGetZZ 
(ZZ 
$strZZ 
)ZZ 
]ZZ 
public[[ 

IActionResult[[ 
DecodeToken[[ $
([[$ %
[[[% &
	FromQuery[[& /
][[/ 0
string[[1 7
token[[8 =
)[[= >
{\\ !
ArgumentNullException]] 
.]] 
ThrowIfNull]] )
(]]) *
token]]* /
)]]/ 0
;]]0 1
try__ 
{`` 	
varbb 
partsbb 
=bb 
tokenbb 
.bb 
Splitbb #
(bb# $
$charbb$ '
)bb' (
;bb( )
varcc 
responsecc 
=cc 
newcc 

Dictionarycc )
<cc) *
stringcc* 0
,cc0 1
objectcc2 8
>cc8 9
{dd 
[ee 

DecodedKeyee 
]ee 
=ee 
trueee #
,ee# $
[ff 
	HeaderKeyff 
]ff 
=ff 
partsff #
.ff# $
Lengthff$ *
>ff+ ,
$numff- .
?ff/ 0
Encodingff1 9
.ff9 :
UTF8ff: >
.ff> ?
	GetStringff? H
(ffH I
ConvertffI P
.ffP Q
FromBase64StringffQ a
(ffa b
partsffb g
[ffg h
$numffh i
]ffi j
)ffj k
)ffk l
:ffm n
stringffo u
.ffu v
Emptyffv {
,ff{ |
[gg 

PayloadKeygg 
]gg 
=gg 
partsgg $
.gg$ %
Lengthgg% +
>gg, -
$numgg. /
?gg0 1
Encodinggg2 :
.gg: ;
UTF8gg; ?
.gg? @
	GetStringgg@ I
(ggI J
ConvertggJ Q
.ggQ R
FromBase64StringggR b
(ggb c
partsggc h
[ggh i
$numggi j
]ggj k
)ggk l
)ggl m
:ggn o
stringggp v
.ggv w
Emptyggw |
,gg| }
[hh 
SignatureKeyhh 
]hh 
=hh  
partshh! &
.hh& '
Lengthhh' -
>hh. /
$numhh0 1
?hh2 3
partshh4 9
[hh9 :
$numhh: ;
]hh; <
:hh= >
stringhh? E
.hhE F
EmptyhhF K
,hhK L
}ii 
;ii 
returnkk 
Okkk 
(kk 
responsekk 
)kk 
;kk  
}ll 	
catchmm 
(mm 
	Exceptionmm 
emm 
)mm 
{nn 	
varoo 
responseoo 
=oo 
newoo 

Dictionaryoo )
<oo) *
stringoo* 0
,oo0 1
objectoo2 8
>oo8 9
{pp 
[qq 

DecodedKeyqq 
]qq 
=qq 
falseqq $
,qq$ %
[rr 
ErrorKeyrr 
]rr 
=rr 
err 
.rr 
Messagerr &
,rr& '
}ss 
;ss 
returnuu 
Okuu 
(uu 
responseuu 
)uu 
;uu  
}vv 	
}ww 
[|| 
HttpPost|| 
(|| 
$str|| $
)||$ %
]||% &
public}} 

IActionResult}} 
VerifyAnyAlgorithm}} +
(}}+ ,
[}}, -
FromBody}}- 5
]}}5 6

Dictionary}}7 A
<}}A B
string}}B H
,}}H I
string}}J P
>}}P Q
request}}R Y
)}}Y Z
{~~ 
try 
{
ÄÄ 	
var
ÅÅ 
token
ÅÅ 
=
ÅÅ 
request
ÅÅ 
.
ÅÅ  
GetValueOrDefault
ÅÅ  1
(
ÅÅ1 2
TokenKey
ÅÅ2 :
,
ÅÅ: ;
string
ÅÅ< B
.
ÅÅB C
Empty
ÅÅC H
)
ÅÅH I
;
ÅÅI J
var
ÇÇ 
	algorithm
ÇÇ 
=
ÇÇ 
request
ÇÇ #
.
ÇÇ# $
GetValueOrDefault
ÇÇ$ 5
(
ÇÇ5 6
AlgorithmKey
ÇÇ6 B
,
ÇÇB C
string
ÇÇD J
.
ÇÇJ K
Empty
ÇÇK P
)
ÇÇP Q
;
ÇÇQ R
var
ÖÖ 
response
ÖÖ 
=
ÖÖ 
new
ÖÖ 

Dictionary
ÖÖ )
<
ÖÖ) *
string
ÖÖ* 0
,
ÖÖ0 1
object
ÖÖ2 8
>
ÖÖ8 9
{
ÜÜ 
[
áá 
ValidKey
áá 
]
áá 
=
áá 
true
áá !
,
áá! "
[
àà 
AlgorithmKey
àà 
]
àà 
=
àà  
	algorithm
àà! *
,
àà* +
[
ââ 
TokenKey
ââ 
]
ââ 
=
ââ 
token
ââ "
,
ââ" #
[
ää 

MessageKey
ää 
]
ää 
=
ää 
$"
ää !
$str
ää! H
{
ääH I
	algorithm
ääI R
}
ääR S
"
ääS T
,
ääT U
}
ãã 
;
ãã 
return
çç 
Ok
çç 
(
çç 
response
çç 
)
çç 
;
çç  
}
éé 	
catch
èè 
(
èè 
	Exception
èè 
e
èè 
)
èè 
{
êê 	
var
ëë 
response
ëë 
=
ëë 
new
ëë 

Dictionary
ëë )
<
ëë) *
string
ëë* 0
,
ëë0 1
object
ëë2 8
>
ëë8 9
{
íí 
[
ìì 
ValidKey
ìì 
]
ìì 
=
ìì 
false
ìì "
,
ìì" #
[
îî 
ErrorKey
îî 
]
îî 
=
îî 
e
îî 
.
îî 
Message
îî &
,
îî& '
}
ïï 
;
ïï 
return
óó 
Ok
óó 
(
óó 
response
óó 
)
óó 
;
óó  
}
òò 	
}
ôô 
}öö ≠&
a/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Authorization/PermissionRequirement.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Authorization ,
;, -
public 
class !
PermissionRequirement "
:# $%
IAuthorizationRequirement% >
{ 
public 

string 

Permission 
{ 
get "
;" #
}$ %
public 
!
PermissionRequirement  
(  !
string! '

permission( 2
)2 3
{ 
this 
. 

Permission 
= 

permission $
??% '
throw( -
new. 1!
ArgumentNullException2 G
(G H
nameofH N
(N O

permissionO Y
)Y Z
)Z [
;[ \
} 
} 
public 
class $
AnyPermissionRequirement %
:& '%
IAuthorizationRequirement( A
{ 
public 

string 
[ 
] 
Permissions 
{  !
get" %
;% &
}' (
public 
$
AnyPermissionRequirement #
(# $
params$ *
string+ 1
[1 2
]2 3
permissions4 ?
)? @
{ 
this 
. 
Permissions 
= 
permissions &
??' )
throw* /
new0 3!
ArgumentNullException4 I
(I J
nameofJ P
(P Q
permissionsQ \
)\ ]
)] ^
;^ _
}   
}!! 
public&& 
class&& %
AllPermissionsRequirement&& &
:&&' (%
IAuthorizationRequirement&&) B
{'' 
public(( 

string(( 
[(( 
](( 
Permissions(( 
{((  !
get((" %
;((% &
}((' (
public** 
%
AllPermissionsRequirement** $
(**$ %
params**% +
string**, 2
[**2 3
]**3 4
permissions**5 @
)**@ A
{++ 
this,, 
.,, 
Permissions,, 
=,, 
permissions,, &
??,,' )
throw,,* /
new,,0 3!
ArgumentNullException,,4 I
(,,I J
nameof,,J P
(,,P Q
permissions,,Q \
),,\ ]
),,] ^
;,,^ _
}-- 
}.. 
public33 
class33  
AuthLevelRequirement33 !
:33" #%
IAuthorizationRequirement33$ =
{44 
public55 

string55 
RequiredAuthLevel55 #
{55$ %
get55& )
;55) *
}55+ ,
public77 
 
AuthLevelRequirement77 
(77  
string77  &
requiredAuthLevel77' 8
)778 9
{88 
this99 
.99 
RequiredAuthLevel99 
=99  
requiredAuthLevel99! 2
??993 5
throw996 ;
new99< ?!
ArgumentNullException99@ U
(99U V
nameof99V \
(99\ ]
requiredAuthLevel99] n
)99n o
)99o p
;99p q
}:: 
};; 
public@@ 
class@@ '
IdentityProviderRequirement@@ (
:@@) *%
IAuthorizationRequirement@@+ D
{AA 
publicBB 

stringBB $
RequiredIdentityProviderBB *
{BB+ ,
getBB- 0
;BB0 1
}BB2 3
publicDD 
'
IdentityProviderRequirementDD &
(DD& '
stringDD' -$
requiredIdentityProviderDD. F
)DDF G
{EE 
thisFF 
.FF $
RequiredIdentityProviderFF %
=FF& '$
requiredIdentityProviderFF( @
??FFA C
throwFFD I
newFFJ M!
ArgumentNullExceptionFFN c
(FFc d
nameofFFd j
(FFj k%
requiredIdentityProvider	FFk É
)
FFÉ Ñ
)
FFÑ Ö
;
FFÖ Ü
}GG 
}HH 
publicMM 
classMM 
RoleRequirementMM 
:MM %
IAuthorizationRequirementMM 8
{NN 
publicOO 

stringOO 
RoleOO 
{OO 
getOO 
;OO 
}OO 
publicQQ 

RoleRequirementQQ 
(QQ 
stringQQ !
roleQQ" &
)QQ& '
{RR 
thisSS 
.SS 
RoleSS 
=SS 
roleSS 
??SS 
throwSS !
newSS" %!
ArgumentNullExceptionSS& ;
(SS; <
nameofSS< B
(SSB C
roleSSC G
)SSG H
)SSH I
;SSI J
}TT 
}UU ‡'
[/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/MetricsController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
MetricsController 
:  
ControllerBase! /
{ 
private 
static 
readonly 
Meter !
Meter" '
=( )
new* -
(- .
$str. L
,L M
$strN U
)U V
;V W
private 
static 
readonly 
Counter #
<# $
long$ (
>( )
RequestCounter* 8
=9 :
Meter; @
.@ A
CreateCounterA N
<N O
longO S
>S T
(T U
$strU l
,l m
$str	n è
)
è ê
;
ê ë
private 
static 
readonly 
	Histogram %
<% &
double& ,
>, -
ResponseTime. :
=; <
Meter= B
.B C
CreateHistogramC R
<R S
doubleS Y
>Y Z
(Z [
$str[ q
,q r
$str	s â
)
â ä
;
ä ã
private 
static 
readonly 
Random "
Random# )
=* +
new, /
(/ 0
)0 1
;1 2
[ 
HttpGet 
( 
$str 
) 
] 
public 

async 
Task 
< 
string 
> 
TestMetrics )
() *
)* +
{ 
RequestCounter 
. 
Add 
( 
$num 
) 
; 
using 
var 
activity 
= 
new  
Activity! )
() *
$str* <
)< =
;= >
activity 
. 
Start 
( 
) 
; 
try 
{ 	
await 
Task 
. 
Delay 
( 
Random #
.# $
Next$ (
(( )
$num) +
,+ ,
$num- 0
)0 1
)1 2
;2 3
return   
$str   +
;  + ,
}!! 	
finally"" 
{## 	
activity$$ 
.$$ 
Stop$$ 
($$ 
)$$ 
;$$ 
ResponseTime%% 
.%% 
Record%% 
(%%  
activity%%  (
.%%( )
Duration%%) 1
.%%1 2
TotalMilliseconds%%2 C
)%%C D
;%%D E
}&& 	
}'' 
[)) 
HttpGet)) 
()) 
$str)) 
))) 
])) 
public** 

string** 
IncrementCounter** "
(**" #
[**# $
	FromQuery**$ -
]**- .
int**/ 2
value**3 8
=**9 :
$num**; <
)**< =
{++ 
RequestCounter,, 
.,, 
Add,, 
(,, 
value,,  
),,  !
;,,! "
return-- 
$"-- 
$str-- (
{--( )
value--) .
}--. /
"--/ 0
;--0 1
}.. 
[00 
HttpGet00 
(00 
$str00 
)00 
]00 
public11 

async11 
Task11 
<11 
string11 
>11 
SlowEndpoint11 *
(11* +
)11+ ,
{22 
RequestCounter33 
.33 
Add33 
(33 
$num33 
)33 
;33 
using55 
var55 
activity55 
=55 
new55  
Activity55! )
(55) *
$str55* :
)55: ;
;55; <
activity66 
.66 
Start66 
(66 
)66 
;66 
try88 
{99 	
await;; 
Task;; 
.;; 
Delay;; 
(;; 
Random;; #
.;;# $
Next;;$ (
(;;( )
$num;;) ,
,;;, -
$num;;. 2
);;2 3
);;3 4
;;;4 5
return<< 
$str<< -
;<<- .
}== 	
finally>> 
{?? 	
activity@@ 
.@@ 
Stop@@ 
(@@ 
)@@ 
;@@ 
ResponseTimeAA 
.AA 
RecordAA 
(AA  
activityAA  (
.AA( )
DurationAA) 1
.AA1 2
TotalMillisecondsAA2 C
)AAC D
;AAD E
}BB 	
}CC 
}DD ‘ë
Y/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/TokenController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
[ 
Tags 
( 
$str 
) 
] 
public 
class 
TokenController 
: 
ControllerBase -
{ 
private 
readonly 

JwtService 

jwtService  *
;* +
private 
const 
string 
CacheReadPermission ,
=- .
$str/ ;
;; <
private 
const 
string  
CacheWritePermission -
=. /
$str0 =
;= >
private 
const 
string 
DefaultRole $
=% &
$str' -
;- .
private 
static 
readonly 
string "
[" #
]# $

AdminRoles% /
=0 1
{2 3
$str4 ;
,; <
$str= C
}D E
;E F
private 
static 
readonly 
string "
[" #
]# $
AdminPermissions% 5
=6 7
{8 9
CacheReadPermission: M
,M N 
CacheWritePermissionO c
,c d
$stre s
}t u
;u v
private 
static 
readonly 
string "
[" #
]# $
	UserRoles% .
=/ 0
{1 2
DefaultRole3 >
}? @
;@ A
private 
static 
readonly 
string "
[" #
]# $
UserPermissions% 4
=5 6
{7 8
CacheReadPermission9 L
}M N
;N O
private 
static 
readonly 
string "
[" #
]# $
ReadOnlyRoles% 2
=3 4
{5 6
$str7 A
}B C
;C D
private 
static 
readonly 
string "
[" #
]# $
ReadOnlyPermissions% 8
=9 :
{; <
CacheReadPermission= P
}Q R
;R S
private 
static 
readonly 
string "
[" #
]# $
WriterRoles% 0
=1 2
{3 4
$str5 =
}> ?
;? @
private   
static   
readonly   
string   "
[  " #
]  # $
WriterPermissions  % 6
=  7 8
{  9 :
CacheReadPermission  ; N
,  N O 
CacheWritePermission  P d
}  e f
;  f g
public"" 

TokenController"" 
("" 

JwtService"" %

jwtService""& 0
)""0 1
{## 
this$$ 
.$$ 

jwtService$$ 
=$$ 

jwtService$$ $
;$$$ %
}%% 
[** 
HttpPost** 
(** 
$str** 
)** 
]** 
[++  
ProducesResponseType++ 
(++ 
typeof++  
(++  !
object++! '
)++' (
,++( )
$num++* -
)++- .
]++. /
[,,  
ProducesResponseType,, 
(,, 
$num,, 
),, 
],, 
public-- 

IActionResult-- 
GenerateToken-- &
(--& '
[.. 	
	FromQuery..	 
,.. 
Required.. 
].. 
string.. $
username..% -
,..- .
[// 	
	FromQuery//	 
]// 
string// 
?// 
roles// !
=//" #
null//$ (
,//( )
[00 	
	FromQuery00	 
]00 
string00 
?00 
permissions00 '
=00( )
null00* .
)00. /
{11 
var33 
	rolesList33 
=33 
string33 
.33 
IsNullOrEmpty33 ,
(33, -
roles33- 2
)332 3
?44 
new44 
List44 
<44 
string44 
>44 
{44  
DefaultRole44! ,
}44- .
:55 
roles55 
.55 
Split55 
(55 
$char55 
)55 
.55 
Select55 %
(55% &
r55& '
=>55( *
r55+ ,
.55, -
Trim55- 1
(551 2
)552 3
)553 4
.554 5
ToList555 ;
(55; <
)55< =
;55= >
var77 
permissionsList77 
=77 
string77 $
.77$ %
IsNullOrEmpty77% 2
(772 3
permissions773 >
)77> ?
?88 
new88 
List88 
<88 
string88 
>88 
{88  
CacheReadPermission88! 4
}885 6
:99 
permissions99 
.99 
Split99 
(99  
$char99  #
)99# $
.99$ %
Select99% +
(99+ ,
p99, -
=>99. 0
p991 2
.992 3
Trim993 7
(997 8
)998 9
)999 :
.99: ;
ToList99; A
(99A B
)99B C
;99C D
var;; 
token;; 
=;; 
this;; 
.;; 

jwtService;; #
.;;# $
GenerateToken;;$ 1
(;;1 2
username;;2 :
,;;: ;
	rolesList;;< E
,;;E F
permissionsList;;G V
);;V W
;;;W X
var== 
response== 
=== 
new== 
{>> 	
token?? 
,?? 
username@@ 
,@@ 
rolesAA 
=AA 
	rolesListAA 
,AA 
permissionsBB 
=BB 
permissionsListBB )
,BB) *
	expiresAtCC 
=CC 
DateTimeCC  
.CC  !
UtcNowCC! '
.CC' (
AddHoursCC( 0
(CC0 1
$numCC1 2
)CC2 3
,CC3 4
}DD 	
;DD	 

returnFF 
OkFF 
(FF 
responseFF 
)FF 
;FF 
}GG 
[LL 
HttpGetLL 
(LL 
$strLL  
)LL  !
]LL! "
[MM  
ProducesResponseTypeMM 
(MM 
typeofMM  
(MM  !
objectMM! '
)MM' (
,MM( )
$numMM* -
)MM- .
]MM. /
[NN  
ProducesResponseTypeNN 
(NN 
$numNN 
)NN 
]NN 
publicOO 

IActionResultOO #
GeneratePredefinedTokenOO 0
(OO0 1
[OO1 2
	FromRouteOO2 ;
]OO; <
stringOO= C
typeOOD H
)OOH I
{PP !
ArgumentNullExceptionQQ 
.QQ 
ThrowIfNullQQ )
(QQ) *
typeQQ* .
)QQ. /
;QQ/ 0
varSS 
	upperTypeSS 
=SS 
typeSS 
.SS 
ToUpperInvariantSS -
(SS- .
)SS. /
;SS/ 0
returnTT 
	upperTypeTT 
switchTT 
{UU 	
$strVV 
=>VV 
thisVV 
.VV 
GenerateAdminTokenVV .
(VV. /
)VV/ 0
,VV0 1
$strWW 
=>WW 
thisWW 
.WW 
GenerateUserTokenWW ,
(WW, -
)WW- .
,WW. /
$strXX 
=>XX 
thisXX 
.XX !
GenerateReadOnlyTokenXX 4
(XX4 5
)XX5 6
,XX6 7
$strYY 
=>YY 
thisYY 
.YY 
GenerateWriteTokenYY .
(YY. /
)YY/ 0
,YY0 1
_ZZ 
=>ZZ 

BadRequestZZ 
(ZZ 
$"ZZ 
$strZZ 2
{ZZ2 3
typeZZ3 7
}ZZ7 8
"ZZ8 9
)ZZ9 :
,ZZ: ;
}[[ 	
;[[	 

}\\ 
[aa 
HttpGetaa 
(aa 
$straa 
)aa 
]aa 
[bb  
ProducesResponseTypebb 
(bb 
typeofbb  
(bb  !
objectbb! '
)bb' (
,bb( )
$numbb* -
)bb- .
]bb. /
publiccc 

IActionResultcc 
GenerateAdminTokencc +
(cc+ ,
)cc, -
{dd 
varee 
tokenee 
=ee 
thisee 
.ee 

jwtServiceee #
.ee# $
GenerateTokenee$ 1
(ee1 2
$strff 
,ff 
newgg 
Listgg 
<gg 
stringgg 
>gg 
{gg 
$strgg &
,gg& '
$strgg( .
}gg/ 0
,gg0 1
newhh 
Listhh 
<hh 
stringhh 
>hh 
{hh 
CacheReadPermissionhh 2
,hh2 3 
CacheWritePermissionhh4 H
,hhH I
$strhhJ X
}hhY Z
)hhZ [
;hh[ \
returnjj 
Okjj 
(jj 
newjj 
{kk 	
tokenll 
,ll 
usernamemm 
=mm 
$strmm 
,mm 
rolesnn 
=nn 

AdminRolesnn 
,nn 
permissionsoo 
=oo 
AdminPermissionsoo *
,oo* +
	expiresAtpp 
=pp 
DateTimepp  
.pp  !
UtcNowpp! '
.pp' (
AddHourspp( 0
(pp0 1
$numpp1 2
)pp2 3
,pp3 4
}qq 	
)qq	 

;qq
 
}rr 
[ww 
HttpGetww 
(ww 
$strww 
)ww 
]ww 
[xx  
ProducesResponseTypexx 
(xx 
typeofxx  
(xx  !
objectxx! '
)xx' (
,xx( )
$numxx* -
)xx- .
]xx. /
publicyy 

IActionResultyy 
GenerateUserTokenyy *
(yy* +
)yy+ ,
{zz 
var{{ 
token{{ 
={{ 
this{{ 
.{{ 

jwtService{{ #
.{{# $
GenerateToken{{$ 1
({{1 2
$str|| 
,|| 
new}} 
List}} 
<}} 
string}} 
>}} 
{}} 
DefaultRole}} *
}}}+ ,
,}}, -
new~~ 
List~~ 
<~~ 
string~~ 
>~~ 
{~~ 
CacheReadPermission~~ 2
}~~3 4
)~~4 5
;~~5 6
return
ÄÄ 
Ok
ÄÄ 
(
ÄÄ 
new
ÄÄ 
{
ÅÅ 	
token
ÇÇ 
,
ÇÇ 
username
ÉÉ 
=
ÉÉ 
$str
ÉÉ 
,
ÉÉ 
roles
ÑÑ 
=
ÑÑ 
	UserRoles
ÑÑ 
,
ÑÑ 
permissions
ÖÖ 
=
ÖÖ 
UserPermissions
ÖÖ )
,
ÖÖ) *
	expiresAt
ÜÜ 
=
ÜÜ 
DateTime
ÜÜ  
.
ÜÜ  !
UtcNow
ÜÜ! '
.
ÜÜ' (
AddHours
ÜÜ( 0
(
ÜÜ0 1
$num
ÜÜ1 2
)
ÜÜ2 3
,
ÜÜ3 4
}
áá 	
)
áá	 

;
áá
 
}
àà 
[
çç 
HttpGet
çç 
(
çç 
$str
çç 
)
çç 
]
çç 
[
éé "
ProducesResponseType
éé 
(
éé 
typeof
éé  
(
éé  !
object
éé! '
)
éé' (
,
éé( )
$num
éé* -
)
éé- .
]
éé. /
public
èè 

IActionResult
èè #
GenerateReadOnlyToken
èè .
(
èè. /
)
èè/ 0
{
êê 
var
ëë 
token
ëë 
=
ëë 
this
ëë 
.
ëë 

jwtService
ëë #
.
ëë# $
GenerateToken
ëë$ 1
(
ëë1 2
$str
íí 
,
íí 
new
ìì 
List
ìì 
<
ìì 
string
ìì 
>
ìì 
{
ìì 
$str
ìì )
}
ìì* +
,
ìì+ ,
new
îî 
List
îî 
<
îî 
string
îî 
>
îî 
{
îî !
CacheReadPermission
îî 2
}
îî3 4
)
îî4 5
;
îî5 6
return
ññ 
Ok
ññ 
(
ññ 
new
ññ 
{
óó 	
token
òò 
,
òò 
username
ôô 
=
ôô 
$str
ôô !
,
ôô! "
roles
öö 
=
öö 
ReadOnlyRoles
öö !
,
öö! "
permissions
õõ 
=
õõ !
ReadOnlyPermissions
õõ -
,
õõ- .
	expiresAt
úú 
=
úú 
DateTime
úú  
.
úú  !
UtcNow
úú! '
.
úú' (
AddHours
úú( 0
(
úú0 1
$num
úú1 2
)
úú2 3
,
úú3 4
}
ùù 	
)
ùù	 

;
ùù
 
}
ûû 
[
££ 
HttpGet
££ 
(
££ 
$str
££ 
)
££ 
]
££ 
[
§§ "
ProducesResponseType
§§ 
(
§§ 
typeof
§§  
(
§§  !
object
§§! '
)
§§' (
,
§§( )
$num
§§* -
)
§§- .
]
§§. /
public
•• 

IActionResult
••  
GenerateWriteToken
•• +
(
••+ ,
)
••, -
{
¶¶ 
var
ßß 
token
ßß 
=
ßß 
this
ßß 
.
ßß 

jwtService
ßß #
.
ßß# $
GenerateToken
ßß$ 1
(
ßß1 2
$str
®® 
,
®® 
new
©© 
List
©© 
<
©© 
string
©© 
>
©© 
{
©© 
$str
©© '
}
©©( )
,
©©) *
new
™™ 
List
™™ 
<
™™ 
string
™™ 
>
™™ 
{
™™ !
CacheReadPermission
™™ 2
,
™™2 3"
CacheWritePermission
™™4 H
}
™™I J
)
™™J K
;
™™K L
return
¨¨ 
Ok
¨¨ 
(
¨¨ 
new
¨¨ 
{
≠≠ 	
token
ÆÆ 
,
ÆÆ 
username
ØØ 
=
ØØ 
$str
ØØ 
,
ØØ  
roles
∞∞ 
=
∞∞ 
WriterRoles
∞∞ 
,
∞∞  
permissions
±± 
=
±± 
WriterPermissions
±± +
,
±±+ ,
	expiresAt
≤≤ 
=
≤≤ 
DateTime
≤≤  
.
≤≤  !
UtcNow
≤≤! '
.
≤≤' (
AddHours
≤≤( 0
(
≤≤0 1
$num
≤≤1 2
)
≤≤2 3
,
≤≤3 4
}
≥≥ 	
)
≥≥	 

;
≥≥
 
}
¥¥ 
[
ππ 
HttpPost
ππ 
(
ππ 
$str
ππ 
)
ππ 
]
ππ 
[
∫∫ "
ProducesResponseType
∫∫ 
(
∫∫ 
typeof
∫∫  
(
∫∫  !
object
∫∫! '
)
∫∫' (
,
∫∫( )
$num
∫∫* -
)
∫∫- .
]
∫∫. /
[
ªª "
ProducesResponseType
ªª 
(
ªª 
$num
ªª 
)
ªª 
]
ªª 
public
ºº 

IActionResult
ºº 
ValidateToken
ºº &
(
ºº& '
[
ºº' (
FromBody
ºº( 0
]
ºº0 1

Dictionary
ºº2 <
<
ºº< =
string
ºº= C
,
ººC D
string
ººE K
>
ººK L
request
ººM T
)
ººT U
{
ΩΩ #
ArgumentNullException
ææ 
.
ææ 
ThrowIfNull
ææ )
(
ææ) *
request
ææ* 1
)
ææ1 2
;
ææ2 3
if
¿¿ 

(
¿¿ 
!
¿¿ 
request
¿¿ 
.
¿¿ 
TryGetValue
¿¿  
(
¿¿  !
$str
¿¿! (
,
¿¿( )
out
¿¿* -
var
¿¿. 1
token
¿¿2 7
)
¿¿7 8
)
¿¿8 9
{
¡¡ 	
return
¬¬ 

BadRequest
¬¬ 
(
¬¬ 
$str
¬¬ 1
)
¬¬1 2
;
¬¬2 3
}
√√ 	
try
≈≈ 
{
∆∆ 	
var
«« 
isValid
«« 
=
«« 
this
«« 
.
«« 

jwtService
«« )
.
««) *
ValidateToken
««* 7
(
««7 8
token
««8 =
)
««= >
;
««> ?
var
»» 
username
»» 
=
»» 

JwtService
»» %
.
»»% &
ExtractUsername
»»& 5
(
»»5 6
token
»»6 ;
)
»»; <
;
»»< =
var
…… 
roles
…… 
=
…… 

JwtService
…… "
.
……" #
ExtractRoles
……# /
(
……/ 0
token
……0 5
)
……5 6
;
……6 7
var
   
permissions
   
=
   

JwtService
   (
.
  ( ) 
ExtractPermissions
  ) ;
(
  ; <
token
  < A
)
  A B
;
  B C
return
ÃÃ 
Ok
ÃÃ 
(
ÃÃ 
new
ÃÃ 
{
ÕÕ 
valid
ŒŒ 
=
ŒŒ 
isValid
ŒŒ 
,
ŒŒ  
username
œœ 
,
œœ 
roles
–– 
,
–– 
permissions
—— 
,
—— 
validatedAt
““ 
=
““ 
DateTime
““ &
.
““& '
UtcNow
““' -
,
““- .
}
”” 
)
”” 
;
”” 
}
‘‘ 	
catch
’’ 
(
’’ 
	Exception
’’ 
ex
’’ 
)
’’ 
{
÷÷ 	
return
◊◊ 
Ok
◊◊ 
(
◊◊ 
new
◊◊ 
{
ÿÿ 
valid
ŸŸ 
=
ŸŸ 
false
ŸŸ 
,
ŸŸ 
error
⁄⁄ 
=
⁄⁄ 
ex
⁄⁄ 
.
⁄⁄ 
Message
⁄⁄ "
,
⁄⁄" #
validatedAt
€€ 
=
€€ 
DateTime
€€ &
.
€€& '
UtcNow
€€' -
,
€€- .
}
‹‹ 
)
‹‹ 
;
‹‹ 
}
›› 	
}
ﬁﬁ 
}ﬂﬂ Ò-
_/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/ApplicationController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 	
)	 

]
 
[ 
Tags 
( 
$str 
) 
] 
public 
class !
ApplicationController "
:# $
ControllerBase% 3
{ 
private 
readonly 
ILogger 
< !
ApplicationController 2
>2 3
logger4 :
;: ;
public 
!
ApplicationController  
(  !
ILogger! (
<( )!
ApplicationController) >
>> ?
logger@ F
)F G
{ 
this 
. 
logger 
= 
logger 
; 
} 
[ 
HttpGet 
] 
public 

IActionResult 
Home 
( 
) 
{ 
var 
	jwsHeader 
= 
Convert 
.  
ToBase64String  .
(. /
Encoding/ 7
.7 8
UTF88 <
.< =
GetBytes= E
(E F
$strF ]
)] ^
)^ _
;_ `
this 
. 
logger 
. 
LogInformation "
(" #
$str# F
,F G
	jwsHeaderH Q
)Q R
;R S
foreach"" 
("" 
var"" 
header"" 
in"" 
this"" #
.""# $
Request""$ +
.""+ ,
Headers"", 3
)""3 4
{## 	
this$$ 
.$$ 
logger$$ 
.$$ 
LogInformation$$ *
($$* +
$str$$+ E
,$$E F
header$$G M
.$$M N
Key$$N Q
,$$Q R
header$$S Y
.$$Y Z
Value$$Z _
)$$_ `
;$$` a
}%% 	
return'' 
Ok'' 
('' 
$str'' ,
)'', -
;''- .
}(( 
[-- 
HttpGet-- 
(-- 
$str-- -
)--- .
]--. /
[.. 
	Authorize.. 
(.. 
Policy.. 
=.. 
$str.. ;
)..; <
]..< =
[//  
ProducesResponseType// 
(// 
typeof//  
(//  !
string//! '
)//' (
,//( )
$num//* -
)//- .
]//. /
[00  
ProducesResponseType00 
(00 
$num00 
)00 
]00 
[11  
ProducesResponseType11 
(11 
$num11 
)11 
]11 
public22 

IActionResult22 
	GetObject22 "
(22" #
[22# $
	FromQuery22$ -
]22- .
string22/ 5
id226 8
)228 9
{33 
this44 
.44 
logger44 
.44 
LogInformation44 "
(44" #
$str44# 5
,445 6
id447 9
)449 :
;44: ;
return55 
Ok55 
(55 
$str55 
)55 
;55 
}66 
[;; 
HttpPut;; 
(;; 
$str;; -
);;- .
];;. /
[<< 
	Authorize<< 
(<< 
Policy<< 
=<< 
$str<< <
)<<< =
]<<= >
[==  
ProducesResponseType== 
(== 
typeof==  
(==  !
string==! '
)==' (
,==( )
$num==* -
)==- .
]==. /
[>>  
ProducesResponseType>> 
(>> 
$num>> 
)>> 
]>> 
[??  
ProducesResponseType?? 
(?? 
$num?? 
)?? 
]?? 
public@@ 

IActionResult@@ 
	PutObject@@ "
(@@" #
[@@# $
	FromQuery@@$ -
]@@- .
string@@/ 5
id@@6 8
)@@8 9
{AA 
thisBB 
.BB 
loggerBB 
.BB 
LogInformationBB "
(BB" #
$strBB# 5
,BB5 6
idBB7 9
)BB9 :
;BB: ;
returnCC 
OkCC 
(CC 
$strCC 
)CC 
;CC 
}DD 
[II 

HttpDeleteII 
(II 
$strII 3
)II3 4
]II4 5
[JJ 
	AuthorizeJJ 
(JJ 
PolicyJJ 
=JJ 
$strJJ =
)JJ= >
]JJ> ?
[KK  
ProducesResponseTypeKK 
(KK 
typeofKK  
(KK  !
stringKK! '
)KK' (
,KK( )
$numKK* -
)KK- .
]KK. /
[LL  
ProducesResponseTypeLL 
(LL 
$numLL 
)LL 
]LL 
[MM  
ProducesResponseTypeMM 
(MM 
$numMM 
)MM 
]MM 
publicNN 

IActionResultNN 
DeleteObjectNN %
(NN% &
[NN& '
	FromQueryNN' 0
]NN0 1
stringNN2 8
idNN9 ;
)NN; <
{OO 
thisPP 
.PP 
loggerPP 
.PP 
LogInformationPP "
(PP" #
$strPP# 8
,PP8 9
idPP: <
)PP< =
;PP= >
returnQQ 
OkQQ 
(QQ 
$strQQ 
)QQ 
;QQ 
}RR 
}SS Ë‰
d/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/EnhancedAuthTestController.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Controllers *
;* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
[ 
Tags 
( 
$str #
)# $
]$ %
public 
class &
EnhancedAuthTestController '
:( )
ControllerBase* 8
{ 
private 
const 
string 
UnknownValue %
=& '
$str( 1
;1 2
private 
static 
readonly 
string "
[" #
]# $
NonePermissions% 4
=5 6
{7 8
$str9 ?
}@ A
;A B
private 
static 
readonly 
string "
[" #
]# $
BasicPermissions% 5
=6 7
{8 9
$str: H
}I J
;J K
private 
static 
readonly 
string "
[" #
]# $
UserPermissions% 4
=5 6
{7 8
$str9 F
,F G
$strH S
}T U
;U V
private 
static 
readonly 
string "
[" #
]# $
AdminPermissions% 5
=6 7
{8 9
$str: H
,H I
$strJ V
,V W
$strX e
}f g
;g h
private 
static 
readonly 
string "
[" #
]# $!
ManagementPermissions% :
=; <
{= >
$str? R
,R S
$strT f
}g h
;h i
private 
static 
readonly 
string "
[" #
]# $'
IdentityProviderPermissions% @
=A B
{C D
$strE _
}` a
;a b
private 
static 
readonly 
string "
[" #
]# $
HighAuthPermissions% 8
=9 :
{; <
$str= O
}P Q
;Q R
private 
static 
readonly 
string "
[" #
]# $
	NoneRoles% .
=/ 0
{1 2
$str3 9
}: ;
;; <
private 
const 
string 
PermissionClaimType ,
=- .
$str/ ;
;; <
public   
&
EnhancedAuthTestController   %
(  % &
)  & '
{!! 
}"" 
['' 
HttpGet'' 
('' 
$str'' 
)'' 
]'' 
[(( 
AllowAnonymous(( 
](( 
[))  
ProducesResponseType)) 
()) 
typeof))  
())  !
object))! '
)))' (
,))( )
$num))* -
)))- .
])). /
public** 

IActionResult** 
PublicEndpoint** '
(**' (
)**( )
{++ 
return,, 
Ok,, 
(,, 
new,, 
{-- 	
level.. 
=.. 
$num.. 
,.. 
message// 
=// 
$str// D
,//D E
	timestamp00 
=00 
DateTime00  
.00  !
UtcNow00! '
,00' (
user11 
=11 
UnknownValue11 
,11  
roles22 
=22 
	NoneRoles22 
,22 
permissions33 
=33 
NonePermissions33 )
,33) *
}44 	
)44	 

;44
 
}55 
[:: 
HttpGet:: 
(:: 
$str:: 
):: 
]:: 
[;; 
	Authorize;; 
];; 
[<<  
ProducesResponseType<< 
(<< 
typeof<<  
(<<  !
object<<! '
)<<' (
,<<( )
$num<<* -
)<<- .
]<<. /
public== 

IActionResult== !
AuthenticatedEndpoint== .
(==. /
)==/ 0
{>> 
var?? 
user?? 
=?? 
this?? 
.?? 
User?? 
.?? 
Identity?? %
???% &
.??& '
Name??' +
????, .
UnknownValue??/ ;
;??; <
var@@ 
roles@@ 
=@@ 
this@@ 
.@@ 
User@@ 
.@@ 
Claims@@ $
.AA 
WhereAA 
(AA 
cAA 
=>AA 
cAA 
.AA 
TypeAA 
==AA !

ClaimTypesAA" ,
.AA, -
RoleAA- 1
)AA1 2
.BB 
SelectBB 
(BB 
cBB 
=>BB 
cBB 
.BB 
ValueBB  
)BB  !
.CC 
ToArrayCC 
(CC 
)CC 
;CC 
returnEE 
OkEE 
(EE 
newEE 
{FF 	
levelGG 
=GG 
$numGG 
,GG 
messageHH 
=HH 
$strHH N
,HHN O
	timestampII 
=II 
DateTimeII  
.II  !
UtcNowII! '
,II' (
userJJ 
,JJ 
rolesKK 
,KK 
permissionsLL 
=LL 
BasicPermissionsLL *
,LL* +
}MM 	
)MM	 

;MM
 
}NN 
[SS 
HttpGetSS 
(SS 
$strSS 
)SS 
]SS 
[TT 
	AuthorizeTT 
(TT 
RolesTT 
=TT 
$strTT 
)TT 
]TT 
[UU  
ProducesResponseTypeUU 
(UU 
typeofUU  
(UU  !
objectUU! '
)UU' (
,UU( )
$numUU* -
)UU- .
]UU. /
publicVV 

IActionResultVV 
UserRoleEndpointVV )
(VV) *
)VV* +
{WW 
varXX 
userXX 
=XX 
thisXX 
.XX 
UserXX 
.XX 
IdentityXX %
?XX% &
.XX& '
NameXX' +
??XX, .
UnknownValueXX/ ;
;XX; <
varYY 
rolesYY 
=YY 
thisYY 
.YY 
UserYY 
.YY 
ClaimsYY $
.ZZ 
WhereZZ 
(ZZ 
cZZ 
=>ZZ 
cZZ 
.ZZ 
TypeZZ 
==ZZ !

ClaimTypesZZ" ,
.ZZ, -
RoleZZ- 1
)ZZ1 2
.[[ 
Select[[ 
([[ 
c[[ 
=>[[ 
c[[ 
.[[ 
Value[[  
)[[  !
.\\ 
ToArray\\ 
(\\ 
)\\ 
;\\ 
return^^ 
Ok^^ 
(^^ 
new^^ 
{__ 	
level`` 
=`` 
$num`` 
,`` 
messageaa 
=aa 
$straa ?
,aa? @
	timestampbb 
=bb 
DateTimebb  
.bb  !
UtcNowbb! '
,bb' (
usercc 
,cc 
rolesdd 
,dd 
permissionsee 
=ee 
UserPermissionsee )
,ee) *
}ff 	
)ff	 

;ff
 
}gg 
[ll 
HttpGetll 
(ll 
$strll 
)ll 
]ll 
[mm 
	Authorizemm 
(mm 
Rolesmm 
=mm 
$strmm 
)mm 
]mm  
[nn  
ProducesResponseTypenn 
(nn 
typeofnn  
(nn  !
objectnn! '
)nn' (
,nn( )
$numnn* -
)nn- .
]nn. /
publicoo 

IActionResultoo 
AdminRoleEndpointoo *
(oo* +
)oo+ ,
{pp 
varqq 
userqq 
=qq 
thisqq 
.qq 
Userqq 
.qq 
Identityqq %
?qq% &
.qq& '
Nameqq' +
??qq, .
UnknownValueqq/ ;
;qq; <
varrr 
rolesrr 
=rr 
thisrr 
.rr 
Userrr 
.rr 
Claimsrr $
.ss 
Wheress 
(ss 
css 
=>ss 
css 
.ss 
Typess 
==ss !

ClaimTypesss" ,
.ss, -
Roless- 1
)ss1 2
.tt 
Selecttt 
(tt 
ctt 
=>tt 
ctt 
.tt 
Valuett  
)tt  !
.uu 
ToArrayuu 
(uu 
)uu 
;uu 
returnww 
Okww 
(ww 
newww 
{xx 	
levelyy 
=yy 
$numyy 
,yy 
messagezz 
=zz 
$strzz A
,zzA B
	timestamp{{ 
={{ 
DateTime{{  
.{{  !
UtcNow{{! '
,{{' (
user|| 
,|| 
roles}} 
,}} 
permissions~~ 
=~~ 
AdminPermissions~~ *
,~~* +
} 	
)	 

;
 
}
ÄÄ 
[
ÖÖ 
HttpGet
ÖÖ 
(
ÖÖ 
$str
ÖÖ 
)
ÖÖ 
]
ÖÖ 
[
ÜÜ 
	Authorize
ÜÜ 
(
ÜÜ 
Policy
ÜÜ 
=
ÜÜ 
$str
ÜÜ )
)
ÜÜ) *
]
ÜÜ* +
[
áá "
ProducesResponseType
áá 
(
áá 
typeof
áá  
(
áá  !
object
áá! '
)
áá' (
,
áá( )
$num
áá* -
)
áá- .
]
áá. /
public
àà 

IActionResult
àà 
CacheReadEndpoint
àà *
(
àà* +
)
àà+ ,
{
ââ 
var
ää 
user
ää 
=
ää 
this
ää 
.
ää 
User
ää 
.
ää 
Identity
ää %
?
ää% &
.
ää& '
Name
ää' +
??
ää, .
UnknownValue
ää/ ;
;
ää; <
var
ãã 
roles
ãã 
=
ãã 
this
ãã 
.
ãã 
User
ãã 
.
ãã 
Claims
ãã $
.
åå 
Where
åå 
(
åå 
c
åå 
=>
åå 
c
åå 
.
åå 
Type
åå 
==
åå !

ClaimTypes
åå" ,
.
åå, -
Role
åå- 1
)
åå1 2
.
çç 
Select
çç 
(
çç 
c
çç 
=>
çç 
c
çç 
.
çç 
Value
çç  
)
çç  !
.
éé 
ToArray
éé 
(
éé 
)
éé 
;
éé 
var
èè 
permissions
èè 
=
èè 
this
èè 
.
èè 
User
èè #
.
èè# $
Claims
èè$ *
.
êê 
Where
êê 
(
êê 
c
êê 
=>
êê 
c
êê 
.
êê 
Type
êê 
==
êê !!
PermissionClaimType
êê" 5
)
êê5 6
.
ëë 
Select
ëë 
(
ëë 
c
ëë 
=>
ëë 
c
ëë 
.
ëë 
Value
ëë  
)
ëë  !
.
íí 
ToArray
íí 
(
íí 
)
íí 
;
íí 
return
îî 
Ok
îî 
(
îî 
new
îî 
{
ïï 	
level
ññ 
=
ññ 
$num
ññ 
,
ññ 
message
óó 
=
óó 
$str
óó L
,
óóL M
	timestamp
òò 
=
òò 
DateTime
òò  
.
òò  !
UtcNow
òò! '
,
òò' (
user
ôô 
,
ôô 
roles
öö 
,
öö 
permissions
õõ 
,
õõ 
}
úú 	
)
úú	 

;
úú
 
}
ùù 
[
¢¢ 
HttpGet
¢¢ 
(
¢¢ 
$str
¢¢ 
)
¢¢ 
]
¢¢ 
[
££ 
	Authorize
££ 
(
££ 
Policy
££ 
=
££ 
$str
££ *
)
££* +
]
££+ ,
[
§§ "
ProducesResponseType
§§ 
(
§§ 
typeof
§§  
(
§§  !
object
§§! '
)
§§' (
,
§§( )
$num
§§* -
)
§§- .
]
§§. /
public
•• 

IActionResult
••  
CacheWriteEndpoint
•• +
(
••+ ,
)
••, -
{
¶¶ 
var
ßß 
user
ßß 
=
ßß 
this
ßß 
.
ßß 
User
ßß 
.
ßß 
Identity
ßß %
?
ßß% &
.
ßß& '
Name
ßß' +
??
ßß, .
UnknownValue
ßß/ ;
;
ßß; <
var
®® 
roles
®® 
=
®® 
this
®® 
.
®® 
User
®® 
.
®® 
Claims
®® $
.
©© 
Where
©© 
(
©© 
c
©© 
=>
©© 
c
©© 
.
©© 
Type
©© 
==
©© !

ClaimTypes
©©" ,
.
©©, -
Role
©©- 1
)
©©1 2
.
™™ 
Select
™™ 
(
™™ 
c
™™ 
=>
™™ 
c
™™ 
.
™™ 
Value
™™  
)
™™  !
.
´´ 
ToArray
´´ 
(
´´ 
)
´´ 
;
´´ 
var
¨¨ 
permissions
¨¨ 
=
¨¨ 
this
¨¨ 
.
¨¨ 
User
¨¨ #
.
¨¨# $
Claims
¨¨$ *
.
≠≠ 
Where
≠≠ 
(
≠≠ 
c
≠≠ 
=>
≠≠ 
c
≠≠ 
.
≠≠ 
Type
≠≠ 
==
≠≠ !!
PermissionClaimType
≠≠" 5
)
≠≠5 6
.
ÆÆ 
Select
ÆÆ 
(
ÆÆ 
c
ÆÆ 
=>
ÆÆ 
c
ÆÆ 
.
ÆÆ 
Value
ÆÆ  
)
ÆÆ  !
.
ØØ 
ToArray
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
return
±± 
Ok
±± 
(
±± 
new
±± 
{
≤≤ 	
level
≥≥ 
=
≥≥ 
$num
≥≥ 
,
≥≥ 
message
¥¥ 
=
¥¥ 
$str
¥¥ N
,
¥¥N O
	timestamp
µµ 
=
µµ 
DateTime
µµ  
.
µµ  !
UtcNow
µµ! '
,
µµ' (
user
∂∂ 
,
∂∂ 
roles
∑∑ 
,
∑∑ 
permissions
∏∏ 
,
∏∏ 
}
ππ 	
)
ππ	 

;
ππ
 
}
∫∫ 
[
øø 
HttpGet
øø 
(
øø 
$str
øø 
)
øø  
]
øø  !
[
¿¿ 
	Authorize
¿¿ 
(
¿¿ 
Roles
¿¿ 
=
¿¿ 
$str
¿¿ &
)
¿¿& '
]
¿¿' (
[
¡¡ "
ProducesResponseType
¡¡ 
(
¡¡ 
typeof
¡¡  
(
¡¡  !
object
¡¡! '
)
¡¡' (
,
¡¡( )
$num
¡¡* -
)
¡¡- .
]
¡¡. /
public
¬¬ 

IActionResult
¬¬ $
AdminOrManagerEndpoint
¬¬ /
(
¬¬/ 0
)
¬¬0 1
{
√√ 
var
ƒƒ 
user
ƒƒ 
=
ƒƒ 
this
ƒƒ 
.
ƒƒ 
User
ƒƒ 
.
ƒƒ 
Identity
ƒƒ %
?
ƒƒ% &
.
ƒƒ& '
Name
ƒƒ' +
??
ƒƒ, .
UnknownValue
ƒƒ/ ;
;
ƒƒ; <
var
≈≈ 
roles
≈≈ 
=
≈≈ 
this
≈≈ 
.
≈≈ 
User
≈≈ 
.
≈≈ 
Claims
≈≈ $
.
∆∆ 
Where
∆∆ 
(
∆∆ 
c
∆∆ 
=>
∆∆ 
c
∆∆ 
.
∆∆ 
Type
∆∆ 
==
∆∆ !

ClaimTypes
∆∆" ,
.
∆∆, -
Role
∆∆- 1
)
∆∆1 2
.
«« 
Select
«« 
(
«« 
c
«« 
=>
«« 
c
«« 
.
«« 
Value
««  
)
««  !
.
»» 
ToArray
»» 
(
»» 
)
»» 
;
»» 
return
   
Ok
   
(
   
new
   
{
ÀÀ 	
level
ÃÃ 
=
ÃÃ 
$num
ÃÃ 
,
ÃÃ 
message
ÕÕ 
=
ÕÕ 
$str
ÕÕ R
,
ÕÕR S
	timestamp
ŒŒ 
=
ŒŒ 
DateTime
ŒŒ  
.
ŒŒ  !
UtcNow
ŒŒ! '
,
ŒŒ' (
user
œœ 
,
œœ 
roles
–– 
,
–– 
permissions
—— 
=
—— #
ManagementPermissions
—— /
,
——/ 0
}
““ 	
)
““	 

;
““
 
}
”” 
[
ÿÿ 
HttpGet
ÿÿ 
(
ÿÿ 
$str
ÿÿ  
)
ÿÿ  !
]
ÿÿ! "
[
ŸŸ 
	Authorize
ŸŸ 
(
ŸŸ 
Roles
ŸŸ 
=
ŸŸ 
$str
ŸŸ 
,
ŸŸ 
Policy
ŸŸ  &
=
ŸŸ' (
$str
ŸŸ) ;
)
ŸŸ; <
]
ŸŸ< =
[
⁄⁄ "
ProducesResponseType
⁄⁄ 
(
⁄⁄ 
typeof
⁄⁄  
(
⁄⁄  !
object
⁄⁄! '
)
⁄⁄' (
,
⁄⁄( )
$num
⁄⁄* -
)
⁄⁄- .
]
⁄⁄. /
public
€€ 

IActionResult
€€ %
AdminCacheWriteEndpoint
€€ 0
(
€€0 1
)
€€1 2
{
‹‹ 
var
›› 
user
›› 
=
›› 
this
›› 
.
›› 
User
›› 
.
›› 
Identity
›› %
?
››% &
.
››& '
Name
››' +
??
››, .
UnknownValue
››/ ;
;
››; <
var
ﬁﬁ 
roles
ﬁﬁ 
=
ﬁﬁ 
this
ﬁﬁ 
.
ﬁﬁ 
User
ﬁﬁ 
.
ﬁﬁ 
Claims
ﬁﬁ $
.
ﬂﬂ 
Where
ﬂﬂ 
(
ﬂﬂ 
c
ﬂﬂ 
=>
ﬂﬂ 
c
ﬂﬂ 
.
ﬂﬂ 
Type
ﬂﬂ 
==
ﬂﬂ !

ClaimTypes
ﬂﬂ" ,
.
ﬂﬂ, -
Role
ﬂﬂ- 1
)
ﬂﬂ1 2
.
‡‡ 
Select
‡‡ 
(
‡‡ 
c
‡‡ 
=>
‡‡ 
c
‡‡ 
.
‡‡ 
Value
‡‡  
)
‡‡  !
.
·· 
ToArray
·· 
(
·· 
)
·· 
;
·· 
var
‚‚ 
permissions
‚‚ 
=
‚‚ 
this
‚‚ 
.
‚‚ 
User
‚‚ #
.
‚‚# $
Claims
‚‚$ *
.
„„ 
Where
„„ 
(
„„ 
c
„„ 
=>
„„ 
c
„„ 
.
„„ 
Type
„„ 
==
„„ !!
PermissionClaimType
„„" 5
)
„„5 6
.
‰‰ 
Select
‰‰ 
(
‰‰ 
c
‰‰ 
=>
‰‰ 
c
‰‰ 
.
‰‰ 
Value
‰‰  
)
‰‰  !
.
ÂÂ 
ToArray
ÂÂ 
(
ÂÂ 
)
ÂÂ 
;
ÂÂ 
return
ÁÁ 
Ok
ÁÁ 
(
ÁÁ 
new
ÁÁ 
{
ËË 	
level
ÈÈ 
=
ÈÈ 
$num
ÈÈ 
,
ÈÈ 
message
ÍÍ 
=
ÍÍ 
$str
ÍÍ c
,
ÍÍc d
	timestamp
ÎÎ 
=
ÎÎ 
DateTime
ÎÎ  
.
ÎÎ  !
UtcNow
ÎÎ! '
,
ÎÎ' (
user
ÏÏ 
,
ÏÏ 
roles
ÌÌ 
,
ÌÌ 
permissions
ÓÓ 
,
ÓÓ 
}
ÔÔ 	
)
ÔÔ	 

;
ÔÔ
 
}
 
[
ıı 
HttpGet
ıı 
(
ıı 
$str
ıı  
)
ıı  !
]
ıı! "
[
ˆˆ 
	Authorize
ˆˆ 
(
ˆˆ 
Policy
ˆˆ 
=
ˆˆ 
$str
ˆˆ 0
)
ˆˆ0 1
]
ˆˆ1 2
[
˜˜ "
ProducesResponseType
˜˜ 
(
˜˜ 
typeof
˜˜  
(
˜˜  !
object
˜˜! '
)
˜˜' (
,
˜˜( )
$num
˜˜* -
)
˜˜- .
]
˜˜. /
public
¯¯ 

IActionResult
¯¯ &
IdentityProviderEndpoint
¯¯ 1
(
¯¯1 2
)
¯¯2 3
{
˘˘ 
var
˙˙ 
user
˙˙ 
=
˙˙ 
this
˙˙ 
.
˙˙ 
User
˙˙ 
.
˙˙ 
Identity
˙˙ %
?
˙˙% &
.
˙˙& '
Name
˙˙' +
??
˙˙, .
UnknownValue
˙˙/ ;
;
˙˙; <
var
˚˚ 
roles
˚˚ 
=
˚˚ 
this
˚˚ 
.
˚˚ 
User
˚˚ 
.
˚˚ 
Claims
˚˚ $
.
¸¸ 
Where
¸¸ 
(
¸¸ 
c
¸¸ 
=>
¸¸ 
c
¸¸ 
.
¸¸ 
Type
¸¸ 
==
¸¸ !

ClaimTypes
¸¸" ,
.
¸¸, -
Role
¸¸- 1
)
¸¸1 2
.
˝˝ 
Select
˝˝ 
(
˝˝ 
c
˝˝ 
=>
˝˝ 
c
˝˝ 
.
˝˝ 
Value
˝˝  
)
˝˝  !
.
˛˛ 
ToArray
˛˛ 
(
˛˛ 
)
˛˛ 
;
˛˛ 
var
ˇˇ 
identityProvider
ˇˇ 
=
ˇˇ 
this
ˇˇ #
.
ˇˇ# $
User
ˇˇ$ (
.
ˇˇ( )
Claims
ˇˇ) /
.
ÄÄ 
FirstOrDefault
ÄÄ 
(
ÄÄ 
c
ÄÄ 
=>
ÄÄ  
c
ÄÄ! "
.
ÄÄ" #
Type
ÄÄ# '
==
ÄÄ( *
$str
ÄÄ+ >
)
ÄÄ> ?
?
ÄÄ? @
.
ÄÄ@ A
Value
ÄÄA F
??
ÄÄG I
UnknownValue
ÄÄJ V
;
ÄÄV W
return
ÇÇ 
Ok
ÇÇ 
(
ÇÇ 
new
ÇÇ 
{
ÉÉ 	
level
ÑÑ 
=
ÑÑ 
$num
ÑÑ 
,
ÑÑ 
message
ÖÖ 
=
ÖÖ 
$str
ÖÖ X
,
ÖÖX Y
	timestamp
ÜÜ 
=
ÜÜ 
DateTime
ÜÜ  
.
ÜÜ  !
UtcNow
ÜÜ! '
,
ÜÜ' (
user
áá 
,
áá 
roles
àà 
,
àà 
identityProvider
ââ 
,
ââ 
permissions
ää 
=
ää )
IdentityProviderPermissions
ää 5
,
ää5 6
}
ãã 	
)
ãã	 

;
ãã
 
}
åå 
[
ëë 
HttpGet
ëë 
(
ëë 
$str
ëë 
)
ëë 
]
ëë 
[
íí 
	Authorize
íí 
(
íí 
Policy
íí 
=
íí 
$str
íí )
)
íí) *
]
íí* +
[
ìì "
ProducesResponseType
ìì 
(
ìì 
typeof
ìì  
(
ìì  !
object
ìì! '
)
ìì' (
,
ìì( )
$num
ìì* -
)
ìì- .
]
ìì. /
public
îî 

IActionResult
îî 
AuthLevelEndpoint
îî *
(
îî* +
)
îî+ ,
{
ïï 
var
ññ 
user
ññ 
=
ññ 
this
ññ 
.
ññ 
User
ññ 
.
ññ 
Identity
ññ %
?
ññ% &
.
ññ& '
Name
ññ' +
??
ññ, .
UnknownValue
ññ/ ;
;
ññ; <
var
óó 
roles
óó 
=
óó 
this
óó 
.
óó 
User
óó 
.
óó 
Claims
óó $
.
òò 
Where
òò 
(
òò 
c
òò 
=>
òò 
c
òò 
.
òò 
Type
òò 
==
òò !

ClaimTypes
òò" ,
.
òò, -
Role
òò- 1
)
òò1 2
.
ôô 
Select
ôô 
(
ôô 
c
ôô 
=>
ôô 
c
ôô 
.
ôô 
Value
ôô  
)
ôô  !
.
öö 
ToArray
öö 
(
öö 
)
öö 
;
öö 
var
õõ 
	authLevel
õõ 
=
õõ 
this
õõ 
.
õõ 
User
õõ !
.
õõ! "
Claims
õõ" (
.
úú 
FirstOrDefault
úú 
(
úú 
c
úú 
=>
úú  
c
úú! "
.
úú" #
Type
úú# '
==
úú( *
$str
úú+ 7
)
úú7 8
?
úú8 9
.
úú9 :
Value
úú: ?
??
úú@ B
UnknownValue
úúC O
;
úúO P
return
ûû 
Ok
ûû 
(
ûû 
new
ûû 
{
üü 	
level
†† 
=
†† 
$num
†† 
,
†† 
message
°° 
=
°° 
$str
°° T
,
°°T U
	timestamp
¢¢ 
=
¢¢ 
DateTime
¢¢  
.
¢¢  !
UtcNow
¢¢! '
,
¢¢' (
user
££ 
,
££ 
roles
§§ 
,
§§ 
	authLevel
•• 
,
•• 
permissions
¶¶ 
=
¶¶ !
HighAuthPermissions
¶¶ -
,
¶¶- .
}
ßß 	
)
ßß	 

;
ßß
 
}
®® 
[
≠≠ 
HttpGet
≠≠ 
(
≠≠ 
$str
≠≠ 
)
≠≠  
]
≠≠  !
[
ÆÆ 
	Authorize
ÆÆ 
(
ÆÆ 
Roles
ÆÆ 
=
ÆÆ 
$str
ÆÆ 
,
ÆÆ 
Policy
ÆÆ  &
=
ÆÆ' (
$str
ÆÆ) b
)
ÆÆb c
]
ÆÆc d
[
ØØ "
ProducesResponseType
ØØ 
(
ØØ 
typeof
ØØ  
(
ØØ  !
object
ØØ! '
)
ØØ' (
,
ØØ( )
$num
ØØ* -
)
ØØ- .
]
ØØ. /
public
∞∞ 

IActionResult
∞∞ %
MaximumSecurityEndpoint
∞∞ 0
(
∞∞0 1
)
∞∞1 2
{
±± 
var
≤≤ 
user
≤≤ 
=
≤≤ 
this
≤≤ 
.
≤≤ 
User
≤≤ 
.
≤≤ 
Identity
≤≤ %
?
≤≤% &
.
≤≤& '
Name
≤≤' +
??
≤≤, .
UnknownValue
≤≤/ ;
;
≤≤; <
var
≥≥ 
roles
≥≥ 
=
≥≥ 
this
≥≥ 
.
≥≥ 
User
≥≥ 
.
≥≥ 
Claims
≥≥ $
.
¥¥ 
Where
¥¥ 
(
¥¥ 
c
¥¥ 
=>
¥¥ 
c
¥¥ 
.
¥¥ 
Type
¥¥ 
==
¥¥ !

ClaimTypes
¥¥" ,
.
¥¥, -
Role
¥¥- 1
)
¥¥1 2
.
µµ 
Select
µµ 
(
µµ 
c
µµ 
=>
µµ 
c
µµ 
.
µµ 
Value
µµ  
)
µµ  !
.
∂∂ 
ToArray
∂∂ 
(
∂∂ 
)
∂∂ 
;
∂∂ 
var
∑∑ 
permissions
∑∑ 
=
∑∑ 
this
∑∑ 
.
∑∑ 
User
∑∑ #
.
∑∑# $
Claims
∑∑$ *
.
∏∏ 
Where
∏∏ 
(
∏∏ 
c
∏∏ 
=>
∏∏ 
c
∏∏ 
.
∏∏ 
Type
∏∏ 
==
∏∏ !!
PermissionClaimType
∏∏" 5
)
∏∏5 6
.
ππ 
Select
ππ 
(
ππ 
c
ππ 
=>
ππ 
c
ππ 
.
ππ 
Value
ππ  
)
ππ  !
.
∫∫ 
ToArray
∫∫ 
(
∫∫ 
)
∫∫ 
;
∫∫ 
var
ªª 
identityProvider
ªª 
=
ªª 
this
ªª #
.
ªª# $
User
ªª$ (
.
ªª( )
Claims
ªª) /
.
ºº 
FirstOrDefault
ºº 
(
ºº 
c
ºº 
=>
ºº  
c
ºº! "
.
ºº" #
Type
ºº# '
==
ºº( *
$str
ºº+ >
)
ºº> ?
?
ºº? @
.
ºº@ A
Value
ººA F
??
ººG I
UnknownValue
ººJ V
;
ººV W
var
ΩΩ 
	authLevel
ΩΩ 
=
ΩΩ 
this
ΩΩ 
.
ΩΩ 
User
ΩΩ !
.
ΩΩ! "
Claims
ΩΩ" (
.
ææ 
FirstOrDefault
ææ 
(
ææ 
c
ææ 
=>
ææ  
c
ææ! "
.
ææ" #
Type
ææ# '
==
ææ( *
$str
ææ+ 7
)
ææ7 8
?
ææ8 9
.
ææ9 :
Value
ææ: ?
??
ææ@ B
UnknownValue
ææC O
;
ææO P
return
¿¿ 
Ok
¿¿ 
(
¿¿ 
new
¿¿ 
{
¡¡ 	
level
¬¬ 
=
¬¬ 
$num
¬¬ 
,
¬¬ 
message
√√ 
=
√√ 
$str
√√ R
,
√√R S
	timestamp
ƒƒ 
=
ƒƒ 
DateTime
ƒƒ  
.
ƒƒ  !
UtcNow
ƒƒ! '
,
ƒƒ' (
user
≈≈ 
,
≈≈ 
roles
∆∆ 
,
∆∆ 
permissions
«« 
,
«« 
identityProvider
»» 
,
»» 
	authLevel
…… 
,
…… 
}
   	
)
  	 

;
  
 
}
ÀÀ 
}ÃÃ ÍF
]/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Authorization/PermissionHandler.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Authorization ,
;, -
internal 
class	 
PermissionHandler  
:! " 
AuthorizationHandler# 7
<7 8!
PermissionRequirement8 M
>M N
{ 
	protected 
override 
Task "
HandleRequirementAsync 2
(2 3'
AuthorizationHandlerContext3 N
contextO V
,V W!
PermissionRequirementX m
requirementn y
)y z
{ !
ArgumentNullException 
. 
ThrowIfNull )
() *
context* 1
)1 2
;2 3!
ArgumentNullException 
. 
ThrowIfNull )
() *
requirement* 5
)5 6
;6 7
var 
hasPermission 
= 
context #
.# $
User$ (
.( )
HasClaim) 1
(1 2
$str2 >
,> ?
requirement@ K
.K L

PermissionL V
)V W
;W X
if 

( 
hasPermission 
) 
{ 	
context 
. 
Succeed 
( 
requirement '
)' (
;( )
} 	
return 
Task 
. 
CompletedTask !
;! "
} 
} 
internal"" 
class""	  
AnyPermissionHandler"" #
:""$ % 
AuthorizationHandler""& :
<"": ;$
AnyPermissionRequirement""; S
>""S T
{## 
	protected$$ 
override$$ 
Task$$ "
HandleRequirementAsync$$ 2
($$2 3'
AuthorizationHandlerContext$$3 N
context$$O V
,$$V W$
AnyPermissionRequirement$$X p
requirement$$q |
)$$| }
{%% !
ArgumentNullException&& 
.&& 
ThrowIfNull&& )
(&&) *
context&&* 1
)&&1 2
;&&2 3!
ArgumentNullException'' 
.'' 
ThrowIfNull'' )
('') *
requirement''* 5
)''5 6
;''6 7
var)) 
hasAnyPermission)) 
=)) 
requirement)) *
.))* +
Permissions))+ 6
.))6 7
Any))7 :
()): ;

permission)); E
=>))F H
context** 
.** 
User** 
.** 
HasClaim** !
(**! "
$str**" .
,**. /

permission**0 :
)**: ;
)**; <
;**< =
if,, 

(,, 
hasAnyPermission,, 
),, 
{-- 	
context.. 
... 
Succeed.. 
(.. 
requirement.. '
)..' (
;..( )
}// 	
return11 
Task11 
.11 
CompletedTask11 !
;11! "
}22 
}33 
internal88 
class88	 !
AllPermissionsHandler88 $
:88% & 
AuthorizationHandler88' ;
<88; <%
AllPermissionsRequirement88< U
>88U V
{99 
	protected:: 
override:: 
Task:: "
HandleRequirementAsync:: 2
(::2 3'
AuthorizationHandlerContext::3 N
context::O V
,::V W%
AllPermissionsRequirement::X q
requirement::r }
)::} ~
{;; !
ArgumentNullException<< 
.<< 
ThrowIfNull<< )
(<<) *
context<<* 1
)<<1 2
;<<2 3!
ArgumentNullException== 
.== 
ThrowIfNull== )
(==) *
requirement==* 5
)==5 6
;==6 7
var?? 
hasAllPermissions?? 
=?? 
requirement??  +
.??+ ,
Permissions??, 7
.??7 8
All??8 ;
(??; <

permission??< F
=>??G I
context@@ 
.@@ 
User@@ 
.@@ 
HasClaim@@ !
(@@! "
$str@@" .
,@@. /

permission@@0 :
)@@: ;
)@@; <
;@@< =
ifBB 

(BB 
hasAllPermissionsBB 
)BB 
{CC 	
contextDD 
.DD 
SucceedDD 
(DD 
requirementDD '
)DD' (
;DD( )
}EE 	
returnGG 
TaskGG 
.GG 
CompletedTaskGG !
;GG! "
}HH 
}II 
internalNN 
classNN	 
RoleHandlerNN 
:NN  
AuthorizationHandlerNN 1
<NN1 2
RoleRequirementNN2 A
>NNA B
{OO 
	protectedPP 
overridePP 
TaskPP "
HandleRequirementAsyncPP 2
(PP2 3'
AuthorizationHandlerContextPP3 N
contextPPO V
,PPV W
RoleRequirementPPX g
requirementPPh s
)PPs t
{QQ !
ArgumentNullExceptionRR 
.RR 
ThrowIfNullRR )
(RR) *
contextRR* 1
)RR1 2
;RR2 3!
ArgumentNullExceptionSS 
.SS 
ThrowIfNullSS )
(SS) *
requirementSS* 5
)SS5 6
;SS6 7
varUU 
hasRoleUU 
=UU 
contextUU 
.UU 
UserUU "
.UU" #
IsInRoleUU# +
(UU+ ,
requirementUU, 7
.UU7 8
RoleUU8 <
)UU< =
;UU= >
ifWW 

(WW 
hasRoleWW 
)WW 
{XX 	
contextYY 
.YY 
SucceedYY 
(YY 
requirementYY '
)YY' (
;YY( )
}ZZ 	
return\\ 
Task\\ 
.\\ 
CompletedTask\\ !
;\\! "
}]] 
}^^ 
internalcc 
classcc	 #
IdentityProviderHandlercc &
:cc' ( 
AuthorizationHandlercc) =
<cc= >'
IdentityProviderRequirementcc> Y
>ccY Z
{dd 
	protectedee 
overrideee 
Taskee "
HandleRequirementAsyncee 2
(ee2 3'
AuthorizationHandlerContextee3 N
contexteeO V
,eeV W'
IdentityProviderRequirementeeX s
requirementeet 
)	ee Ä
{ff !
ArgumentNullExceptiongg 
.gg 
ThrowIfNullgg )
(gg) *
contextgg* 1
)gg1 2
;gg2 3!
ArgumentNullExceptionhh 
.hh 
ThrowIfNullhh )
(hh) *
requirementhh* 5
)hh5 6
;hh6 7
varjj 
identityProviderjj 
=jj 
contextjj &
.jj& '
Userjj' +
.jj+ ,
	FindFirstjj, 5
(jj5 6
$strjj6 I
)jjI J
?jjJ K
.jjK L
ValuejjL Q
;jjQ R
ifll 

(ll 
identityProviderll 
==ll 
requirementll  +
.ll+ ,$
RequiredIdentityProviderll, D
)llD E
{mm 	
contextnn 
.nn 
Succeednn 
(nn 
requirementnn '
)nn' (
;nn( )
}oo 	
returnqq 
Taskqq 
.qq 
CompletedTaskqq !
;qq! "
}rr 
}ss 
internalxx 
classxx	 
AuthLevelHandlerxx 
:xx  ! 
AuthorizationHandlerxx" 6
<xx6 7 
AuthLevelRequirementxx7 K
>xxK L
{yy 
	protectedzz 
overridezz 
Taskzz "
HandleRequirementAsynczz 2
(zz2 3'
AuthorizationHandlerContextzz3 N
contextzzO V
,zzV W 
AuthLevelRequirementzzX l
requirementzzm x
)zzx y
{{{ !
ArgumentNullException|| 
.|| 
ThrowIfNull|| )
(||) *
context||* 1
)||1 2
;||2 3!
ArgumentNullException}} 
.}} 
ThrowIfNull}} )
(}}) *
requirement}}* 5
)}}5 6
;}}6 7
var 
	authLevel 
= 
context 
.  
User  $
.$ %
	FindFirst% .
(. /
$str/ ;
); <
?< =
.= >
Value> C
;C D
if
ÅÅ 

(
ÅÅ 
	authLevel
ÅÅ 
==
ÅÅ 
requirement
ÅÅ $
.
ÅÅ$ %
RequiredAuthLevel
ÅÅ% 6
)
ÅÅ6 7
{
ÇÇ 	
context
ÉÉ 
.
ÉÉ 
Succeed
ÉÉ 
(
ÉÉ 
requirement
ÉÉ '
)
ÉÉ' (
;
ÉÉ( )
}
ÑÑ 	
return
ÜÜ 
Task
ÜÜ 
.
ÜÜ 
CompletedTask
ÜÜ !
;
ÜÜ! "
}
áá 
}àà 