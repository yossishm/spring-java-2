âI
V/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Services/LocalRestClient.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Services '
;' (
public 
class 
LocalRestClient 
: 
IDisposable *
{ 
private 
readonly 

HttpClient 
_httpClient  +
;+ ,
private 
readonly 
string 
_server #
=$ %
$str& =
;= >
public 

LocalRestClient 
( 
string !
authorization" /
=0 1
$str2 4
)4 5
{ 
this 
. 
_httpClient 
= 
new 

HttpClient )
() *
)* +
;+ ,
this 
. 
_httpClient 
. !
DefaultRequestHeaders .
.. /
Add/ 2
(2 3
$str3 A
,A B
$strC U
)U V
;V W
this 
. 
_httpClient 
. !
DefaultRequestHeaders .
.. /
Add/ 2
(2 3
$str3 ;
,; <
$str= B
)B C
;C D
var 
	jwsHeader 
= 
Convert 
.  
ToBase64String  .
(. /
Encoding/ 7
.7 8
UTF88 <
.< =
GetBytes= E
(E F
$strF ]
)] ^
)^ _
;_ `
this 
. 
_httpClient 
. !
DefaultRequestHeaders .
.. /
Add/ 2
(2 3
	jwsHeader3 <
,< =
authorization> K
)K L
;L M
} 
public   

async   
Task   
<   
string   
>   
GetAsync   &
(  & '
Uri  ' *
uri  + .
)  . /
{!! 
try"" 
{## 	
var$$ 
response$$ 
=$$ 
await$$  
this$$! %
.$$% &
_httpClient$$& 1
.$$1 2
GetAsync$$2 :
($$: ;
new$$; >
Uri$$? B
($$B C
this$$C G
.$$G H
_server$$H O
+$$P Q
uri$$R U
.$$U V
ToString$$V ^
($$^ _
)$$_ `
)$$` a
)$$a b
.$$b c
ConfigureAwait$$c q
($$q r
false$$r w
)$$w x
;$$x y
var%% 
content%% 
=%% 
await%% 
response%%  (
.%%( )
Content%%) 0
.%%0 1
ReadAsStringAsync%%1 B
(%%B C
)%%C D
.%%D E
ConfigureAwait%%E S
(%%S T
false%%T Y
)%%Y Z
;%%Z [
return&& 
content&& 
;&& 
}'' 	
catch(( 
((( 
	Exception(( 
ex(( 
)(( 
{)) 	
throw** 
new**  
HttpRequestException** *
(*** +
$"**+ -
$str**- A
{**A B
ex**B D
.**D E
Message**E L
}**L M
"**M N
,**N O
ex**P R
)**R S
;**S T
}++ 	
},, 
public11 

async11 
Task11 
<11 
string11 
>11 
	PostAsync11 '
(11' (
Uri11( +
uri11, /
,11/ 0
string111 7
json118 <
)11< =
{22 
try33 
{44 	
using55 
var55 
content55 
=55 
new55  #
StringContent55$ 1
(551 2
json552 6
,556 7
Encoding558 @
.55@ A
UTF855A E
,55E F
$str55G Y
)55Y Z
;55Z [
var66 
response66 
=66 
await66  
this66! %
.66% &
_httpClient66& 1
.661 2
	PostAsync662 ;
(66; <
new66< ?
Uri66@ C
(66C D
this66D H
.66H I
_server66I P
+66Q R
uri66S V
.66V W
ToString66W _
(66_ `
)66` a
)66a b
,66b c
content66d k
)66k l
.66l m
ConfigureAwait66m {
(66{ |
false	66| Å
)
66Å Ç
;
66Ç É
var77 
responseContent77 
=77  !
await77" '
response77( 0
.770 1
Content771 8
.778 9
ReadAsStringAsync779 J
(77J K
)77K L
.77L M
ConfigureAwait77M [
(77[ \
false77\ a
)77a b
;77b c
return88 
responseContent88 "
;88" #
}99 	
catch:: 
(:: 
	Exception:: 
ex:: 
):: 
{;; 	
throw<< 
new<<  
HttpRequestException<< *
(<<* +
$"<<+ -
$str<<- B
{<<B C
ex<<C E
.<<E F
Message<<F M
}<<M N
"<<N O
,<<O P
ex<<Q S
)<<S T
;<<T U
}== 	
}>> 
publicCC 

asyncCC 
TaskCC 
<CC 
stringCC 
>CC 
PutAsyncCC &
(CC& '
UriCC' *
uriCC+ .
,CC. /
stringCC0 6
jsonCC7 ;
)CC; <
{DD 
tryEE 
{FF 	
usingGG 
varGG 
contentGG 
=GG 
newGG  #
StringContentGG$ 1
(GG1 2
jsonGG2 6
,GG6 7
EncodingGG8 @
.GG@ A
UTF8GGA E
,GGE F
$strGGG Y
)GGY Z
;GGZ [
varHH 
responseHH 
=HH 
awaitHH  
thisHH! %
.HH% &
_httpClientHH& 1
.HH1 2
PutAsyncHH2 :
(HH: ;
newHH; >
UriHH? B
(HHB C
thisHHC G
.HHG H
_serverHHH O
+HHP Q
uriHHR U
.HHU V
ToStringHHV ^
(HH^ _
)HH_ `
)HH` a
,HHa b
contentHHc j
)HHj k
.HHk l
ConfigureAwaitHHl z
(HHz {
false	HH{ Ä
)
HHÄ Å
;
HHÅ Ç
varII 
responseContentII 
=II  !
awaitII" '
responseII( 0
.II0 1
ContentII1 8
.II8 9
ReadAsStringAsyncII9 J
(IIJ K
)IIK L
.IIL M
ConfigureAwaitIIM [
(II[ \
falseII\ a
)IIa b
;IIb c
returnJJ 
responseContentJJ "
;JJ" #
}KK 	
catchLL 
(LL 
	ExceptionLL 
exLL 
)LL 
{MM 	
throwNN 
newNN  
HttpRequestExceptionNN *
(NN* +
$"NN+ -
$strNN- A
{NNA B
exNNB D
.NND E
MessageNNE L
}NNL M
"NNM N
,NNN O
exNNP R
)NNR S
;NNS T
}OO 	
}PP 
publicUU 

asyncUU 
TaskUU 
<UU 
stringUU 
>UU 
DeleteAsyncUU )
(UU) *
UriUU* -
uriUU. 1
)UU1 2
{VV 
tryWW 
{XX 	
varYY 
responseYY 
=YY 
awaitYY  
thisYY! %
.YY% &
_httpClientYY& 1
.YY1 2
DeleteAsyncYY2 =
(YY= >
newYY> A
UriYYB E
(YYE F
thisYYF J
.YYJ K
_serverYYK R
+YYS T
uriYYU X
.YYX Y
ToStringYYY a
(YYa b
)YYb c
)YYc d
)YYd e
.YYe f
ConfigureAwaitYYf t
(YYt u
falseYYu z
)YYz {
;YY{ |
varZZ 
contentZZ 
=ZZ 
awaitZZ 
responseZZ  (
.ZZ( )
ContentZZ) 0
.ZZ0 1
ReadAsStringAsyncZZ1 B
(ZZB C
)ZZC D
.ZZD E
ConfigureAwaitZZE S
(ZZS T
falseZZT Y
)ZZY Z
;ZZZ [
return[[ 
content[[ 
;[[ 
}\\ 	
catch]] 
(]] 
	Exception]] 
ex]] 
)]] 
{^^ 	
throw__ 
new__  
HttpRequestException__ *
(__* +
$"__+ -
$str__- D
{__D E
ex__E G
.__G H
Message__H O
}__O P
"__P Q
,__Q R
ex__S U
)__U V
;__V W
}`` 	
}aa 
publiccc 

voidcc 
Disposecc 
(cc 
)cc 
{dd 
thisee 
.ee 
_httpClientee 
?ee 
.ee 
Disposeee !
(ee! "
)ee" #
;ee# $
GCff 

.ff
 
SuppressFinalizeff 
(ff 
thisff  
)ff  !
;ff! "
}gg 
}hh èp
Q/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Services/JwtService.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Services '
;' (
public 
class 

JwtService 
{ 
private 
readonly 
string 

_secretKey &
;& '
private 
readonly 
int 
_expirationHours )
;) *
public 


JwtService 
( 
IConfiguration $
configuration% 2
)2 3
{ 
this 
. 

_secretKey 
= 
configuration '
[' (
$str( 4
]4 5
??6 8
throw9 >
new? B%
InvalidOperationExceptionC \
(\ ]
$str] |
)| }
;} ~
this 
. 
_expirationHours 
= 
int  #
.# $
Parse$ )
() *
configuration* 7
[7 8
$str8 M
]M N
??O Q
$strR V
,V W
SystemX ^
.^ _
Globalization_ l
.l m
CultureInfom x
.x y
InvariantCulture	y â
)
â ä
;
ä ã
} 
public 

string 
GenerateToken 
(  
string  &
username' /
,/ 0
IReadOnlyList1 >
<> ?
string? E
>E F
rolesG L
,L M
IReadOnlyListN [
<[ \
string\ b
>b c
permissionsd o
,o p
string   
	authLevel   
=   
$str   !
,  ! "
string  # )
idp  * -
=  . /
$str  0 7
)  7 8
{!! 
var"" 
tokenHandler"" 
="" 
new"" #
JwtSecurityTokenHandler"" 6
(""6 7
)""7 8
;""8 9
var## 
key## 
=## 
Encoding## 
.## 
ASCII##  
.##  !
GetBytes##! )
(##) *
this##* .
.##. /

_secretKey##/ 9
)##9 :
;##: ;
var%% 
claims%% 
=%% 
new%% 
List%% 
<%% 
Claim%% #
>%%# $
{&& 	
new'' 
('' 

ClaimTypes'' 
.'' 
Name'' 
,''  
username''! )
)'') *
,''* +
new(( 
((( 
$str(( 
,(( 
username(( $
)(($ %
,((% &
new)) 
()) 
$str)) 
,)) 
	authLevel)) '
)))' (
,))( )
new** 
(** 
$str** #
,**# $
idp**% (
)**( )
,**) *
}++ 	
;++	 

foreach.. 
(.. 
var.. 
role.. 
in.. 
roles.. "
).." #
{// 	
claims00 
.00 
Add00 
(00 
new00 
Claim00  
(00  !

ClaimTypes00! +
.00+ ,
Role00, 0
,000 1
role002 6
)006 7
)007 8
;008 9
}11 	
foreach44 
(44 
var44 

permission44 
in44  "
permissions44# .
)44. /
{55 	
claims66 
.66 
Add66 
(66 
new66 
Claim66  
(66  !
$str66! -
,66- .

permission66/ 9
)669 :
)66: ;
;66; <
}77 	
var99 
tokenDescriptor99 
=99 
new99 !#
SecurityTokenDescriptor99" 9
{:: 	
Subject;; 
=;; 
new;; 
ClaimsIdentity;; (
(;;( )
claims;;) /
);;/ 0
,;;0 1
Expires<< 
=<< 
DateTime<< 
.<< 
UtcNow<< %
.<<% &
AddHours<<& .
(<<. /
this<</ 3
.<<3 4
_expirationHours<<4 D
)<<D E
,<<E F
SigningCredentials== 
===  
new==! $
SigningCredentials==% 7
(==7 8
new==8 ; 
SymmetricSecurityKey==< P
(==P Q
key==Q T
)==T U
,==U V
SecurityAlgorithms==W i
.==i j
HmacSha256Signature==j }
)==} ~
,==~ 
}>> 	
;>>	 

var@@ 
token@@ 
=@@ 
tokenHandler@@  
.@@  !
CreateToken@@! ,
(@@, -
tokenDescriptor@@- <
)@@< =
;@@= >
returnAA 
tokenHandlerAA 
.AA 

WriteTokenAA &
(AA& '
tokenAA' ,
)AA, -
;AA- .
}BB 
publicGG 

boolGG 
ValidateTokenGG 
(GG 
stringGG $
tokenGG% *
)GG* +
{HH 
tryII 
{JJ 	
varKK 
tokenHandlerKK 
=KK 
newKK "#
JwtSecurityTokenHandlerKK# :
(KK: ;
)KK; <
;KK< =
varLL 
keyLL 
=LL 
EncodingLL 
.LL 
ASCIILL $
.LL$ %
GetBytesLL% -
(LL- .
thisLL. 2
.LL2 3

_secretKeyLL3 =
)LL= >
;LL> ?
tokenHandlerNN 
.NN 
ValidateTokenNN &
(NN& '
tokenNN' ,
,NN, -
newNN. 1%
TokenValidationParametersNN2 K
{OO $
ValidateIssuerSigningKeyPP (
=PP) *
truePP+ /
,PP/ 0
IssuerSigningKeyQQ  
=QQ! "
newQQ# & 
SymmetricSecurityKeyQQ' ;
(QQ; <
keyQQ< ?
)QQ? @
,QQ@ A
ValidateIssuerRR 
=RR  
falseRR! &
,RR& '
ValidateAudienceSS  
=SS! "
falseSS# (
,SS( )
	ClockSkewTT 
=TT 
TimeSpanTT $
.TT$ %
ZeroTT% )
,TT) *
}UU 
,UU 
outUU 
SecurityTokenUU  
validatedTokenUU! /
)UU/ 0
;UU0 1
returnWW 
trueWW 
;WW 
}XX 	
catchYY 
{ZZ 	
return[[ 
false[[ 
;[[ 
}\\ 	
}]] 
publicbb 

stringbb 
ExtractUsernamebb !
(bb! "
stringbb" (
tokenbb) .
)bb. /
{cc 
trydd 
{ee 	
varff 
tokenHandlerff 
=ff 
newff "#
JwtSecurityTokenHandlerff# :
(ff: ;
)ff; <
;ff< =
vargg 
	jsonTokengg 
=gg 
tokenHandlergg (
.gg( )
ReadJwtTokengg) 5
(gg5 6
tokengg6 ;
)gg; <
;gg< =
returnhh 
	jsonTokenhh 
.hh 
Claimshh #
.hh# $
FirstOrDefaulthh$ 2
(hh2 3
xhh3 4
=>hh5 7
xhh8 9
.hh9 :
Typehh: >
==hh? A
$strhhB L
)hhL M
?hhM N
.hhN O
ValuehhO T
??hhU W
stringhhX ^
.hh^ _
Emptyhh_ d
;hhd e
}ii 	
catchjj 
{kk 	
returnll 
stringll 
.ll 
Emptyll 
;ll  
}mm 	
}nn 
publicss 

IReadOnlyListss 
<ss 
stringss 
>ss  
ExtractRolesss! -
(ss- .
stringss. 4
tokenss5 :
)ss: ;
{tt 
tryuu 
{vv 	
varww 
tokenHandlerww 
=ww 
newww "#
JwtSecurityTokenHandlerww# :
(ww: ;
)ww; <
;ww< =
varxx 
	jsonTokenxx 
=xx 
tokenHandlerxx (
.xx( )
ReadJwtTokenxx) 5
(xx5 6
tokenxx6 ;
)xx; <
;xx< =
returnyy 
	jsonTokenyy 
.yy 
Claimsyy #
.zz 
Wherezz 
(zz 
xzz 
=>zz 
xzz 
.zz 
Typezz "
==zz# %

ClaimTypeszz& 0
.zz0 1
Rolezz1 5
)zz5 6
.{{ 
Select{{ 
({{ 
x{{ 
=>{{ 
x{{ 
.{{ 
Value{{ $
){{$ %
.|| 
ToList|| 
(|| 
)|| 
;|| 
}}} 	
catch~~ 
{ 	
return
ÄÄ 
new
ÄÄ 
List
ÄÄ 
<
ÄÄ 
string
ÄÄ "
>
ÄÄ" #
(
ÄÄ# $
)
ÄÄ$ %
;
ÄÄ% &
}
ÅÅ 	
}
ÇÇ 
public
áá 

IReadOnlyList
áá 
<
áá 
string
áá 
>
áá   
ExtractPermissions
áá! 3
(
áá3 4
string
áá4 :
token
áá; @
)
áá@ A
{
àà 
try
ââ 
{
ää 	
var
ãã 
tokenHandler
ãã 
=
ãã 
new
ãã "%
JwtSecurityTokenHandler
ãã# :
(
ãã: ;
)
ãã; <
;
ãã< =
var
åå 
	jsonToken
åå 
=
åå 
tokenHandler
åå (
.
åå( )
ReadJwtToken
åå) 5
(
åå5 6
token
åå6 ;
)
åå; <
;
åå< =
return
çç 
	jsonToken
çç 
.
çç 
Claims
çç #
.
éé 
Where
éé 
(
éé 
x
éé 
=>
éé 
x
éé 
.
éé 
Type
éé "
==
éé# %
$str
éé& 2
)
éé2 3
.
èè 
Select
èè 
(
èè 
x
èè 
=>
èè 
x
èè 
.
èè 
Value
èè $
)
èè$ %
.
êê 
ToList
êê 
(
êê 
)
êê 
;
êê 
}
ëë 	
catch
íí 
{
ìì 	
return
îî 
new
îî 
List
îî 
<
îî 
string
îî "
>
îî" #
(
îî# $
)
îî$ %
;
îî% &
}
ïï 	
}
ññ 
public
õõ 

string
õõ 
ExtractAuthLevel
õõ "
(
õõ" #
string
õõ# )
token
õõ* /
)
õõ/ 0
{
úú 
try
ùù 
{
ûû 	
var
üü 
tokenHandler
üü 
=
üü 
new
üü "%
JwtSecurityTokenHandler
üü# :
(
üü: ;
)
üü; <
;
üü< =
var
†† 
	jsonToken
†† 
=
†† 
tokenHandler
†† (
.
††( )
ReadJwtToken
††) 5
(
††5 6
token
††6 ;
)
††; <
;
††< =
return
°° 
	jsonToken
°° 
.
°° 
Claims
°° #
.
°°# $
FirstOrDefault
°°$ 2
(
°°2 3
x
°°3 4
=>
°°5 7
x
°°8 9
.
°°9 :
Type
°°: >
==
°°? A
$str
°°B N
)
°°N O
?
°°O P
.
°°P Q
Value
°°Q V
??
°°W Y
string
°°Z `
.
°°` a
Empty
°°a f
;
°°f g
}
¢¢ 	
catch
££ 
{
§§ 	
return
•• 
string
•• 
.
•• 
Empty
•• 
;
••  
}
¶¶ 	
}
ßß 
public
¨¨ 

string
¨¨ %
ExtractIdentityProvider
¨¨ )
(
¨¨) *
string
¨¨* 0
token
¨¨1 6
)
¨¨6 7
{
≠≠ 
try
ÆÆ 
{
ØØ 	
var
∞∞ 
tokenHandler
∞∞ 
=
∞∞ 
new
∞∞ "%
JwtSecurityTokenHandler
∞∞# :
(
∞∞: ;
)
∞∞; <
;
∞∞< =
var
±± 
	jsonToken
±± 
=
±± 
tokenHandler
±± (
.
±±( )
ReadJwtToken
±±) 5
(
±±5 6
token
±±6 ;
)
±±; <
;
±±< =
return
≤≤ 
	jsonToken
≤≤ 
.
≤≤ 
Claims
≤≤ #
.
≤≤# $
FirstOrDefault
≤≤$ 2
(
≤≤2 3
x
≤≤3 4
=>
≤≤5 7
x
≤≤8 9
.
≤≤9 :
Type
≤≤: >
==
≤≤? A
$str
≤≤B U
)
≤≤U V
?
≤≤V W
.
≤≤W X
Value
≤≤X ]
??
≤≤^ `
string
≤≤a g
.
≤≤g h
Empty
≤≤h m
;
≤≤m n
}
≥≥ 	
catch
¥¥ 
{
µµ 	
return
∂∂ 
string
∂∂ 
.
∂∂ 
Empty
∂∂ 
;
∂∂  
}
∑∑ 	
}
∏∏ 
public
ΩΩ 


Dictionary
ΩΩ 
<
ΩΩ 
string
ΩΩ 
,
ΩΩ 
string
ΩΩ $
>
ΩΩ$ %
ExtractAllClaims
ΩΩ& 6
(
ΩΩ6 7
string
ΩΩ7 =
token
ΩΩ> C
)
ΩΩC D
{
ææ 
try
øø 
{
¿¿ 	
var
¡¡ 
tokenHandler
¡¡ 
=
¡¡ 
new
¡¡ "%
JwtSecurityTokenHandler
¡¡# :
(
¡¡: ;
)
¡¡; <
;
¡¡< =
var
¬¬ 
	jsonToken
¬¬ 
=
¬¬ 
tokenHandler
¬¬ (
.
¬¬( )
ReadJwtToken
¬¬) 5
(
¬¬5 6
token
¬¬6 ;
)
¬¬; <
;
¬¬< =
return
√√ 
	jsonToken
√√ 
.
√√ 
Claims
√√ #
.
√√# $
ToDictionary
√√$ 0
(
√√0 1
x
√√1 2
=>
√√3 5
x
√√6 7
.
√√7 8
Type
√√8 <
,
√√< =
x
√√> ?
=>
√√@ B
x
√√C D
.
√√D E
Value
√√E J
)
√√J K
;
√√K L
}
ƒƒ 	
catch
≈≈ 
{
∆∆ 	
return
«« 
new
«« 

Dictionary
«« !
<
««! "
string
««" (
,
««( )
string
««* 0
>
««0 1
(
««1 2
)
««2 3
;
««3 4
}
»» 	
}
…… 
}   àr
E/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Logging 
. 
ClearProviders 
( 
)  
;  !
builder 
. 
Logging 
. 

AddConsole 
( 
) 
; 
builder 
. 
Logging 
. 
SetMinimumLevel 
(  
LogLevel  (
.( )
Information) 4
)4 5
;5 6
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
c  
=>! #
{ 
c   
.   

SwaggerDoc   
(   
$str   
,   
new   
	Microsoft   $
.  $ %
OpenApi  % ,
.  , -
Models  - 3
.  3 4
OpenApiInfo  4 ?
{!! 
Title"" 
="" 
$str"" 5
,""5 6
Version## 
=## 
$str## 
,## 
Description$$ 
=$$ 
$str$I 
,II 
}JJ 
)JJ 
;JJ 
}KK 
)KK 
;KK 
builderNN 
.NN 
ServicesNN 
.NN 
AddAuthenticationNN "
(NN" #
JwtBearerDefaultsNN# 4
.NN4 5 
AuthenticationSchemeNN5 I
)NNI J
.OO 
AddJwtBearerOO 
(OO 
optionsOO 
=>OO 
{PP 
optionsQQ 
.QQ %
TokenValidationParametersQQ )
=QQ* +
newQQ, /%
TokenValidationParametersQQ0 I
{RR 	$
ValidateIssuerSigningKeySS $
=SS% &
trueSS' +
,SS+ ,
IssuerSigningKeyTT 
=TT 
newTT " 
SymmetricSecurityKeyTT# 7
(TT7 8
EncodingTT8 @
.TT@ A
ASCIITTA F
.TTF G
GetBytesTTG O
(TTO P
builderUU 
.UU 
ConfigurationUU %
[UU% &
$strUU& 2
]UU2 3
??UU4 6
throwUU7 <
newUU= @%
InvalidOperationExceptionUUA Z
(UUZ [
$strUU[ z
)UUz {
)UU{ |
)UU| }
,UU} ~
ValidateIssuerVV 
=VV 
falseVV "
,VV" #
ValidateAudienceWW 
=WW 
falseWW $
,WW$ %
	ClockSkewXX 
=XX 
TimeSpanXX  
.XX  !
ZeroXX! %
,XX% &
}YY 	
;YY	 

}ZZ 
)ZZ 
;ZZ 
builder]] 
.]] 
Services]] 
.]] 
AddAuthorization]] !
(]]! "
options]]" )
=>]]* ,
{^^ 
options`` 
.`` 
	AddPolicy`` 
(`` 
$str`` '
,``' (
policy``) /
=>``0 2
policyaa 
.aa 
Requirementsaa 
.aa 
Addaa 
(aa  
newaa  #!
PermissionRequirementaa$ 9
(aa9 :
$straa: F
)aaF G
)aaG H
)aaH I
;aaI J
optionsdd 
.dd 
	AddPolicydd 
(dd 
$strdd (
,dd( )
policydd* 0
=>dd1 3
policyee 
.ee 
Requirementsee 
.ee 
Addee 
(ee  
newee  #!
PermissionRequirementee$ 9
(ee9 :
$stree: G
)eeG H
)eeH I
)eeI J
;eeJ K
optionshh 
.hh 
	AddPolicyhh 
(hh 
$strhh )
,hh) *
policyhh+ 1
=>hh2 4
policyii 
.ii 
Requirementsii 
.ii 
Addii 
(ii  
newii  #!
PermissionRequirementii$ 9
(ii9 :
$strii: H
)iiH I
)iiI J
)iiJ K
;iiK L
optionsll 
.ll 
	AddPolicyll 
(ll 
$strll .
,ll. /
policyll0 6
=>ll7 9
policymm 
.mm 
Requirementsmm 
.mm 
Addmm 
(mm  
newmm  #'
IdentityProviderRequirementmm$ ?
(mm? @
$strmm@ L
)mmL M
)mmM N
)mmN O
;mmO P
optionspp 
.pp 
	AddPolicypp 
(pp 
$strpp '
,pp' (
policypp) /
=>pp0 2
policyqq 
.qq 
Requirementsqq 
.qq 
Addqq 
(qq  
newqq  # 
AuthLevelRequirementqq$ 8
(qq8 9
$strqq9 ?
)qq? @
)qq@ A
)qqA B
;qqB C
optionstt 
.tt 
	AddPolicytt 
(tt 
$strtt 9
,tt9 :
policytt; A
=>ttB D
policyuu 
.uu 
RequireAssertionuu 
(uu  
contextuu  '
=>uu( *
contextvv 
.vv 
Uservv 
.vv 
HasClaimvv !
(vv! "
$strvv" .
,vv. /
$strvv0 <
)vv< =
||vv> @
contextww 
.ww 
Userww 
.ww 
IsInRoleww !
(ww! "
$strww" )
)ww) *
)ww* +
)ww+ ,
;ww, -
optionsyy 
.yy 
	AddPolicyyy 
(yy 
$stryy :
,yy: ;
policyyy< B
=>yyC E
policyzz 
.zz 
RequireAssertionzz 
(zz  
contextzz  '
=>zz( *
context{{ 
.{{ 
User{{ 
.{{ 
HasClaim{{ !
({{! "
$str{{" .
,{{. /
$str{{0 =
){{= >
||{{? A
context|| 
.|| 
User|| 
.|| 
IsInRole|| !
(||! "
$str||" )
)||) *
)||* +
)||+ ,
;||, -
options~~ 
.~~ 
	AddPolicy~~ 
(~~ 
$str~~ ;
,~~; <
policy~~= C
=>~~D F
policy 
. 
RequireAssertion 
(  
context  '
=>( *
context
ÄÄ 
.
ÄÄ 
User
ÄÄ 
.
ÄÄ 
HasClaim
ÄÄ !
(
ÄÄ! "
$str
ÄÄ" .
,
ÄÄ. /
$str
ÄÄ0 >
)
ÄÄ> ?
||
ÄÄ@ B
context
ÅÅ 
.
ÅÅ 
User
ÅÅ 
.
ÅÅ 
IsInRole
ÅÅ !
(
ÅÅ! "
$str
ÅÅ" )
)
ÅÅ) *
)
ÅÅ* +
)
ÅÅ+ ,
;
ÅÅ, -
}ÇÇ 
)
ÇÇ 
;
ÇÇ 
builderÖÖ 
.
ÖÖ 
Services
ÖÖ 
.
ÖÖ 
	AddScoped
ÖÖ 
<
ÖÖ #
IAuthorizationHandler
ÖÖ 0
,
ÖÖ0 1
PermissionHandler
ÖÖ2 C
>
ÖÖC D
(
ÖÖD E
)
ÖÖE F
;
ÖÖF G
builderÜÜ 
.
ÜÜ 
Services
ÜÜ 
.
ÜÜ 
	AddScoped
ÜÜ 
<
ÜÜ #
IAuthorizationHandler
ÜÜ 0
,
ÜÜ0 1"
AnyPermissionHandler
ÜÜ2 F
>
ÜÜF G
(
ÜÜG H
)
ÜÜH I
;
ÜÜI J
builderáá 
.
áá 
Services
áá 
.
áá 
	AddScoped
áá 
<
áá #
IAuthorizationHandler
áá 0
,
áá0 1#
AllPermissionsHandler
áá2 G
>
ááG H
(
ááH I
)
ááI J
;
ááJ K
builderàà 
.
àà 
Services
àà 
.
àà 
	AddScoped
àà 
<
àà #
IAuthorizationHandler
àà 0
,
àà0 1
RoleHandler
àà2 =
>
àà= >
(
àà> ?
)
àà? @
;
àà@ A
builderââ 
.
ââ 
Services
ââ 
.
ââ 
	AddScoped
ââ 
<
ââ #
IAuthorizationHandler
ââ 0
,
ââ0 1%
IdentityProviderHandler
ââ2 I
>
ââI J
(
ââJ K
)
ââK L
;
ââL M
builderää 
.
ää 
Services
ää 
.
ää 
	AddScoped
ää 
<
ää #
IAuthorizationHandler
ää 0
,
ää0 1
AuthLevelHandler
ää2 B
>
ääB C
(
ääC D
)
ääD E
;
ääE F
builderçç 
.
çç 
Services
çç 
.
çç 
	AddScoped
çç 
<
çç 

JwtService
çç %
>
çç% &
(
çç& '
)
çç' (
;
çç( )
builderéé 
.
éé 
Services
éé 
.
éé 
	AddScoped
éé 
<
éé 
LocalRestClient
éé *
>
éé* +
(
éé+ ,
)
éé, -
;
éé- .
builderëë 
.
ëë 
Services
ëë 
.
ëë 
AddHealthChecks
ëë  
(
ëë  !
)
ëë! "
.
íí 
AddCheck
íí 
(
íí 
$str
íí 
,
íí 
(
íí 
)
íí 
=>
íí 
HealthCheckResult
íí -
.
íí- .
Healthy
íí. 5
(
íí5 6
)
íí6 7
,
íí7 8
new
íí9 <
[
íí< =
]
íí= >
{
íí? @
$str
ííA H
}
ííI J
)
ííJ K
;
ííK L
builderïï 
.
ïï 
Services
ïï 
.
ïï 
AddOpenTelemetry
ïï !
(
ïï! "
)
ïï" #
.
ññ 
ConfigureResource
ññ 
(
ññ 
resource
ññ 
=>
ññ  "
resource
ññ# +
.
óó 	

AddService
óó	 
(
óó 
$str
óó *
,
óó* +
serviceVersion
óó, :
:
óó: ;
$str
óó< C
)
óóC D
.
òò 	
AddAttributes
òò	 
(
òò 
new
òò 

Dictionary
òò %
<
òò% &
string
òò& ,
,
òò, -
object
òò. 4
>
òò4 5
{
ôô 	
[
öö 
$str
öö %
]
öö% &
=
öö' (
builder
öö) 0
.
öö0 1
Environment
öö1 <
.
öö< =
EnvironmentName
öö= L
,
ööL M
}
õõ 	
)
õõ	 

)
õõ
 
.
úú 
WithTracing
úú 
(
úú 
tracing
úú 
=>
úú 
tracing
úú #
.
ùù 	*
AddAspNetCoreInstrumentation
ùù	 %
(
ùù% &
)
ùù& '
.
ûû 	*
AddHttpClientInstrumentation
ûû	 %
(
ûû% &
)
ûû& '
.
üü 	
AddOtlpExporter
üü	 
(
üü 
)
üü 
)
üü 
.
†† 
WithMetrics
†† 
(
†† 
metrics
†† 
=>
†† 
metrics
†† #
.
°° 	*
AddAspNetCoreInstrumentation
°°	 %
(
°°% &
)
°°& '
.
¢¢ 	*
AddHttpClientInstrumentation
¢¢	 %
(
¢¢% &
)
¢¢& '
.
££ 	'
AddRuntimeInstrumentation
££	 "
(
££" #
)
££# $
.
§§ 	
AddOtlpExporter
§§	 
(
§§ 
)
§§ 
)
§§ 
;
§§ 
builderßß 
.
ßß 
Services
ßß 
.
ßß 
AddSingleton
ßß 
<
ßß 
MetricServer
ßß *
>
ßß* +
(
ßß+ ,
)
ßß, -
;
ßß- .
var©© 
app
©© 
=
©© 	
builder
©©
 
.
©© 
Build
©© 
(
©© 
)
©© 
;
©© 
if¨¨ 
(
¨¨ 
app
¨¨ 
.
¨¨ 
Environment
¨¨ 
.
¨¨ 
IsDevelopment
¨¨ !
(
¨¨! "
)
¨¨" #
)
¨¨# $
{≠≠ 
app
ÆÆ 
.
ÆÆ 

UseSwagger
ÆÆ 
(
ÆÆ 
)
ÆÆ 
;
ÆÆ 
app
ØØ 
.
ØØ 
UseSwaggerUI
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
}∞∞ 
app≥≥ 
.
≥≥ 
UseHttpMetrics
≥≥ 
(
≥≥ 
)
≥≥ 
;
≥≥ 
app∂∂ 
.
∂∂ 
UseAuthentication
∂∂ 
(
∂∂ 
)
∂∂ 
;
∂∂ 
app∑∑ 
.
∑∑ 
UseAuthorization
∑∑ 
(
∑∑ 
)
∑∑ 
;
∑∑ 
app∫∫ 
.
∫∫ 
MapControllers
∫∫ 
(
∫∫ 
)
∫∫ 
;
∫∫ 
appΩΩ 
.
ΩΩ 
MapHealthChecks
ΩΩ 
(
ΩΩ 
$str
ΩΩ #
,
ΩΩ# $
new
ΩΩ% ( 
HealthCheckOptions
ΩΩ) ;
{ææ 
	Predicate
øø 
=
øø 
check
øø 
=>
øø 
check
øø 
.
øø 
Tags
øø #
.
øø# $
Contains
øø$ ,
(
øø, -
$str
øø- 4
)
øø4 5
,
øø5 6
}¿¿ 
)
¿¿ 
;
¿¿ 
app¬¬ 
.
¬¬ 
MapHealthChecks
¬¬ 
(
¬¬ 
$str
¬¬ "
,
¬¬" #
new
¬¬$ ' 
HealthCheckOptions
¬¬( :
{√√ 
	Predicate
ƒƒ 
=
ƒƒ 
_
ƒƒ 
=>
ƒƒ 
false
ƒƒ 
,
ƒƒ 
}≈≈ 
)
≈≈ 
;
≈≈ 
app»» 
.
»» 

MapMetrics
»» 
(
»» 
)
»» 
;
»» 
varÀÀ 
metricServer
ÀÀ 
=
ÀÀ 
app
ÀÀ 
.
ÀÀ 
Services
ÀÀ 
.
ÀÀ   
GetRequiredService
ÀÀ  2
<
ÀÀ2 3
MetricServer
ÀÀ3 ?
>
ÀÀ? @
(
ÀÀ@ A
)
ÀÀA B
;
ÀÀB C
metricServerÃÃ 
.
ÃÃ 
Start
ÃÃ 
(
ÃÃ 
)
ÃÃ 
;
ÃÃ 
appŒŒ 
.
ŒŒ 
Run
ŒŒ 
(
ŒŒ 
)
ŒŒ 	
;
ŒŒ	 
‡'
[/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/MetricsController.cs
	namespace		 	 
SpringJavaEquivalent		
 
.		 
Controllers		 *
;		* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
MetricsController 
:  
ControllerBase! /
{ 
private 
static 
readonly 
Meter !
Meter" '
=( )
new* -
(- .
$str. L
,L M
$strN U
)U V
;V W
private 
static 
readonly 
Counter #
<# $
long$ (
>( )
RequestCounter* 8
=9 :
Meter; @
.@ A
CreateCounterA N
<N O
longO S
>S T
(T U
$strU l
,l m
$str	n è
)
è ê
;
ê ë
private 
static 
readonly 
	Histogram %
<% &
double& ,
>, -
ResponseTime. :
=; <
Meter= B
.B C
CreateHistogramC R
<R S
doubleS Y
>Y Z
(Z [
$str[ q
,q r
$str	s â
)
â ä
;
ä ã
private 
static 
readonly 
Random "
Random# )
=* +
new, /
(/ 0
)0 1
;1 2
[ 
HttpGet 
( 
$str 
) 
] 
public 

async 
Task 
< 
string 
> 
TestMetrics )
() *
)* +
{ 
RequestCounter 
. 
Add 
( 
$num 
) 
; 
using 
var 
activity 
= 
new  
Activity! )
() *
$str* <
)< =
;= >
activity 
. 
Start 
( 
) 
; 
try 
{ 	
await 
Task 
. 
Delay 
( 
Random #
.# $
Next$ (
(( )
$num) +
,+ ,
$num- 0
)0 1
)1 2
;2 3
return   
$str   +
;  + ,
}!! 	
finally"" 
{## 	
activity$$ 
.$$ 
Stop$$ 
($$ 
)$$ 
;$$ 
ResponseTime%% 
.%% 
Record%% 
(%%  
activity%%  (
.%%( )
Duration%%) 1
.%%1 2
TotalMilliseconds%%2 C
)%%C D
;%%D E
}&& 	
}'' 
[)) 
HttpGet)) 
()) 
$str)) 
))) 
])) 
public** 

string** 
IncrementCounter** "
(**" #
[**# $
	FromQuery**$ -
]**- .
int**/ 2
value**3 8
=**9 :
$num**; <
)**< =
{++ 
RequestCounter,, 
.,, 
Add,, 
(,, 
value,,  
),,  !
;,,! "
return-- 
$"-- 
$str-- (
{--( )
value--) .
}--. /
"--/ 0
;--0 1
}.. 
[00 
HttpGet00 
(00 
$str00 
)00 
]00 
public11 

async11 
Task11 
<11 
string11 
>11 
SlowEndpoint11 *
(11* +
)11+ ,
{22 
RequestCounter33 
.33 
Add33 
(33 
$num33 
)33 
;33 
using55 
var55 
activity55 
=55 
new55  
Activity55! )
(55) *
$str55* :
)55: ;
;55; <
activity66 
.66 
Start66 
(66 
)66 
;66 
try88 
{99 	
await;; 
Task;; 
.;; 
Delay;; 
(;; 
Random;; #
.;;# $
Next;;$ (
(;;( )
$num;;) ,
,;;, -
$num;;. 2
);;2 3
);;3 4
;;;4 5
return<< 
$str<< -
;<<- .
}== 	
finally>> 
{?? 	
activity@@ 
.@@ 
Stop@@ 
(@@ 
)@@ 
;@@ 
ResponseTimeAA 
.AA 
RecordAA 
(AA  
activityAA  (
.AA( )
DurationAA) 1
.AA1 2
TotalMillisecondsAA2 C
)AAC D
;AAD E
}BB 	
}CC 
}DD ’Ü
Y/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/TokenController.cs
	namespace		 	 
SpringJavaEquivalent		
 
.		 
Controllers		 *
;		* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
[ 
Tags 
( 
$str 
) 
] 
public 
class 
TokenController 
: 
ControllerBase -
{ 
private 
readonly 

JwtService 
_jwtService  +
;+ ,
private 
const 
string 
CacheReadPermission ,
=- .
$str/ ;
;; <
private 
const 
string  
CacheWritePermission -
=. /
$str0 =
;= >
private 
const 
string 
DefaultRole $
=% &
$str' -
;- .
public 

TokenController 
( 

JwtService %

jwtService& 0
)0 1
{ 
this 
. 
_jwtService 
= 

jwtService %
;% &
} 
[!! 
HttpPost!! 
(!! 
$str!! 
)!! 
]!! 
[""  
ProducesResponseType"" 
("" 
typeof""  
(""  !
object""! '
)""' (
,""( )
$num""* -
)""- .
]"". /
[##  
ProducesResponseType## 
(## 
$num## 
)## 
]## 
public$$ 

IActionResult$$ 
GenerateToken$$ &
($$& '
[%% 	
	FromQuery%%	 
,%% 
Required%% 
]%% 
string%% $
username%%% -
,%%- .
[&& 	
	FromQuery&&	 
]&& 
string&& 
?&& 
roles&& !
=&&" #
null&&$ (
,&&( )
['' 	
	FromQuery''	 
]'' 
string'' 
?'' 
permissions'' '
=''( )
null''* .
)''. /
{(( 
var** 
	rolesList** 
=** 
string** 
.** 
IsNullOrEmpty** ,
(**, -
roles**- 2
)**2 3
?++ 
new++ 
List++ 
<++ 
string++ 
>++ 
{++  
DefaultRole++! ,
}++- .
:,, 
roles,, 
.,, 
Split,, 
(,, 
$char,, 
),, 
.,, 
Select,, %
(,,% &
r,,& '
=>,,( *
r,,+ ,
.,,, -
Trim,,- 1
(,,1 2
),,2 3
),,3 4
.,,4 5
ToList,,5 ;
(,,; <
),,< =
;,,= >
var.. 
permissionsList.. 
=.. 
string.. $
...$ %
IsNullOrEmpty..% 2
(..2 3
permissions..3 >
)..> ?
?// 
new// 
List// 
<// 
string// 
>// 
{//  
CacheReadPermission//! 4
}//5 6
:00 
permissions00 
.00 
Split00 
(00  
$char00  #
)00# $
.00$ %
Select00% +
(00+ ,
p00, -
=>00. 0
p001 2
.002 3
Trim003 7
(007 8
)008 9
)009 :
.00: ;
ToList00; A
(00A B
)00B C
;00C D
var22 
token22 
=22 
this22 
.22 
_jwtService22 $
.22$ %
GenerateToken22% 2
(222 3
username223 ;
,22; <
	rolesList22= F
,22F G
permissionsList22H W
)22W X
;22X Y
var44 
response44 
=44 
new44 
{55 	
token66 
,66 
username77 
,77 
roles88 
=88 
	rolesList88 
,88 
permissions99 
=99 
permissionsList99 )
,99) *
	expiresAt:: 
=:: 
DateTime::  
.::  !
UtcNow::! '
.::' (
AddHours::( 0
(::0 1
$num::1 2
)::2 3
,::3 4
};; 	
;;;	 

return== 
Ok== 
(== 
response== 
)== 
;== 
}>> 
[CC 
HttpGetCC 
(CC 
$strCC  
)CC  !
]CC! "
[DD  
ProducesResponseTypeDD 
(DD 
typeofDD  
(DD  !
objectDD! '
)DD' (
,DD( )
$numDD* -
)DD- .
]DD. /
[EE  
ProducesResponseTypeEE 
(EE 
$numEE 
)EE 
]EE 
publicFF 

IActionResultFF #
GeneratePredefinedTokenFF 0
(FF0 1
[FF1 2
	FromRouteFF2 ;
]FF; <
stringFF= C
typeFFD H
)FFH I
{GG 
varHH 
	lowerTypeHH 
=HH 
typeHH 
.HH 
ToLowerInvariantHH -
(HH- .
)HH. /
;HH/ 0
returnII 
	lowerTypeII 
switchII 
{JJ 	
$strKK 
=>KK 
thisKK 
.KK 
GenerateAdminTokenKK .
(KK. /
)KK/ 0
,KK0 1
$strLL 
=>LL 
thisLL 
.LL 
GenerateUserTokenLL ,
(LL, -
)LL- .
,LL. /
$strMM 
=>MM 
thisMM 
.MM !
GenerateReadOnlyTokenMM 4
(MM4 5
)MM5 6
,MM6 7
$strNN 
=>NN 
thisNN 
.NN 
GenerateWriteTokenNN .
(NN. /
)NN/ 0
,NN0 1
_OO 
=>OO 

BadRequestOO 
(OO 
$"OO 
$strOO 2
{OO2 3
typeOO3 7
}OO7 8
"OO8 9
)OO9 :
,OO: ;
}PP 	
;PP	 

}QQ 
[VV 
HttpGetVV 
(VV 
$strVV 
)VV 
]VV 
[WW  
ProducesResponseTypeWW 
(WW 
typeofWW  
(WW  !
objectWW! '
)WW' (
,WW( )
$numWW* -
)WW- .
]WW. /
publicXX 

IActionResultXX 
GenerateAdminTokenXX +
(XX+ ,
)XX, -
{YY 
varZZ 
tokenZZ 
=ZZ 
thisZZ 
.ZZ 
_jwtServiceZZ $
.ZZ$ %
GenerateTokenZZ% 2
(ZZ2 3
$str[[ 
,[[ 
new\\ 
List\\ 
<\\ 
string\\ 
>\\ 
{\\ 
$str\\ &
,\\& '
$str\\( .
}\\/ 0
,\\0 1
new]] 
List]] 
<]] 
string]] 
>]] 
{]] 
CacheReadPermission]] 2
,]]2 3 
CacheWritePermission]]4 H
,]]H I
$str]]J X
}]]Y Z
)]]Z [
;]][ \
return__ 
Ok__ 
(__ 
new__ 
{`` 	
tokenaa 
,aa 
usernamebb 
=bb 
$strbb 
,bb 
rolescc 
=cc 
newcc 
[cc 
]cc 
{cc 
$strcc #
,cc# $
$strcc% +
}cc, -
,cc- .
permissionsdd 
=dd 
newdd 
[dd 
]dd 
{dd  !
CacheReadPermissiondd" 5
,dd5 6 
CacheWritePermissiondd7 K
,ddK L
$strddM [
}dd\ ]
,dd] ^
	expiresAtee 
=ee 
DateTimeee  
.ee  !
UtcNowee! '
.ee' (
AddHoursee( 0
(ee0 1
$numee1 2
)ee2 3
,ee3 4
}ff 	
)ff	 

;ff
 
}gg 
[ll 
HttpGetll 
(ll 
$strll 
)ll 
]ll 
[mm  
ProducesResponseTypemm 
(mm 
typeofmm  
(mm  !
objectmm! '
)mm' (
,mm( )
$nummm* -
)mm- .
]mm. /
publicnn 

IActionResultnn 
GenerateUserTokennn *
(nn* +
)nn+ ,
{oo 
varpp 
tokenpp 
=pp 
thispp 
.pp 
_jwtServicepp $
.pp$ %
GenerateTokenpp% 2
(pp2 3
$strqq 
,qq 
newrr 
Listrr 
<rr 
stringrr 
>rr 
{rr 
DefaultRolerr *
}rr+ ,
,rr, -
newss 
Listss 
<ss 
stringss 
>ss 
{ss 
CacheReadPermissionss 2
}ss3 4
)ss4 5
;ss5 6
returnuu 
Okuu 
(uu 
newuu 
{vv 	
tokenww 
,ww 
usernamexx 
=xx 
$strxx 
,xx 
rolesyy 
=yy 
newyy 
[yy 
]yy 
{yy 
DefaultRoleyy '
}yy( )
,yy) *
permissionszz 
=zz 
newzz 
[zz 
]zz 
{zz  !
CacheReadPermissionzz" 5
}zz6 7
,zz7 8
	expiresAt{{ 
={{ 
DateTime{{  
.{{  !
UtcNow{{! '
.{{' (
AddHours{{( 0
({{0 1
$num{{1 2
){{2 3
,{{3 4
}|| 	
)||	 

;||
 
}}} 
[
ÇÇ 
HttpGet
ÇÇ 
(
ÇÇ 
$str
ÇÇ 
)
ÇÇ 
]
ÇÇ 
[
ÉÉ "
ProducesResponseType
ÉÉ 
(
ÉÉ 
typeof
ÉÉ  
(
ÉÉ  !
object
ÉÉ! '
)
ÉÉ' (
,
ÉÉ( )
$num
ÉÉ* -
)
ÉÉ- .
]
ÉÉ. /
public
ÑÑ 

IActionResult
ÑÑ #
GenerateReadOnlyToken
ÑÑ .
(
ÑÑ. /
)
ÑÑ/ 0
{
ÖÖ 
var
ÜÜ 
token
ÜÜ 
=
ÜÜ 
this
ÜÜ 
.
ÜÜ 
_jwtService
ÜÜ $
.
ÜÜ$ %
GenerateToken
ÜÜ% 2
(
ÜÜ2 3
$str
áá 
,
áá 
new
àà 
List
àà 
<
àà 
string
àà 
>
àà 
{
àà 
$str
àà )
}
àà* +
,
àà+ ,
new
ââ 
List
ââ 
<
ââ 
string
ââ 
>
ââ 
{
ââ !
CacheReadPermission
ââ 2
}
ââ3 4
)
ââ4 5
;
ââ5 6
return
ãã 
Ok
ãã 
(
ãã 
new
ãã 
{
åå 	
token
çç 
,
çç 
username
éé 
=
éé 
$str
éé !
,
éé! "
roles
èè 
=
èè 
new
èè 
[
èè 
]
èè 
{
èè 
$str
èè &
}
èè' (
,
èè( )
permissions
êê 
=
êê 
new
êê 
[
êê 
]
êê 
{
êê  !!
CacheReadPermission
êê" 5
}
êê6 7
,
êê7 8
	expiresAt
ëë 
=
ëë 
DateTime
ëë  
.
ëë  !
UtcNow
ëë! '
.
ëë' (
AddHours
ëë( 0
(
ëë0 1
$num
ëë1 2
)
ëë2 3
,
ëë3 4
}
íí 	
)
íí	 

;
íí
 
}
ìì 
[
òò 
HttpGet
òò 
(
òò 
$str
òò 
)
òò 
]
òò 
[
ôô "
ProducesResponseType
ôô 
(
ôô 
typeof
ôô  
(
ôô  !
object
ôô! '
)
ôô' (
,
ôô( )
$num
ôô* -
)
ôô- .
]
ôô. /
public
öö 

IActionResult
öö  
GenerateWriteToken
öö +
(
öö+ ,
)
öö, -
{
õõ 
var
úú 
token
úú 
=
úú 
this
úú 
.
úú 
_jwtService
úú $
.
úú$ %
GenerateToken
úú% 2
(
úú2 3
$str
ùù 
,
ùù 
new
ûû 
List
ûû 
<
ûû 
string
ûû 
>
ûû 
{
ûû 
$str
ûû '
}
ûû( )
,
ûû) *
new
üü 
List
üü 
<
üü 
string
üü 
>
üü 
{
üü !
CacheReadPermission
üü 2
,
üü2 3"
CacheWritePermission
üü4 H
}
üüI J
)
üüJ K
;
üüK L
return
°° 
Ok
°° 
(
°° 
new
°° 
{
¢¢ 	
token
££ 
,
££ 
username
§§ 
=
§§ 
$str
§§ 
,
§§  
roles
•• 
=
•• 
new
•• 
[
•• 
]
•• 
{
•• 
$str
•• $
}
••% &
,
••& '
permissions
¶¶ 
=
¶¶ 
new
¶¶ 
[
¶¶ 
]
¶¶ 
{
¶¶  !!
CacheReadPermission
¶¶" 5
,
¶¶5 6"
CacheWritePermission
¶¶7 K
}
¶¶L M
,
¶¶M N
	expiresAt
ßß 
=
ßß 
DateTime
ßß  
.
ßß  !
UtcNow
ßß! '
.
ßß' (
AddHours
ßß( 0
(
ßß0 1
$num
ßß1 2
)
ßß2 3
,
ßß3 4
}
®® 	
)
®®	 

;
®®
 
}
©© 
[
ÆÆ 
HttpPost
ÆÆ 
(
ÆÆ 
$str
ÆÆ 
)
ÆÆ 
]
ÆÆ 
[
ØØ "
ProducesResponseType
ØØ 
(
ØØ 
typeof
ØØ  
(
ØØ  !
object
ØØ! '
)
ØØ' (
,
ØØ( )
$num
ØØ* -
)
ØØ- .
]
ØØ. /
[
∞∞ "
ProducesResponseType
∞∞ 
(
∞∞ 
$num
∞∞ 
)
∞∞ 
]
∞∞ 
public
±± 

IActionResult
±± 
ValidateToken
±± &
(
±±& '
[
±±' (
FromBody
±±( 0
]
±±0 1

Dictionary
±±2 <
<
±±< =
string
±±= C
,
±±C D
string
±±E K
>
±±K L
request
±±M T
)
±±T U
{
≤≤ 
if
≥≥ 

(
≥≥ 
!
≥≥ 
request
≥≥ 
.
≥≥ 
TryGetValue
≥≥  
(
≥≥  !
$str
≥≥! (
,
≥≥( )
out
≥≥* -
var
≥≥. 1
token
≥≥2 7
)
≥≥7 8
)
≥≥8 9
{
¥¥ 	
return
µµ 

BadRequest
µµ 
(
µµ 
$str
µµ 1
)
µµ1 2
;
µµ2 3
}
∂∂ 	
try
∏∏ 
{
ππ 	
var
∫∫ 
isValid
∫∫ 
=
∫∫ 
this
∫∫ 
.
∫∫ 
_jwtService
∫∫ *
.
∫∫* +
ValidateToken
∫∫+ 8
(
∫∫8 9
token
∫∫9 >
)
∫∫> ?
;
∫∫? @
var
ªª 
username
ªª 
=
ªª 
this
ªª 
.
ªª  
_jwtService
ªª  +
.
ªª+ ,
ExtractUsername
ªª, ;
(
ªª; <
token
ªª< A
)
ªªA B
;
ªªB C
var
ºº 
roles
ºº 
=
ºº 
this
ºº 
.
ºº 
_jwtService
ºº (
.
ºº( )
ExtractRoles
ºº) 5
(
ºº5 6
token
ºº6 ;
)
ºº; <
;
ºº< =
var
ΩΩ 
permissions
ΩΩ 
=
ΩΩ 
this
ΩΩ "
.
ΩΩ" #
_jwtService
ΩΩ# .
.
ΩΩ. / 
ExtractPermissions
ΩΩ/ A
(
ΩΩA B
token
ΩΩB G
)
ΩΩG H
;
ΩΩH I
return
øø 
Ok
øø 
(
øø 
new
øø 
{
¿¿ 
valid
¡¡ 
=
¡¡ 
isValid
¡¡ 
,
¡¡  
username
¬¬ 
,
¬¬ 
roles
√√ 
,
√√ 
permissions
ƒƒ 
,
ƒƒ 
validatedAt
≈≈ 
=
≈≈ 
DateTime
≈≈ &
.
≈≈& '
UtcNow
≈≈' -
,
≈≈- .
}
∆∆ 
)
∆∆ 
;
∆∆ 
}
«« 	
catch
»» 
(
»» 
	Exception
»» 
ex
»» 
)
»» 
{
…… 	
return
   
Ok
   
(
   
new
   
{
ÀÀ 
valid
ÃÃ 
=
ÃÃ 
false
ÃÃ 
,
ÃÃ 
error
ÕÕ 
=
ÕÕ 
ex
ÕÕ 
.
ÕÕ 
Message
ÕÕ "
,
ÕÕ" #
validatedAt
ŒŒ 
=
ŒŒ 
DateTime
ŒŒ &
.
ŒŒ& '
UtcNow
ŒŒ' -
,
ŒŒ- .
}
œœ 
)
œœ 
;
œœ 
}
–– 	
}
—— 
}““ ä]
a/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/VulnerableJWTController.cs
	namespace		 	 
SpringJavaEquivalent		
 
.		 
Controllers		 *
;		* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class #
VulnerableJwtController $
:% &
ControllerBase' 5
{ 
private 
const 
string 

WeakSecret #
=$ %
$str& Q
;Q R
private 
const 
string 
TokenKey !
=" #
$str$ +
;+ ,
private 
const 
string 
AlgorithmKey %
=& '
$str( 3
;3 4
private 
const 
string 
ValidKey !
=" #
$str$ +
;+ ,
private 
const 
string 

DecodedKey #
=$ %
$str& /
;/ 0
private 
const 
string 
	HeaderKey "
=# $
$str% -
;- .
private 
const 
string 

PayloadKey #
=$ %
$str& /
;/ 0
private 
const 
string 
SignatureKey %
=& '
$str( 3
;3 4
private 
const 
string 
ErrorKey !
=" #
$str$ +
;+ ,
private 
const 
string 

MessageKey #
=$ %
$str& /
;/ 0
public 
#
VulnerableJwtController "
(" #
)# $
{ 
} 
[$$ 
HttpPost$$ 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 

IActionResult%% 
CreateToken%% $
(%%$ %
[%%% &
FromBody%%& .
]%%. /

Dictionary%%0 :
<%%: ;
string%%; A
,%%A B
object%%C I
>%%I J
payload%%K R
)%%R S
{&& 
try'' 
{(( 	
var** 
header** 
=** 
Convert**  
.**  !
ToBase64String**! /
(**/ 0
Encoding**0 8
.**8 9
UTF8**9 =
.**= >
GetBytes**> F
(**F G
$str**G l
)**l m
)**m n
;**n o
var++ 

payloadStr++ 
=++ 
Convert++ $
.++$ %
ToBase64String++% 3
(++3 4
Encoding++4 <
.++< =
UTF8++= A
.++A B
GetBytes++B J
(++J K
JsonSerializer++K Y
.++Y Z
	Serialize++Z c
(++c d
payload++d k
)++k l
)++l m
)++m n
;++n o
var,, 
	signature,, 
=,, 
Convert,, #
.,,# $
ToBase64String,,$ 2
(,,2 3
Encoding,,3 ;
.,,; <
UTF8,,< @
.,,@ A
GetBytes,,A I
(,,I J

WeakSecret,,J T
),,T U
),,U V
;,,V W
var.. 
token.. 
=.. 
$".. 
{.. 
header.. !
}..! "
$str.." #
{..# $

payloadStr..$ .
}... /
$str../ 0
{..0 1
	signature..1 :
}..: ;
"..; <
;..< =
return// 
Ok// 
(// 
token// 
)// 
;// 
}00 	
catch11 
(11 
	Exception11 
e11 
)11 
{22 	
return33 

BadRequest33 
(33 
$"33  
$str33  6
{336 7
e337 8
.338 9
Message339 @
}33@ A
"33A B
)33B C
;33C D
}44 	
}55 
[:: 
HttpPost:: 
(:: 
$str:: 
):: 
]:: 
public;; 

IActionResult;; 
VerifyToken;; $
(;;$ %
[;;% &
FromBody;;& .
];;. /

Dictionary;;0 :
<;;: ;
string;;; A
,;;A B
string;;C I
>;;I J
request;;K R
);;R S
{<< 
try== 
{>> 	
var?? 
token?? 
=?? 
request?? 
.??  
GetValueOrDefault??  1
(??1 2
TokenKey??2 :
,??: ;
string??< B
.??B C
Empty??C H
)??H I
;??I J
varBB 
responseBB 
=BB 
newBB 

DictionaryBB )
<BB) *
stringBB* 0
,BB0 1
objectBB2 8
>BB8 9
{CC 
[DD 
ValidKeyDD 
]DD 
=DD 
trueDD !
,DD! "
[EE 
TokenKeyEE 
]EE 
=EE 
tokenEE "
,EE" #
[FF 

MessageKeyFF 
]FF 
=FF 
$strFF I
,FFI J
}GG 
;GG 
returnII 
OkII 
(II 
responseII 
)II 
;II  
}JJ 	
catchKK 
(KK 
	ExceptionKK 
eKK 
)KK 
{LL 	
varMM 
responseMM 
=MM 
newMM 

DictionaryMM )
<MM) *
stringMM* 0
,MM0 1
objectMM2 8
>MM8 9
{NN 
[OO 
ValidKeyOO 
]OO 
=OO 
falseOO "
,OO" #
[PP 
ErrorKeyPP 
]PP 
=PP 
ePP 
.PP 
MessagePP &
,PP& '
}QQ 
;QQ 
returnSS 
OkSS 
(SS 
responseSS 
)SS 
;SS  
}TT 	
}UU 
[ZZ 
HttpGetZZ 
(ZZ 
$strZZ 
)ZZ 
]ZZ 
public[[ 

IActionResult[[ 
DecodeToken[[ $
([[$ %
[[[% &
	FromQuery[[& /
][[/ 0
string[[1 7
token[[8 =
)[[= >
{\\ 
try]] 
{^^ 	
var`` 
parts`` 
=`` 
token`` 
.`` 
Split`` #
(``# $
$char``$ '
)``' (
;``( )
varaa 
responseaa 
=aa 
newaa 

Dictionaryaa )
<aa) *
stringaa* 0
,aa0 1
objectaa2 8
>aa8 9
{bb 
[cc 

DecodedKeycc 
]cc 
=cc 
truecc #
,cc# $
[dd 
	HeaderKeydd 
]dd 
=dd 
partsdd #
.dd# $
Lengthdd$ *
>dd+ ,
$numdd- .
?dd/ 0
Encodingdd1 9
.dd9 :
UTF8dd: >
.dd> ?
	GetStringdd? H
(ddH I
ConvertddI P
.ddP Q
FromBase64StringddQ a
(dda b
partsddb g
[ddg h
$numddh i
]ddi j
)ddj k
)ddk l
:ddm n
stringddo u
.ddu v
Emptyddv {
,dd{ |
[ee 

PayloadKeyee 
]ee 
=ee 
partsee $
.ee$ %
Lengthee% +
>ee, -
$numee. /
?ee0 1
Encodingee2 :
.ee: ;
UTF8ee; ?
.ee? @
	GetStringee@ I
(eeI J
ConverteeJ Q
.eeQ R
FromBase64StringeeR b
(eeb c
partseec h
[eeh i
$numeei j
]eej k
)eek l
)eel m
:een o
stringeep v
.eev w
Emptyeew |
,ee| }
[ff 
SignatureKeyff 
]ff 
=ff  
partsff! &
.ff& '
Lengthff' -
>ff. /
$numff0 1
?ff2 3
partsff4 9
[ff9 :
$numff: ;
]ff; <
:ff= >
stringff? E
.ffE F
EmptyffF K
,ffK L
}gg 
;gg 
returnii 
Okii 
(ii 
responseii 
)ii 
;ii  
}jj 	
catchkk 
(kk 
	Exceptionkk 
ekk 
)kk 
{ll 	
varmm 
responsemm 
=mm 
newmm 

Dictionarymm )
<mm) *
stringmm* 0
,mm0 1
objectmm2 8
>mm8 9
{nn 
[oo 

DecodedKeyoo 
]oo 
=oo 
falseoo $
,oo$ %
[pp 
ErrorKeypp 
]pp 
=pp 
epp 
.pp 
Messagepp &
,pp& '
}qq 
;qq 
returnss 
Okss 
(ss 
responsess 
)ss 
;ss  
}tt 	
}uu 
[zz 
HttpPostzz 
(zz 
$strzz $
)zz$ %
]zz% &
public{{ 

IActionResult{{ 
VerifyAnyAlgorithm{{ +
({{+ ,
[{{, -
FromBody{{- 5
]{{5 6

Dictionary{{7 A
<{{A B
string{{B H
,{{H I
string{{J P
>{{P Q
request{{R Y
){{Y Z
{|| 
try}} 
{~~ 	
var 
token 
= 
request 
.  
GetValueOrDefault  1
(1 2
TokenKey2 :
,: ;
string< B
.B C
EmptyC H
)H I
;I J
var
ÄÄ 
	algorithm
ÄÄ 
=
ÄÄ 
request
ÄÄ #
.
ÄÄ# $
GetValueOrDefault
ÄÄ$ 5
(
ÄÄ5 6
AlgorithmKey
ÄÄ6 B
,
ÄÄB C
string
ÄÄD J
.
ÄÄJ K
Empty
ÄÄK P
)
ÄÄP Q
;
ÄÄQ R
var
ÉÉ 
response
ÉÉ 
=
ÉÉ 
new
ÉÉ 

Dictionary
ÉÉ )
<
ÉÉ) *
string
ÉÉ* 0
,
ÉÉ0 1
object
ÉÉ2 8
>
ÉÉ8 9
{
ÑÑ 
[
ÖÖ 
ValidKey
ÖÖ 
]
ÖÖ 
=
ÖÖ 
true
ÖÖ !
,
ÖÖ! "
[
ÜÜ 
AlgorithmKey
ÜÜ 
]
ÜÜ 
=
ÜÜ  
	algorithm
ÜÜ! *
,
ÜÜ* +
[
áá 
TokenKey
áá 
]
áá 
=
áá 
token
áá "
,
áá" #
[
àà 

MessageKey
àà 
]
àà 
=
àà 
$"
àà !
$str
àà! H
{
ààH I
	algorithm
ààI R
}
ààR S
"
ààS T
,
ààT U
}
ââ 
;
ââ 
return
ãã 
Ok
ãã 
(
ãã 
response
ãã 
)
ãã 
;
ãã  
}
åå 	
catch
çç 
(
çç 
	Exception
çç 
e
çç 
)
çç 
{
éé 	
var
èè 
response
èè 
=
èè 
new
èè 

Dictionary
èè )
<
èè) *
string
èè* 0
,
èè0 1
object
èè2 8
>
èè8 9
{
êê 
[
ëë 
ValidKey
ëë 
]
ëë 
=
ëë 
false
ëë "
,
ëë" #
[
íí 
ErrorKey
íí 
]
íí 
=
íí 
e
íí 
.
íí 
Message
íí &
,
íí& '
}
ìì 
;
ìì 
return
ïï 
Ok
ïï 
(
ïï 
response
ïï 
)
ïï 
;
ïï  
}
ññ 	
}
óó 
}òò çŸ
d/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/EnhancedAuthTestController.cs
	namespace		 	 
SpringJavaEquivalent		
 
.		 
Controllers		 *
;		* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
[ 
Tags 
( 
$str #
)# $
]$ %
public 
class &
EnhancedAuthTestController '
:( )
ControllerBase* 8
{ 
private 
const 
string 
UnknownValue %
=& '
$str( 1
;1 2
public 
&
EnhancedAuthTestController %
(% &
)& '
{ 
} 
[ 
HttpGet 
( 
$str 
) 
] 
[ 
AllowAnonymous 
] 
[  
ProducesResponseType 
( 
typeof  
(  !
object! '
)' (
,( )
$num* -
)- .
]. /
public   

IActionResult   
PublicEndpoint   '
(  ' (
)  ( )
{!! 
return"" 
Ok"" 
("" 
new"" 
{## 	
level$$ 
=$$ 
$num$$ 
,$$ 
message%% 
=%% 
$str%% D
,%%D E
	timestamp&& 
=&& 
DateTime&&  
.&&  !
UtcNow&&! '
,&&' (
user'' 
='' 
UnknownValue'' 
,''  
roles(( 
=(( 
new(( 
[(( 
](( 
{(( 
$str(( "
}((# $
,(($ %
permissions)) 
=)) 
new)) 
[)) 
])) 
{))  !
$str))" (
}))) *
,))* +
}** 	
)**	 

;**
 
}++ 
[00 
HttpGet00 
(00 
$str00 
)00 
]00 
[11 
	Authorize11 
]11 
[22  
ProducesResponseType22 
(22 
typeof22  
(22  !
object22! '
)22' (
,22( )
$num22* -
)22- .
]22. /
public33 

IActionResult33 !
AuthenticatedEndpoint33 .
(33. /
)33/ 0
{44 
var55 
user55 
=55 
this55 
.55 
User55 
.55 
Identity55 %
?55% &
.55& '
Name55' +
??55, .
UnknownValue55/ ;
;55; <
var66 
roles66 
=66 
this66 
.66 
User66 
.66 
Claims66 $
.77 
Where77 
(77 
c77 
=>77 
c77 
.77 
Type77 
==77 !

ClaimTypes77" ,
.77, -
Role77- 1
)771 2
.88 
Select88 
(88 
c88 
=>88 
c88 
.88 
Value88  
)88  !
.99 
ToArray99 
(99 
)99 
;99 
return;; 
Ok;; 
(;; 
new;; 
{<< 	
level== 
=== 
$num== 
,== 
message>> 
=>> 
$str>> N
,>>N O
	timestamp?? 
=?? 
DateTime??  
.??  !
UtcNow??! '
,??' (
user@@ 
,@@ 
rolesAA 
,AA 
permissionsBB 
=BB 
newBB 
[BB 
]BB 
{BB  !
$strBB" 0
}BB1 2
,BB2 3
}CC 	
)CC	 

;CC
 
}DD 
[II 
HttpGetII 
(II 
$strII 
)II 
]II 
[JJ 
	AuthorizeJJ 
(JJ 
RolesJJ 
=JJ 
$strJJ 
)JJ 
]JJ 
[KK  
ProducesResponseTypeKK 
(KK 
typeofKK  
(KK  !
objectKK! '
)KK' (
,KK( )
$numKK* -
)KK- .
]KK. /
publicLL 

IActionResultLL 
UserRoleEndpointLL )
(LL) *
)LL* +
{MM 
varNN 
userNN 
=NN 
thisNN 
.NN 
UserNN 
.NN 
IdentityNN %
?NN% &
.NN& '
NameNN' +
??NN, .
UnknownValueNN/ ;
;NN; <
varOO 
rolesOO 
=OO 
thisOO 
.OO 
UserOO 
.OO 
ClaimsOO $
.PP 
WherePP 
(PP 
cPP 
=>PP 
cPP 
.PP 
TypePP 
==PP !

ClaimTypesPP" ,
.PP, -
RolePP- 1
)PP1 2
.QQ 
SelectQQ 
(QQ 
cQQ 
=>QQ 
cQQ 
.QQ 
ValueQQ  
)QQ  !
.RR 
ToArrayRR 
(RR 
)RR 
;RR 
returnTT 
OkTT 
(TT 
newTT 
{UU 	
levelVV 
=VV 
$numVV 
,VV 
messageWW 
=WW 
$strWW ?
,WW? @
	timestampXX 
=XX 
DateTimeXX  
.XX  !
UtcNowXX! '
,XX' (
userYY 
,YY 
rolesZZ 
,ZZ 
permissions[[ 
=[[ 
new[[ 
[[[ 
][[ 
{[[  !
$str[[" /
,[[/ 0
$str[[1 <
}[[= >
,[[> ?
}\\ 	
)\\	 

;\\
 
}]] 
[bb 
HttpGetbb 
(bb 
$strbb 
)bb 
]bb 
[cc 
	Authorizecc 
(cc 
Rolescc 
=cc 
$strcc 
)cc 
]cc  
[dd  
ProducesResponseTypedd 
(dd 
typeofdd  
(dd  !
objectdd! '
)dd' (
,dd( )
$numdd* -
)dd- .
]dd. /
publicee 

IActionResultee 
AdminRoleEndpointee *
(ee* +
)ee+ ,
{ff 
vargg 
usergg 
=gg 
thisgg 
.gg 
Usergg 
.gg 
Identitygg %
?gg% &
.gg& '
Namegg' +
??gg, .
UnknownValuegg/ ;
;gg; <
varhh 
roleshh 
=hh 
thishh 
.hh 
Userhh 
.hh 
Claimshh $
.ii 
Whereii 
(ii 
cii 
=>ii 
cii 
.ii 
Typeii 
==ii !

ClaimTypesii" ,
.ii, -
Roleii- 1
)ii1 2
.jj 
Selectjj 
(jj 
cjj 
=>jj 
cjj 
.jj 
Valuejj  
)jj  !
.kk 
ToArraykk 
(kk 
)kk 
;kk 
returnmm 
Okmm 
(mm 
newmm 
{nn 	
leveloo 
=oo 
$numoo 
,oo 
messagepp 
=pp 
$strpp A
,ppA B
	timestampqq 
=qq 
DateTimeqq  
.qq  !
UtcNowqq! '
,qq' (
userrr 
,rr 
rolesss 
,ss 
permissionstt 
=tt 
newtt 
[tt 
]tt 
{tt  !
$strtt" 0
,tt0 1
$strtt2 >
,tt> ?
$strtt@ M
}ttN O
,ttO P
}uu 	
)uu	 

;uu
 
}vv 
[{{ 
HttpGet{{ 
({{ 
$str{{ 
){{ 
]{{ 
[|| 
	Authorize|| 
(|| 
Policy|| 
=|| 
$str|| )
)||) *
]||* +
[}}  
ProducesResponseType}} 
(}} 
typeof}}  
(}}  !
object}}! '
)}}' (
,}}( )
$num}}* -
)}}- .
]}}. /
public~~ 

IActionResult~~ 
CacheReadEndpoint~~ *
(~~* +
)~~+ ,
{ 
var
ÄÄ 
user
ÄÄ 
=
ÄÄ 
this
ÄÄ 
.
ÄÄ 
User
ÄÄ 
.
ÄÄ 
Identity
ÄÄ %
?
ÄÄ% &
.
ÄÄ& '
Name
ÄÄ' +
??
ÄÄ, .
UnknownValue
ÄÄ/ ;
;
ÄÄ; <
var
ÅÅ 
roles
ÅÅ 
=
ÅÅ 
this
ÅÅ 
.
ÅÅ 
User
ÅÅ 
.
ÅÅ 
Claims
ÅÅ $
.
ÇÇ 
Where
ÇÇ 
(
ÇÇ 
c
ÇÇ 
=>
ÇÇ 
c
ÇÇ 
.
ÇÇ 
Type
ÇÇ 
==
ÇÇ !

ClaimTypes
ÇÇ" ,
.
ÇÇ, -
Role
ÇÇ- 1
)
ÇÇ1 2
.
ÉÉ 
Select
ÉÉ 
(
ÉÉ 
c
ÉÉ 
=>
ÉÉ 
c
ÉÉ 
.
ÉÉ 
Value
ÉÉ  
)
ÉÉ  !
.
ÑÑ 
ToArray
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
var
ÖÖ 
permissions
ÖÖ 
=
ÖÖ 
this
ÖÖ 
.
ÖÖ 
User
ÖÖ #
.
ÖÖ# $
Claims
ÖÖ$ *
.
ÜÜ 
Where
ÜÜ 
(
ÜÜ 
c
ÜÜ 
=>
ÜÜ 
c
ÜÜ 
.
ÜÜ 
Type
ÜÜ 
==
ÜÜ !
$str
ÜÜ" .
)
ÜÜ. /
.
áá 
Select
áá 
(
áá 
c
áá 
=>
áá 
c
áá 
.
áá 
Value
áá  
)
áá  !
.
àà 
ToArray
àà 
(
àà 
)
àà 
;
àà 
return
ää 
Ok
ää 
(
ää 
new
ää 
{
ãã 	
level
åå 
=
åå 
$num
åå 
,
åå 
message
çç 
=
çç 
$str
çç L
,
ççL M
	timestamp
éé 
=
éé 
DateTime
éé  
.
éé  !
UtcNow
éé! '
,
éé' (
user
èè 
,
èè 
roles
êê 
,
êê 
permissions
ëë 
,
ëë 
}
íí 	
)
íí	 

;
íí
 
}
ìì 
[
òò 
HttpGet
òò 
(
òò 
$str
òò 
)
òò 
]
òò 
[
ôô 
	Authorize
ôô 
(
ôô 
Policy
ôô 
=
ôô 
$str
ôô *
)
ôô* +
]
ôô+ ,
[
öö "
ProducesResponseType
öö 
(
öö 
typeof
öö  
(
öö  !
object
öö! '
)
öö' (
,
öö( )
$num
öö* -
)
öö- .
]
öö. /
public
õõ 

IActionResult
õõ  
CacheWriteEndpoint
õõ +
(
õõ+ ,
)
õõ, -
{
úú 
var
ùù 
user
ùù 
=
ùù 
this
ùù 
.
ùù 
User
ùù 
.
ùù 
Identity
ùù %
?
ùù% &
.
ùù& '
Name
ùù' +
??
ùù, .
UnknownValue
ùù/ ;
;
ùù; <
var
ûû 
roles
ûû 
=
ûû 
this
ûû 
.
ûû 
User
ûû 
.
ûû 
Claims
ûû $
.
üü 
Where
üü 
(
üü 
c
üü 
=>
üü 
c
üü 
.
üü 
Type
üü 
==
üü !

ClaimTypes
üü" ,
.
üü, -
Role
üü- 1
)
üü1 2
.
†† 
Select
†† 
(
†† 
c
†† 
=>
†† 
c
†† 
.
†† 
Value
††  
)
††  !
.
°° 
ToArray
°° 
(
°° 
)
°° 
;
°° 
var
¢¢ 
permissions
¢¢ 
=
¢¢ 
this
¢¢ 
.
¢¢ 
User
¢¢ #
.
¢¢# $
Claims
¢¢$ *
.
££ 
Where
££ 
(
££ 
c
££ 
=>
££ 
c
££ 
.
££ 
Type
££ 
==
££ !
$str
££" .
)
££. /
.
§§ 
Select
§§ 
(
§§ 
c
§§ 
=>
§§ 
c
§§ 
.
§§ 
Value
§§  
)
§§  !
.
•• 
ToArray
•• 
(
•• 
)
•• 
;
•• 
return
ßß 
Ok
ßß 
(
ßß 
new
ßß 
{
®® 	
level
©© 
=
©© 
$num
©© 
,
©© 
message
™™ 
=
™™ 
$str
™™ N
,
™™N O
	timestamp
´´ 
=
´´ 
DateTime
´´  
.
´´  !
UtcNow
´´! '
,
´´' (
user
¨¨ 
,
¨¨ 
roles
≠≠ 
,
≠≠ 
permissions
ÆÆ 
,
ÆÆ 
}
ØØ 	
)
ØØ	 

;
ØØ
 
}
∞∞ 
[
µµ 
HttpGet
µµ 
(
µµ 
$str
µµ 
)
µµ  
]
µµ  !
[
∂∂ 
	Authorize
∂∂ 
(
∂∂ 
Roles
∂∂ 
=
∂∂ 
$str
∂∂ &
)
∂∂& '
]
∂∂' (
[
∑∑ "
ProducesResponseType
∑∑ 
(
∑∑ 
typeof
∑∑  
(
∑∑  !
object
∑∑! '
)
∑∑' (
,
∑∑( )
$num
∑∑* -
)
∑∑- .
]
∑∑. /
public
∏∏ 

IActionResult
∏∏ $
AdminOrManagerEndpoint
∏∏ /
(
∏∏/ 0
)
∏∏0 1
{
ππ 
var
∫∫ 
user
∫∫ 
=
∫∫ 
this
∫∫ 
.
∫∫ 
User
∫∫ 
.
∫∫ 
Identity
∫∫ %
?
∫∫% &
.
∫∫& '
Name
∫∫' +
??
∫∫, .
UnknownValue
∫∫/ ;
;
∫∫; <
var
ªª 
roles
ªª 
=
ªª 
this
ªª 
.
ªª 
User
ªª 
.
ªª 
Claims
ªª $
.
ºº 
Where
ºº 
(
ºº 
c
ºº 
=>
ºº 
c
ºº 
.
ºº 
Type
ºº 
==
ºº !

ClaimTypes
ºº" ,
.
ºº, -
Role
ºº- 1
)
ºº1 2
.
ΩΩ 
Select
ΩΩ 
(
ΩΩ 
c
ΩΩ 
=>
ΩΩ 
c
ΩΩ 
.
ΩΩ 
Value
ΩΩ  
)
ΩΩ  !
.
ææ 
ToArray
ææ 
(
ææ 
)
ææ 
;
ææ 
return
¿¿ 
Ok
¿¿ 
(
¿¿ 
new
¿¿ 
{
¡¡ 	
level
¬¬ 
=
¬¬ 
$num
¬¬ 
,
¬¬ 
message
√√ 
=
√√ 
$str
√√ R
,
√√R S
	timestamp
ƒƒ 
=
ƒƒ 
DateTime
ƒƒ  
.
ƒƒ  !
UtcNow
ƒƒ! '
,
ƒƒ' (
user
≈≈ 
,
≈≈ 
roles
∆∆ 
,
∆∆ 
permissions
«« 
=
«« 
new
«« 
[
«« 
]
«« 
{
««  !
$str
««" 5
,
««5 6
$str
««7 I
}
««J K
,
««K L
}
»» 	
)
»»	 

;
»»
 
}
…… 
[
ŒŒ 
HttpGet
ŒŒ 
(
ŒŒ 
$str
ŒŒ  
)
ŒŒ  !
]
ŒŒ! "
[
œœ 
	Authorize
œœ 
(
œœ 
Roles
œœ 
=
œœ 
$str
œœ 
,
œœ 
Policy
œœ  &
=
œœ' (
$str
œœ) ;
)
œœ; <
]
œœ< =
[
–– "
ProducesResponseType
–– 
(
–– 
typeof
––  
(
––  !
object
––! '
)
––' (
,
––( )
$num
––* -
)
––- .
]
––. /
public
—— 

IActionResult
—— %
AdminCacheWriteEndpoint
—— 0
(
——0 1
)
——1 2
{
““ 
var
”” 
user
”” 
=
”” 
this
”” 
.
”” 
User
”” 
.
”” 
Identity
”” %
?
””% &
.
””& '
Name
””' +
??
””, .
UnknownValue
””/ ;
;
””; <
var
‘‘ 
roles
‘‘ 
=
‘‘ 
this
‘‘ 
.
‘‘ 
User
‘‘ 
.
‘‘ 
Claims
‘‘ $
.
’’ 
Where
’’ 
(
’’ 
c
’’ 
=>
’’ 
c
’’ 
.
’’ 
Type
’’ 
==
’’ !

ClaimTypes
’’" ,
.
’’, -
Role
’’- 1
)
’’1 2
.
÷÷ 
Select
÷÷ 
(
÷÷ 
c
÷÷ 
=>
÷÷ 
c
÷÷ 
.
÷÷ 
Value
÷÷  
)
÷÷  !
.
◊◊ 
ToArray
◊◊ 
(
◊◊ 
)
◊◊ 
;
◊◊ 
var
ÿÿ 
permissions
ÿÿ 
=
ÿÿ 
this
ÿÿ 
.
ÿÿ 
User
ÿÿ #
.
ÿÿ# $
Claims
ÿÿ$ *
.
ŸŸ 
Where
ŸŸ 
(
ŸŸ 
c
ŸŸ 
=>
ŸŸ 
c
ŸŸ 
.
ŸŸ 
Type
ŸŸ 
==
ŸŸ !
$str
ŸŸ" .
)
ŸŸ. /
.
⁄⁄ 
Select
⁄⁄ 
(
⁄⁄ 
c
⁄⁄ 
=>
⁄⁄ 
c
⁄⁄ 
.
⁄⁄ 
Value
⁄⁄  
)
⁄⁄  !
.
€€ 
ToArray
€€ 
(
€€ 
)
€€ 
;
€€ 
return
›› 
Ok
›› 
(
›› 
new
›› 
{
ﬁﬁ 	
level
ﬂﬂ 
=
ﬂﬂ 
$num
ﬂﬂ 
,
ﬂﬂ 
message
‡‡ 
=
‡‡ 
$str
‡‡ c
,
‡‡c d
	timestamp
·· 
=
·· 
DateTime
··  
.
··  !
UtcNow
··! '
,
··' (
user
‚‚ 
,
‚‚ 
roles
„„ 
,
„„ 
permissions
‰‰ 
,
‰‰ 
}
ÂÂ 	
)
ÂÂ	 

;
ÂÂ
 
}
ÊÊ 
[
ÎÎ 
HttpGet
ÎÎ 
(
ÎÎ 
$str
ÎÎ  
)
ÎÎ  !
]
ÎÎ! "
[
ÏÏ 
	Authorize
ÏÏ 
(
ÏÏ 
Policy
ÏÏ 
=
ÏÏ 
$str
ÏÏ 0
)
ÏÏ0 1
]
ÏÏ1 2
[
ÌÌ "
ProducesResponseType
ÌÌ 
(
ÌÌ 
typeof
ÌÌ  
(
ÌÌ  !
object
ÌÌ! '
)
ÌÌ' (
,
ÌÌ( )
$num
ÌÌ* -
)
ÌÌ- .
]
ÌÌ. /
public
ÓÓ 

IActionResult
ÓÓ &
IdentityProviderEndpoint
ÓÓ 1
(
ÓÓ1 2
)
ÓÓ2 3
{
ÔÔ 
var
 
user
 
=
 
this
 
.
 
User
 
.
 
Identity
 %
?
% &
.
& '
Name
' +
??
, .
UnknownValue
/ ;
;
; <
var
ÒÒ 
roles
ÒÒ 
=
ÒÒ 
this
ÒÒ 
.
ÒÒ 
User
ÒÒ 
.
ÒÒ 
Claims
ÒÒ $
.
ÚÚ 
Where
ÚÚ 
(
ÚÚ 
c
ÚÚ 
=>
ÚÚ 
c
ÚÚ 
.
ÚÚ 
Type
ÚÚ 
==
ÚÚ !

ClaimTypes
ÚÚ" ,
.
ÚÚ, -
Role
ÚÚ- 1
)
ÚÚ1 2
.
ÛÛ 
Select
ÛÛ 
(
ÛÛ 
c
ÛÛ 
=>
ÛÛ 
c
ÛÛ 
.
ÛÛ 
Value
ÛÛ  
)
ÛÛ  !
.
ÙÙ 
ToArray
ÙÙ 
(
ÙÙ 
)
ÙÙ 
;
ÙÙ 
var
ıı 
identityProvider
ıı 
=
ıı 
this
ıı #
.
ıı# $
User
ıı$ (
.
ıı( )
Claims
ıı) /
.
ˆˆ 
FirstOrDefault
ˆˆ 
(
ˆˆ 
c
ˆˆ 
=>
ˆˆ  
c
ˆˆ! "
.
ˆˆ" #
Type
ˆˆ# '
==
ˆˆ( *
$str
ˆˆ+ >
)
ˆˆ> ?
?
ˆˆ? @
.
ˆˆ@ A
Value
ˆˆA F
??
ˆˆG I
UnknownValue
ˆˆJ V
;
ˆˆV W
return
¯¯ 
Ok
¯¯ 
(
¯¯ 
new
¯¯ 
{
˘˘ 	
level
˙˙ 
=
˙˙ 
$num
˙˙ 
,
˙˙ 
message
˚˚ 
=
˚˚ 
$str
˚˚ X
,
˚˚X Y
	timestamp
¸¸ 
=
¸¸ 
DateTime
¸¸  
.
¸¸  !
UtcNow
¸¸! '
,
¸¸' (
user
˝˝ 
,
˝˝ 
roles
˛˛ 
,
˛˛ 
identityProvider
ˇˇ 
,
ˇˇ 
permissions
ÄÄ 
=
ÄÄ 
new
ÄÄ 
[
ÄÄ 
]
ÄÄ 
{
ÄÄ  !
$str
ÄÄ" <
}
ÄÄ= >
,
ÄÄ> ?
}
ÅÅ 	
)
ÅÅ	 

;
ÅÅ
 
}
ÇÇ 
[
áá 
HttpGet
áá 
(
áá 
$str
áá 
)
áá 
]
áá 
[
àà 
	Authorize
àà 
(
àà 
Policy
àà 
=
àà 
$str
àà )
)
àà) *
]
àà* +
[
ââ "
ProducesResponseType
ââ 
(
ââ 
typeof
ââ  
(
ââ  !
object
ââ! '
)
ââ' (
,
ââ( )
$num
ââ* -
)
ââ- .
]
ââ. /
public
ää 

IActionResult
ää 
AuthLevelEndpoint
ää *
(
ää* +
)
ää+ ,
{
ãã 
var
åå 
user
åå 
=
åå 
this
åå 
.
åå 
User
åå 
.
åå 
Identity
åå %
?
åå% &
.
åå& '
Name
åå' +
??
åå, .
UnknownValue
åå/ ;
;
åå; <
var
çç 
roles
çç 
=
çç 
this
çç 
.
çç 
User
çç 
.
çç 
Claims
çç $
.
éé 
Where
éé 
(
éé 
c
éé 
=>
éé 
c
éé 
.
éé 
Type
éé 
==
éé !

ClaimTypes
éé" ,
.
éé, -
Role
éé- 1
)
éé1 2
.
èè 
Select
èè 
(
èè 
c
èè 
=>
èè 
c
èè 
.
èè 
Value
èè  
)
èè  !
.
êê 
ToArray
êê 
(
êê 
)
êê 
;
êê 
var
ëë 
	authLevel
ëë 
=
ëë 
this
ëë 
.
ëë 
User
ëë !
.
ëë! "
Claims
ëë" (
.
íí 
FirstOrDefault
íí 
(
íí 
c
íí 
=>
íí  
c
íí! "
.
íí" #
Type
íí# '
==
íí( *
$str
íí+ 7
)
íí7 8
?
íí8 9
.
íí9 :
Value
íí: ?
??
íí@ B
UnknownValue
ííC O
;
ííO P
return
îî 
Ok
îî 
(
îî 
new
îî 
{
ïï 	
level
ññ 
=
ññ 
$num
ññ 
,
ññ 
message
óó 
=
óó 
$str
óó T
,
óóT U
	timestamp
òò 
=
òò 
DateTime
òò  
.
òò  !
UtcNow
òò! '
,
òò' (
user
ôô 
,
ôô 
roles
öö 
,
öö 
	authLevel
õõ 
,
õõ 
permissions
úú 
=
úú 
new
úú 
[
úú 
]
úú 
{
úú  !
$str
úú" 4
}
úú5 6
,
úú6 7
}
ùù 	
)
ùù	 

;
ùù
 
}
ûû 
[
££ 
HttpGet
££ 
(
££ 
$str
££ 
)
££  
]
££  !
[
§§ 
	Authorize
§§ 
(
§§ 
Roles
§§ 
=
§§ 
$str
§§ 
,
§§ 
Policy
§§  &
=
§§' (
$str
§§) b
)
§§b c
]
§§c d
[
•• "
ProducesResponseType
•• 
(
•• 
typeof
••  
(
••  !
object
••! '
)
••' (
,
••( )
$num
••* -
)
••- .
]
••. /
public
¶¶ 

IActionResult
¶¶ %
MaximumSecurityEndpoint
¶¶ 0
(
¶¶0 1
)
¶¶1 2
{
ßß 
var
®® 
user
®® 
=
®® 
this
®® 
.
®® 
User
®® 
.
®® 
Identity
®® %
?
®®% &
.
®®& '
Name
®®' +
??
®®, .
UnknownValue
®®/ ;
;
®®; <
var
©© 
roles
©© 
=
©© 
this
©© 
.
©© 
User
©© 
.
©© 
Claims
©© $
.
™™ 
Where
™™ 
(
™™ 
c
™™ 
=>
™™ 
c
™™ 
.
™™ 
Type
™™ 
==
™™ !

ClaimTypes
™™" ,
.
™™, -
Role
™™- 1
)
™™1 2
.
´´ 
Select
´´ 
(
´´ 
c
´´ 
=>
´´ 
c
´´ 
.
´´ 
Value
´´  
)
´´  !
.
¨¨ 
ToArray
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨ 
var
≠≠ 
permissions
≠≠ 
=
≠≠ 
this
≠≠ 
.
≠≠ 
User
≠≠ #
.
≠≠# $
Claims
≠≠$ *
.
ÆÆ 
Where
ÆÆ 
(
ÆÆ 
c
ÆÆ 
=>
ÆÆ 
c
ÆÆ 
.
ÆÆ 
Type
ÆÆ 
==
ÆÆ !
$str
ÆÆ" .
)
ÆÆ. /
.
ØØ 
Select
ØØ 
(
ØØ 
c
ØØ 
=>
ØØ 
c
ØØ 
.
ØØ 
Value
ØØ  
)
ØØ  !
.
∞∞ 
ToArray
∞∞ 
(
∞∞ 
)
∞∞ 
;
∞∞ 
var
±± 
identityProvider
±± 
=
±± 
this
±± #
.
±±# $
User
±±$ (
.
±±( )
Claims
±±) /
.
≤≤ 
FirstOrDefault
≤≤ 
(
≤≤ 
c
≤≤ 
=>
≤≤  
c
≤≤! "
.
≤≤" #
Type
≤≤# '
==
≤≤( *
$str
≤≤+ >
)
≤≤> ?
?
≤≤? @
.
≤≤@ A
Value
≤≤A F
??
≤≤G I
UnknownValue
≤≤J V
;
≤≤V W
var
≥≥ 
	authLevel
≥≥ 
=
≥≥ 
this
≥≥ 
.
≥≥ 
User
≥≥ !
.
≥≥! "
Claims
≥≥" (
.
¥¥ 
FirstOrDefault
¥¥ 
(
¥¥ 
c
¥¥ 
=>
¥¥  
c
¥¥! "
.
¥¥" #
Type
¥¥# '
==
¥¥( *
$str
¥¥+ 7
)
¥¥7 8
?
¥¥8 9
.
¥¥9 :
Value
¥¥: ?
??
¥¥@ B
UnknownValue
¥¥C O
;
¥¥O P
return
∂∂ 
Ok
∂∂ 
(
∂∂ 
new
∂∂ 
{
∑∑ 	
level
∏∏ 
=
∏∏ 
$num
∏∏ 
,
∏∏ 
message
ππ 
=
ππ 
$str
ππ R
,
ππR S
	timestamp
∫∫ 
=
∫∫ 
DateTime
∫∫  
.
∫∫  !
UtcNow
∫∫! '
,
∫∫' (
user
ªª 
,
ªª 
roles
ºº 
,
ºº 
permissions
ΩΩ 
,
ΩΩ 
identityProvider
ææ 
,
ææ 
	authLevel
øø 
,
øø 
}
¿¿ 	
)
¿¿	 

;
¿¿
 
}
¡¡ 
}¬¬ ¯-
_/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Controllers/ApplicationController.cs
	namespace		 	 
SpringJavaEquivalent		
 
.		 
Controllers		 *
;		* +
[ 
ApiController 
] 
[ 
Route 
( 
$str 	
)	 

]
 
[ 
Tags 
( 
$str 
) 
] 
public 
class !
ApplicationController "
:# $
ControllerBase% 3
{ 
private 
readonly 
ILogger 
< !
ApplicationController 2
>2 3
_logger4 ;
;; <
public 
!
ApplicationController  
(  !
ILogger! (
<( )!
ApplicationController) >
>> ?
logger@ F
)F G
{ 
this 
. 
_logger 
= 
logger 
; 
} 
[ 
HttpGet 
] 
public 

IActionResult 
Home 
( 
) 
{ 
var 
	jwsHeader 
= 
Convert 
.  
ToBase64String  .
(. /
Encoding/ 7
.7 8
UTF88 <
.< =
GetBytes= E
(E F
$strF ]
)] ^
)^ _
;_ `
this 
. 
_logger 
. 
LogInformation #
(# $
$str$ G
,G H
	jwsHeaderI R
)R S
;S T
foreach"" 
("" 
var"" 
header"" 
in"" 
this"" #
.""# $
Request""$ +
.""+ ,
Headers"", 3
)""3 4
{## 	
this$$ 
.$$ 
_logger$$ 
.$$ 
LogInformation$$ '
($$' (
$str$$( B
,$$B C
header$$D J
.$$J K
Key$$K N
,$$N O
header$$P V
.$$V W
Value$$W \
)$$\ ]
;$$] ^
}%% 	
return'' 
Ok'' 
('' 
$str'' ,
)'', -
;''- .
}(( 
[-- 
HttpGet-- 
(-- 
$str-- -
)--- .
]--. /
[.. 
	Authorize.. 
(.. 
Policy.. 
=.. 
$str.. ;
)..; <
]..< =
[//  
ProducesResponseType// 
(// 
typeof//  
(//  !
string//! '
)//' (
,//( )
$num//* -
)//- .
]//. /
[00  
ProducesResponseType00 
(00 
$num00 
)00 
]00 
[11  
ProducesResponseType11 
(11 
$num11 
)11 
]11 
public22 

IActionResult22 
	GetObject22 "
(22" #
[22# $
	FromQuery22$ -
]22- .
string22/ 5
id226 8
)228 9
{33 
this44 
.44 
_logger44 
.44 
LogInformation44 #
(44# $
$str44$ 6
,446 7
id448 :
)44: ;
;44; <
return55 
Ok55 
(55 
$str55 
)55 
;55 
}66 
[;; 
HttpPut;; 
(;; 
$str;; -
);;- .
];;. /
[<< 
	Authorize<< 
(<< 
Policy<< 
=<< 
$str<< <
)<<< =
]<<= >
[==  
ProducesResponseType== 
(== 
typeof==  
(==  !
string==! '
)==' (
,==( )
$num==* -
)==- .
]==. /
[>>  
ProducesResponseType>> 
(>> 
$num>> 
)>> 
]>> 
[??  
ProducesResponseType?? 
(?? 
$num?? 
)?? 
]?? 
public@@ 

IActionResult@@ 
	PutObject@@ "
(@@" #
[@@# $
	FromQuery@@$ -
]@@- .
string@@/ 5
id@@6 8
)@@8 9
{AA 
thisBB 
.BB 
_loggerBB 
.BB 
LogInformationBB #
(BB# $
$strBB$ 6
,BB6 7
idBB8 :
)BB: ;
;BB; <
returnCC 
OkCC 
(CC 
$strCC 
)CC 
;CC 
}DD 
[II 

HttpDeleteII 
(II 
$strII 3
)II3 4
]II4 5
[JJ 
	AuthorizeJJ 
(JJ 
PolicyJJ 
=JJ 
$strJJ =
)JJ= >
]JJ> ?
[KK  
ProducesResponseTypeKK 
(KK 
typeofKK  
(KK  !
stringKK! '
)KK' (
,KK( )
$numKK* -
)KK- .
]KK. /
[LL  
ProducesResponseTypeLL 
(LL 
$numLL 
)LL 
]LL 
[MM  
ProducesResponseTypeMM 
(MM 
$numMM 
)MM 
]MM 
publicNN 

IActionResultNN 
DeleteObjectNN %
(NN% &
[NN& '
	FromQueryNN' 0
]NN0 1
stringNN2 8
idNN9 ;
)NN; <
{OO 
thisPP 
.PP 
_loggerPP 
.PP 
LogInformationPP #
(PP# $
$strPP$ 9
,PP9 :
idPP; =
)PP= >
;PP> ?
returnQQ 
OkQQ 
(QQ 
$strQQ 
)QQ 
;QQ 
}RR 
}SS ≠&
a/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Authorization/PermissionRequirement.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Authorization ,
;, -
public 
class !
PermissionRequirement "
:# $%
IAuthorizationRequirement% >
{ 
public 

string 

Permission 
{ 
get "
;" #
}$ %
public 
!
PermissionRequirement  
(  !
string! '

permission( 2
)2 3
{ 
this 
. 

Permission 
= 

permission $
??% '
throw( -
new. 1!
ArgumentNullException2 G
(G H
nameofH N
(N O

permissionO Y
)Y Z
)Z [
;[ \
} 
} 
public 
class $
AnyPermissionRequirement %
:& '%
IAuthorizationRequirement( A
{ 
public 

string 
[ 
] 
Permissions 
{  !
get" %
;% &
}' (
public 
$
AnyPermissionRequirement #
(# $
params$ *
string+ 1
[1 2
]2 3
permissions4 ?
)? @
{ 
this 
. 
Permissions 
= 
permissions &
??' )
throw* /
new0 3!
ArgumentNullException4 I
(I J
nameofJ P
(P Q
permissionsQ \
)\ ]
)] ^
;^ _
}   
}!! 
public&& 
class&& %
AllPermissionsRequirement&& &
:&&' (%
IAuthorizationRequirement&&) B
{'' 
public(( 

string(( 
[(( 
](( 
Permissions(( 
{((  !
get((" %
;((% &
}((' (
public** 
%
AllPermissionsRequirement** $
(**$ %
params**% +
string**, 2
[**2 3
]**3 4
permissions**5 @
)**@ A
{++ 
this,, 
.,, 
Permissions,, 
=,, 
permissions,, &
??,,' )
throw,,* /
new,,0 3!
ArgumentNullException,,4 I
(,,I J
nameof,,J P
(,,P Q
permissions,,Q \
),,\ ]
),,] ^
;,,^ _
}-- 
}.. 
public33 
class33  
AuthLevelRequirement33 !
:33" #%
IAuthorizationRequirement33$ =
{44 
public55 

string55 
RequiredAuthLevel55 #
{55$ %
get55& )
;55) *
}55+ ,
public77 
 
AuthLevelRequirement77 
(77  
string77  &
requiredAuthLevel77' 8
)778 9
{88 
this99 
.99 
RequiredAuthLevel99 
=99  
requiredAuthLevel99! 2
??993 5
throw996 ;
new99< ?!
ArgumentNullException99@ U
(99U V
nameof99V \
(99\ ]
requiredAuthLevel99] n
)99n o
)99o p
;99p q
}:: 
};; 
public@@ 
class@@ '
IdentityProviderRequirement@@ (
:@@) *%
IAuthorizationRequirement@@+ D
{AA 
publicBB 

stringBB $
RequiredIdentityProviderBB *
{BB+ ,
getBB- 0
;BB0 1
}BB2 3
publicDD 
'
IdentityProviderRequirementDD &
(DD& '
stringDD' -$
requiredIdentityProviderDD. F
)DDF G
{EE 
thisFF 
.FF $
RequiredIdentityProviderFF %
=FF& '$
requiredIdentityProviderFF( @
??FFA C
throwFFD I
newFFJ M!
ArgumentNullExceptionFFN c
(FFc d
nameofFFd j
(FFj k%
requiredIdentityProvider	FFk É
)
FFÉ Ñ
)
FFÑ Ö
;
FFÖ Ü
}GG 
}HH 
publicMM 
classMM 
RoleRequirementMM 
:MM %
IAuthorizationRequirementMM 8
{NN 
publicOO 

stringOO 
RoleOO 
{OO 
getOO 
;OO 
}OO 
publicQQ 

RoleRequirementQQ 
(QQ 
stringQQ !
roleQQ" &
)QQ& '
{RR 
thisSS 
.SS 
RoleSS 
=SS 
roleSS 
??SS 
throwSS !
newSS" %!
ArgumentNullExceptionSS& ;
(SS; <
nameofSS< B
(SSB C
roleSSC G
)SSG H
)SSH I
;SSI J
}TT 
}UU ÍF
]/Users/yshmulev/dev/spring-java-2/dotnet-spring-equivalent/Authorization/PermissionHandler.cs
	namespace 	 
SpringJavaEquivalent
 
. 
Authorization ,
;, -
internal 
class	 
PermissionHandler  
:! " 
AuthorizationHandler# 7
<7 8!
PermissionRequirement8 M
>M N
{ 
	protected 
override 
Task "
HandleRequirementAsync 2
(2 3'
AuthorizationHandlerContext3 N
contextO V
,V W!
PermissionRequirementX m
requirementn y
)y z
{ !
ArgumentNullException 
. 
ThrowIfNull )
() *
context* 1
)1 2
;2 3!
ArgumentNullException 
. 
ThrowIfNull )
() *
requirement* 5
)5 6
;6 7
var 
hasPermission 
= 
context #
.# $
User$ (
.( )
HasClaim) 1
(1 2
$str2 >
,> ?
requirement@ K
.K L

PermissionL V
)V W
;W X
if 

( 
hasPermission 
) 
{ 	
context 
. 
Succeed 
( 
requirement '
)' (
;( )
} 	
return 
Task 
. 
CompletedTask !
;! "
} 
} 
internal"" 
class""	  
AnyPermissionHandler"" #
:""$ % 
AuthorizationHandler""& :
<"": ;$
AnyPermissionRequirement""; S
>""S T
{## 
	protected$$ 
override$$ 
Task$$ "
HandleRequirementAsync$$ 2
($$2 3'
AuthorizationHandlerContext$$3 N
context$$O V
,$$V W$
AnyPermissionRequirement$$X p
requirement$$q |
)$$| }
{%% !
ArgumentNullException&& 
.&& 
ThrowIfNull&& )
(&&) *
context&&* 1
)&&1 2
;&&2 3!
ArgumentNullException'' 
.'' 
ThrowIfNull'' )
('') *
requirement''* 5
)''5 6
;''6 7
var)) 
hasAnyPermission)) 
=)) 
requirement)) *
.))* +
Permissions))+ 6
.))6 7
Any))7 :
()): ;

permission)); E
=>))F H
context** 
.** 
User** 
.** 
HasClaim** !
(**! "
$str**" .
,**. /

permission**0 :
)**: ;
)**; <
;**< =
if,, 

(,, 
hasAnyPermission,, 
),, 
{-- 	
context.. 
... 
Succeed.. 
(.. 
requirement.. '
)..' (
;..( )
}// 	
return11 
Task11 
.11 
CompletedTask11 !
;11! "
}22 
}33 
internal88 
class88	 !
AllPermissionsHandler88 $
:88% & 
AuthorizationHandler88' ;
<88; <%
AllPermissionsRequirement88< U
>88U V
{99 
	protected:: 
override:: 
Task:: "
HandleRequirementAsync:: 2
(::2 3'
AuthorizationHandlerContext::3 N
context::O V
,::V W%
AllPermissionsRequirement::X q
requirement::r }
)::} ~
{;; !
ArgumentNullException<< 
.<< 
ThrowIfNull<< )
(<<) *
context<<* 1
)<<1 2
;<<2 3!
ArgumentNullException== 
.== 
ThrowIfNull== )
(==) *
requirement==* 5
)==5 6
;==6 7
var?? 
hasAllPermissions?? 
=?? 
requirement??  +
.??+ ,
Permissions??, 7
.??7 8
All??8 ;
(??; <

permission??< F
=>??G I
context@@ 
.@@ 
User@@ 
.@@ 
HasClaim@@ !
(@@! "
$str@@" .
,@@. /

permission@@0 :
)@@: ;
)@@; <
;@@< =
ifBB 

(BB 
hasAllPermissionsBB 
)BB 
{CC 	
contextDD 
.DD 
SucceedDD 
(DD 
requirementDD '
)DD' (
;DD( )
}EE 	
returnGG 
TaskGG 
.GG 
CompletedTaskGG !
;GG! "
}HH 
}II 
internalNN 
classNN	 
RoleHandlerNN 
:NN  
AuthorizationHandlerNN 1
<NN1 2
RoleRequirementNN2 A
>NNA B
{OO 
	protectedPP 
overridePP 
TaskPP "
HandleRequirementAsyncPP 2
(PP2 3'
AuthorizationHandlerContextPP3 N
contextPPO V
,PPV W
RoleRequirementPPX g
requirementPPh s
)PPs t
{QQ !
ArgumentNullExceptionRR 
.RR 
ThrowIfNullRR )
(RR) *
contextRR* 1
)RR1 2
;RR2 3!
ArgumentNullExceptionSS 
.SS 
ThrowIfNullSS )
(SS) *
requirementSS* 5
)SS5 6
;SS6 7
varUU 
hasRoleUU 
=UU 
contextUU 
.UU 
UserUU "
.UU" #
IsInRoleUU# +
(UU+ ,
requirementUU, 7
.UU7 8
RoleUU8 <
)UU< =
;UU= >
ifWW 

(WW 
hasRoleWW 
)WW 
{XX 	
contextYY 
.YY 
SucceedYY 
(YY 
requirementYY '
)YY' (
;YY( )
}ZZ 	
return\\ 
Task\\ 
.\\ 
CompletedTask\\ !
;\\! "
}]] 
}^^ 
internalcc 
classcc	 #
IdentityProviderHandlercc &
:cc' ( 
AuthorizationHandlercc) =
<cc= >'
IdentityProviderRequirementcc> Y
>ccY Z
{dd 
	protectedee 
overrideee 
Taskee "
HandleRequirementAsyncee 2
(ee2 3'
AuthorizationHandlerContextee3 N
contexteeO V
,eeV W'
IdentityProviderRequirementeeX s
requirementeet 
)	ee Ä
{ff !
ArgumentNullExceptiongg 
.gg 
ThrowIfNullgg )
(gg) *
contextgg* 1
)gg1 2
;gg2 3!
ArgumentNullExceptionhh 
.hh 
ThrowIfNullhh )
(hh) *
requirementhh* 5
)hh5 6
;hh6 7
varjj 
identityProviderjj 
=jj 
contextjj &
.jj& '
Userjj' +
.jj+ ,
	FindFirstjj, 5
(jj5 6
$strjj6 I
)jjI J
?jjJ K
.jjK L
ValuejjL Q
;jjQ R
ifll 

(ll 
identityProviderll 
==ll 
requirementll  +
.ll+ ,$
RequiredIdentityProviderll, D
)llD E
{mm 	
contextnn 
.nn 
Succeednn 
(nn 
requirementnn '
)nn' (
;nn( )
}oo 	
returnqq 
Taskqq 
.qq 
CompletedTaskqq !
;qq! "
}rr 
}ss 
internalxx 
classxx	 
AuthLevelHandlerxx 
:xx  ! 
AuthorizationHandlerxx" 6
<xx6 7 
AuthLevelRequirementxx7 K
>xxK L
{yy 
	protectedzz 
overridezz 
Taskzz "
HandleRequirementAsynczz 2
(zz2 3'
AuthorizationHandlerContextzz3 N
contextzzO V
,zzV W 
AuthLevelRequirementzzX l
requirementzzm x
)zzx y
{{{ !
ArgumentNullException|| 
.|| 
ThrowIfNull|| )
(||) *
context||* 1
)||1 2
;||2 3!
ArgumentNullException}} 
.}} 
ThrowIfNull}} )
(}}) *
requirement}}* 5
)}}5 6
;}}6 7
var 
	authLevel 
= 
context 
.  
User  $
.$ %
	FindFirst% .
(. /
$str/ ;
); <
?< =
.= >
Value> C
;C D
if
ÅÅ 

(
ÅÅ 
	authLevel
ÅÅ 
==
ÅÅ 
requirement
ÅÅ $
.
ÅÅ$ %
RequiredAuthLevel
ÅÅ% 6
)
ÅÅ6 7
{
ÇÇ 	
context
ÉÉ 
.
ÉÉ 
Succeed
ÉÉ 
(
ÉÉ 
requirement
ÉÉ '
)
ÉÉ' (
;
ÉÉ( )
}
ÑÑ 	
return
ÜÜ 
Task
ÜÜ 
.
ÜÜ 
CompletedTask
ÜÜ !
;
ÜÜ! "
}
áá 
}àà 